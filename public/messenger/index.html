<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="">
  <title>Messenger | EventFlow</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/styles.css?v=18.2.1">
  <link rel="stylesheet" href="/assets/css/eventflow-17.0.0.css?v=18.2.1">
  <link rel="stylesheet" href="/assets/css/design-system.css?v=18.2.1">
  <link rel="stylesheet" href="/assets/css/liquid-glass.css?v=18.2.1">
  <link rel="stylesheet" href="/assets/css/navbar.css?v=18.2.1">
  <link rel="stylesheet" href="/assets/css/components.css?v=18.2.1">
  <link rel="stylesheet" href="/assets/css/messenger-v4.css?v=4.0.0">
  <link rel="stylesheet" href="/messenger/css/messenger-v4-animations.css?v=7.0.0">
  <link rel="stylesheet" href="/messenger/css/messenger-v4-polish.css?v=1.0.0">

  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js" defer></script>
</head>
<body>

  <!-- =========================================================
       NAVIGATION — Gold Standard Header
       ========================================================= -->
  <header class="ef-header" role="banner">
    <div class="ef-container">
      <div class="ef-header-content">

        <!-- Brand Logo -->
        <a href="/" class="ef-brand" aria-label="EventFlow - Return to homepage">
          <div class="ef-logo" aria-hidden="true">
            <div class="ef-logo-inner"></div>
          </div>
          <span class="ef-brand-text">EventFlow</span>
        </a>

        <!-- Desktop Navigation -->
        <nav class="ef-nav-desktop" aria-label="Main navigation">
          <a href="/start" class="ef-nav-link">Plan</a>
          <a href="/suppliers" class="ef-nav-link">Suppliers</a>
          <a href="/marketplace" class="ef-nav-link">Marketplace</a>
          <a href="/blog" class="ef-nav-link">Guides</a>
          <a href="/pricing" class="ef-nav-link">Pricing</a>
        </nav>

        <!-- Actions -->
        <div class="ef-header-actions">
          <!-- Notification Bell (shown when logged in) -->
          <button
            id="ef-notification-btn"
            class="ef-icon-btn"
            type="button"
            aria-label="View notifications"
            style="display: none;"
          >
            <svg class="ef-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
              <path d="M13.73 21a2 2 0 0 1-3.46 0" />
            </svg>
            <span id="ef-notification-badge" class="ef-badge" style="display: none;">0</span>
          </button>

          <!-- Auth Button (Desktop) -->
          <a href="/auth" id="ef-auth-link" class="ef-btn ef-btn-primary">Log in</a>

          <!-- Dashboard Link (Desktop, hidden by default) -->
          <a href="#" id="ef-dashboard-link" class="ef-nav-link" style="display: none;">Dashboard</a>

          <!-- Mobile Menu Toggle -->
          <button
            id="ef-mobile-toggle"
            class="ef-mobile-toggle"
            type="button"
            aria-label="Toggle menu"
            aria-expanded="false"
            aria-controls="ef-mobile-menu"
          >
            <span class="ef-toggle-line"></span>
            <span class="ef-toggle-line"></span>
            <span class="ef-toggle-line"></span>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="ef-mobile-menu" class="ef-mobile-menu" role="dialog" aria-modal="true" aria-label="Mobile navigation">
      <nav class="ef-mobile-nav" aria-label="Primary navigation">
        <a href="/start" class="ef-mobile-link">Plan an Event</a>
        <a href="/suppliers" class="ef-mobile-link">Browse Suppliers</a>
        <a href="/marketplace" class="ef-mobile-link">Marketplace</a>
        <a href="/pricing" class="ef-mobile-link">Pricing</a>
        <a href="/blog" class="ef-mobile-link">Guides</a>
        <a href="/for-suppliers" class="ef-mobile-link">For Suppliers</a>
        <a href="/faq" class="ef-mobile-link">FAQ</a>
        <div class="ef-mobile-divider"></div>
        <a href="/auth" id="ef-mobile-auth" class="ef-mobile-link ef-mobile-primary">Log in</a>
        <a href="#" id="ef-mobile-dashboard" class="ef-mobile-link" style="display: none;">Dashboard</a>
        <a href="/settings.html" id="ef-mobile-settings" class="ef-mobile-link" style="display: none;">⚙️ Settings</a>
        <a href="#" id="ef-mobile-logout" class="ef-mobile-link" style="display: none;">Log out</a>
      </nav>
    </div>
  </header>

  <!-- =========================================================
       GLOBAL ERROR BANNER (hidden by default)
       ========================================================= -->
  <div
    data-v4="global-error"
    role="alert"
    style="display: none; padding: 12px 24px; background: #fef2f2; border-bottom: 1px solid #fca5a5; color: #991b1b; font-size: 14px;"
  ></div>

  <!-- =========================================================
       MESSENGER v4 — THREE-PANEL LAYOUT
       desktop: sidebar | chat | (details slot reserved)
       tablet:  sidebar | chat
       mobile:  sidebar OR chat (single panel, toggled by JS)
       ========================================================= -->
  <div class="messenger-v4" role="main" aria-label="Messenger">

    <!-- -------------------------------------------------------
         SIDEBAR PANEL
         ------------------------------------------------------- -->
    <aside
      class="messenger-v4__sidebar"
      data-v4="sidebar"
      role="complementary"
      aria-label="Conversations"
    >
      <!-- ConversationListV4 mounts here -->
      <div data-v4="conversation-list" style="display: contents;"></div>
    </aside>

    <!-- -------------------------------------------------------
         CHAT PANEL — flex column: context banner | chat view | typing | composer
         Each sub-container is a direct child so ChatViewV4's innerHTML
         rewrite doesn't wipe the other components.
         ------------------------------------------------------- -->
    <section
      class="messenger-v4__chat"
      data-v4="chat-panel"
      aria-label="Chat"
      style="flex-direction: column;"
    >

      <!-- Context banner (ContextBannerV4 mounts here; hidden until context conversation) -->
      <div data-v4="context-banner"></div>

      <!-- ChatViewV4 mounts here — renders chat header + messages area -->
      <div
        data-v4="chat-view"
        style="flex: 1; min-height: 0; display: flex; flex-direction: column;"
      ></div>

      <!-- Typing indicator (TypingIndicatorV4 mounts here) -->
      <div data-v4="typing-indicator"></div>

      <!-- Message Composer (MessageComposerV4 mounts here) -->
      <div data-v4="composer"></div>

    </section>

  </div>

  <!-- =========================================================
       CONTACT PICKER MODAL (ContactPickerV4 mounts here)
       ========================================================= -->
  <div data-v4="contact-picker"></div>

  <!-- Notification Dropdown (Pre-rendered, shown/hidden by JS) -->
  <div id="notification-dropdown" class="notification-dropdown" style="display: none;">
    <div class="notification-header">
      <h3>Notifications</h3>
      <button class="notification-mark-all" id="notification-mark-all-read">
        Mark all as read
      </button>
    </div>
    <div class="notification-list"></div>
    <div class="notification-footer">
      <a href="/notifications.html" class="notification-view-all">View all</a>
    </div>
  </div>

  <!-- =========================================================
       SCRIPTS — shared core first, then v4 components, then app
       ========================================================= -->
  <script src="/assets/js/utils/auth-state.js" defer></script>
  <script src="/assets/js/burger-menu.js" defer></script>
  <script src="/assets/js/navbar.js" defer></script>
  <script src="/assets/js/notifications.js" defer></script>
  <script src="/assets/js/websocket-client.js" defer></script>

  <!-- Shared core services (used by both v4 orchestrator and legacy v3 pages) -->
  <script src="/messenger/js/MessengerModals.js" defer></script>
  <script src="/messenger/js/MessengerState.js" defer></script>
  <script src="/messenger/js/MessengerAPI.js" defer></script>
  <script src="/messenger/js/MessengerSocket.js" defer></script>

  <!-- v4 UI components (Phase 3) -->
  <script src="/messenger/js/TypingIndicatorV4.js" defer></script>
  <script src="/messenger/js/ContextBannerV4.js" defer></script>
  <script src="/messenger/js/MessageBubbleV4.js" defer></script>
  <script src="/messenger/js/ChatViewV4.js" defer></script>
  <script src="/messenger/js/MessageComposerV4.js" defer></script>
  <script src="/messenger/js/ConversationListV4.js" defer></script>
  <script src="/messenger/js/ContactPickerV4.js" defer></script>
  <script src="/messenger/js/NotificationBridgeV4.js" defer></script>

  <!-- v4 orchestrator (Phase 4) — boots on DOMContentLoaded -->
  <script src="/messenger/js/MessengerAppV4.js" defer></script>

  <!-- Inline bootstrap: open contact picker via keyboard shortcut hint button in sidebar -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Any element with data-action="new-conversation" opens the contact picker
      document.addEventListener('click', function (e) {
        if (e.target.closest('[data-action="new-conversation"]')) {
          window.dispatchEvent(new CustomEvent('messenger:open-contact-picker'));
        }
      });
    });
  </script>

</body>
</html>
