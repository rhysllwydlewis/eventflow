/**
 * Messenger v4 – Animations & Polish
 * All CSS animations and transitions for the Messenger v4 UI.
 * Imported by public/messenger/index.html.
 *
 * Design goals:
 *  - Prefer CSS-only animations; minimal JS class toggling
 *  - Respect prefers-reduced-motion
 *  - Consistent with the liquid-glass design system
 */

/* ============================================================
   0. Motion preference guard
   ============================================================ */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ============================================================
   1. Message send – bubble slides up with fade-in
   ============================================================ */
@keyframes msgBubbleEnter {
  from {
    opacity: 0;
    transform: translateY(14px) scale(0.96);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.message-bubble.is-entering,
.message-bubble--sent.is-entering {
  animation: msgBubbleEnter 0.22s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

.message-bubble--received.is-entering {
  animation: msgBubbleEnter 0.22s cubic-bezier(0.34, 1.56, 0.64, 1) both;
  transform-origin: bottom left;
}

/* ============================================================
   2. New conversation – list item slides in from left
   ============================================================ */
@keyframes convItemSlideIn {
  from {
    opacity: 0;
    transform: translateX(-24px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.conversation-item.is-new,
.conversation-list__item.is-new {
  animation: convItemSlideIn 0.28s ease-out both;
}

/* ============================================================
   3. Typing indicator – three dots bounce with stagger
   ============================================================ */
@keyframes typingDot {
  0%, 60%, 100% {
    transform: translateY(0);
    opacity: 0.45;
  }
  30% {
    transform: translateY(-6px);
    opacity: 1;
  }
}

.typing-indicator__dot {
  display: inline-block;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: currentColor;
  animation: typingDot 1.1s infinite ease-in-out both;
}

.typing-indicator__dot:nth-child(1) { animation-delay: 0s;     }
.typing-indicator__dot:nth-child(2) { animation-delay: 0.16s;  }
.typing-indicator__dot:nth-child(3) { animation-delay: 0.32s;  }

/* ============================================================
   4. Unread badge – pulse animation on increment
   ============================================================ */
@keyframes badgePulse {
  0%, 100% { transform: scale(1);    box-shadow: 0 0 0 0 rgba(var(--color-accent-rgb, 99,102,241), 0.6); }
  50%       { transform: scale(1.25); box-shadow: 0 0 0 6px rgba(var(--color-accent-rgb, 99,102,241), 0); }
}

.unread-badge.has-unread-pulse {
  animation: badgePulse 0.6s ease-out 2;
}

/* ============================================================
   5. Conversation switch – cross-fade between chat views
   ============================================================ */
@keyframes chatViewFadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}

.chat-view.is-entering {
  animation: chatViewFadeIn 0.18s ease-out both;
}

/* ============================================================
   6. Mobile panel transitions – slide between list and chat
   ============================================================ */
@keyframes panelSlideInRight {
  from { transform: translateX(100%); }
  to   { transform: translateX(0);    }
}

@keyframes panelSlideOutLeft {
  from { transform: translateX(0);     }
  to   { transform: translateX(-100%); }
}

@media (max-width: 767px) {
  .messenger-v4__sidebar {
    transition: transform 0.25s ease-out;
  }

  .messenger-v4__chat.is-entering {
    animation: panelSlideInRight 0.25s ease-out both;
  }

  .messenger-v4__sidebar.is-leaving {
    animation: panelSlideOutLeft 0.25s ease-out both;
  }
}

/* ============================================================
   7. Emoji reactions – pop + scale on add
   ============================================================ */
@keyframes reactionPop {
  0%   { transform: scale(0);    opacity: 0; }
  60%  { transform: scale(1.35); opacity: 1; }
  100% { transform: scale(1);    opacity: 1; }
}

.reaction-pill.is-entering {
  animation: reactionPop 0.28s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

/* ============================================================
   8. Read receipts – checkmark transitions from grey → blue
   ============================================================ */
.read-receipt__icon {
  transition: color 0.3s ease, opacity 0.3s ease;
  color: var(--color-text-muted, #9ca3af);
}

.read-receipt__icon--read {
  color: var(--color-primary, #6366f1);
}

/* ============================================================
   9. Online presence – green dot fade-in / fade-out
   ============================================================ */
@keyframes presenceFadeIn {
  from { opacity: 0; transform: scale(0.6); }
  to   { opacity: 1; transform: scale(1);   }
}

.presence-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  transition: background-color 0.4s ease, opacity 0.4s ease;
}

.presence-dot--online {
  background-color: #22c55e;
  animation: presenceFadeIn 0.3s ease-out both;
}

.presence-dot--offline {
  background-color: var(--color-text-muted, #9ca3af);
  opacity: 0.5;
}

/* ============================================================
   10. Glass effects – frosted glass cards
   ============================================================ */
.glass-card {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(16px) saturate(180%);
  -webkit-backdrop-filter: blur(16px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 16px;
}

.messenger-v4__sidebar,
.messenger-v4__chat {
  backdrop-filter: blur(12px) saturate(160%);
  -webkit-backdrop-filter: blur(12px) saturate(160%);
}

/* Conversation list items – subtle hover glass lift */
.conversation-item,
.conversation-list__item {
  transition: background 0.15s ease, transform 0.15s ease, box-shadow 0.15s ease;
}

.conversation-item:hover,
.conversation-list__item:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateX(2px);
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
}

/* Active / selected conversation */
.conversation-item.is-active,
.conversation-list__item.is-active {
  background: rgba(99, 102, 241, 0.15);
  border-left: 3px solid var(--color-primary, #6366f1);
}
