<!DOCTYPE html>
<html lang='en-GB'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Users â€” EventFlow admin</title>
<link rel='stylesheet' href='/assets/css/styles.css'>
<link rel='stylesheet' href='/assets/css/eventflow-17.0.0.css'>
<link rel='stylesheet' href='/assets/css/utilities.css'>
<link rel='stylesheet' href='/assets/css/components.css'>
<link rel='stylesheet' href='/assets/css/animations.css'>
<link rel='icon' href='/favicon.svg'>
<style>
  body{background:#0b0b0b;color:#f5f5f5;}
  .section{background:#0b0b0b;}
  .container{background:#0b0b0b;}
  .card{background:#111;border:1px solid #27272a;padding:1.5rem;border-radius:8px;}
  .table{background:#111;border-collapse:collapse;width:100%;}
  .table td,.table th{border:1px solid #333;color:#f5f5f5;padding:12px;}
  .table th{background:#161616;font-weight:600;}
  .table tbody tr:hover{background:#1a1a1a;}
  .small{color:#a1a1aa;}
  .footer{background:#0b0b0b;color:#f5f5f5;border-top:1px solid #27272a;}
  .header{background:#0b0b0b;border-bottom:1px solid #27272a;}
  .nav-menu{background:#0b0b0b;}
  .nav-menu a{color:#f5f5f5;}
  .nav-menu a:hover{color:#60a5fa;}
  code{background:#27272a;color:#fbbf24;padding:2px 6px;border-radius:3px;}
  a{color:#60a5fa;}
  a:hover{color:#93c5fd;}
  h1, h2, h3{color:#f5f5f5;}
  p{color:#f5f5f5;}
</style>
</head>
<body>
<header class="header" role="banner">
  <div class="container header-inner">
    <a class="brand" href="/" aria-label="EventFlow home">
      <span class="logo" aria-hidden="true"></span>
      <span class="brand-text">EventFlow</span>
    </a>
    <div class="header-actions">
      <nav class="nav nav-inline" aria-label="Quick navigation">
        <a href="/start.html" class="nav-link nav-main">Plan</a>
        <a href="/suppliers.html" class="nav-link nav-main">Suppliers</a>
        <a href="/auth.html" class="nav-link nav-main nav-main-login">Log in</a>
      </nav>
      <button id="theme-toggle" class="icon-button" type="button" aria-label="Toggle dark mode">
        <span class="theme-icon" aria-hidden="true">
          <span class="theme-icon-sun" aria-hidden="true">â˜€</span>
          <span class="theme-icon-moon" aria-hidden="true">ðŸŒ™</span>
        </span>
      </button>
      <button id="burger" class="nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false">
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
      </button>
    </div>
  </div>
  <nav class="nav nav-menu" aria-label="Primary navigation">
    <a href="/start.html">Plan an Event</a>
    <a href="/suppliers.html">Suppliers</a>
    <a href="/plan.html">My Plan</a>
    <a href="/for-suppliers.html">For Suppliers</a>
    <a href="/faq.html">FAQ</a>
    <a href="/settings.html">Settings</a>
    <a href="/auth.html" id="nav-auth">Sign in</a>
    <a href="#" id="nav-dashboard" style="display:none">Dashboard</a>
    <a href="#" id="nav-signout" style="display:none">Sign out</a>
  </nav>
</header>
<script src="/assets/js/auth-nav.js" defer></script>
<main class="section">
  <div class="container">
    <h1>Users</h1>
    <p class="small">Overview of all accounts registered on EventFlow.</p>
    <div class="card">
      <div class="small" id="user-summary">Loadingâ€¦</div>
      <div style="overflow-x:auto;margin-top:10px">
        <table class="table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Verified</th>
              <th>Marketing</th>
              <th>Joined</th>
              <th>Last login</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="7" class="small">Loadingâ€¦</td></tr>
          </tbody>
        </table>
      </div>
      <p class="small" style="margin-top:8px">
        Data is read-only here. To remove a user you can edit <code>data/users.json</code> on the server.
      </p>
      <p class="small" style="margin-top:4px">
        <a href="/api/admin/marketing-export" target="_blank" rel="noopener">Download marketing list (CSV)</a>
      </p>
    </div>
  </div>
</main>
<footer class="footer" role="contentinfo">
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
    <div><strong>EventFlow</strong><br><span class="small">Event planning made simple.</span></div>
    <div class="version">Version: v17.0.0</div>
    <div class="small"><a href="/credits.html">Credits</a> Â· <a href="/contact.html">Contact</a> Â· <a href="/terms.html">Terms</a> Â· <a href="/privacy.html">Privacy</a></div>
  </div>
</footer>
<script src="/assets/js/app.js"></script>
<script>window.__EF_PAGE__='admin_users'</script>
<script>
// Standalone admin users loader (doesn't depend on app.js functions)
(function() {
  async function loadAdminUsers() {
    var summary = document.getElementById('user-summary');
    var tbody = document.querySelector('table.table tbody');
    if(!summary || !tbody) return;

    summary.textContent = 'Loading usersâ€¦';

    try {
      const response = await fetch('/api/admin/users');
      if (!response.ok) {
        throw new Error('Failed to load users');
      }
      const data = await response.json();
      const items = (data && data.items) || [];

      summary.textContent = items.length
        ? (items.length + ' user' + (items.length === 1 ? '' : 's') + ' registered.')
        : 'No users found.';

      if (!items.length) {
        tbody.innerHTML = '<tr><td colspan="7" class="small">No users found.</td></tr>';
        return;
      }

      function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      function formatDate(dateStr) {
        if (!dateStr) return 'Never';
        try {
          return new Date(dateStr).toLocaleString();
        } catch(e) {
          return dateStr;
        }
      }

      tbody.innerHTML = items.map(function(u){
        return '<tr>'
          + '<td>' + escapeHtml(u.name || '') + '</td>'
          + '<td>' + escapeHtml(u.email || '') + '</td>'
          + '<td>' + escapeHtml(u.role || '') + '</td>'
          + '<td>' + (u.verified ? 'Yes' : 'No') + '</td>'
          + '<td>' + (u.marketingOptIn ? 'Yes' : 'No') + '</td>'
          + '<td>' + formatDate(u.createdAt) + '</td>'
          + '<td>' + formatDate(u.lastLoginAt) + '</td>'
          + '</tr>';
      }).join('');
    } catch(e) {
      console.error('Admin users load failed', e);
      summary.textContent = 'Error loading users';
      tbody.innerHTML = '<tr><td colspan="7" class="small" style="color:#ef4444;">Failed to load users. Please make sure you are logged in as an admin.</td></tr>';
    }
  }

  // Load when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadAdminUsers);
  } else {
    loadAdminUsers();
  }
})();
</script>
<script src="/assets/js/components/footer-nav.js" defer></script>
</body>
</html>
