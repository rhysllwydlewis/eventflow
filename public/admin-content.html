<!DOCTYPE html>
<html lang='en-GB'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Content Management — EventFlow Admin</title>
<link rel='stylesheet' href='/assets/css/styles.css'>
<link rel='stylesheet' href='/assets/css/eventflow-17.0.0.css'>
  <link rel="stylesheet" href="/assets/css/admin.css">
  <link rel="stylesheet" href="/assets/css/admin-enhanced.css">
<link rel='stylesheet' href='/assets/css/utilities.css'>
<link rel='stylesheet' href='/assets/css/components.css'>
<link rel='stylesheet' href='/assets/css/animations.css'>
<link rel='icon' href='/favicon.svg'>
</head>
<body>
<aside class="admin-sidebar" id="adminSidebar">
  <div class="admin-sidebar-header">
    <h3>Admin Panel</h3>
    <button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle sidebar">☰</button>
  </div>
  <nav class="admin-sidebar-nav">
    <a href="/admin.html" class="admin-nav-link">
      <span class="nav-icon">■</span>
      <span class="nav-label">Dashboard</span>
    </a>
    <a href="/admin-users.html" class="admin-nav-link">
      <span class="nav-icon">◉</span>
      <span class="nav-label">Users</span>
      <span class="nav-badge" id="newUsersCount"></span>
    </a>
    <a href="/admin-packages.html" class="admin-nav-link">
      <span class="nav-icon">▣</span>
      <span class="nav-label">Packages</span>
    </a>
    <a href="/admin-photos.html" class="admin-nav-link">
      <span class="nav-icon">◈</span>
      <span class="nav-label">Photos</span>
      <span class="nav-badge badge-warning" id="pendingPhotosCount"></span>
    </a>
    <a href="/admin-tickets.html" class="admin-nav-link">
      <span class="nav-icon">▤</span>
      <span class="nav-label">Tickets</span>
      <span class="nav-badge badge-danger" id="openTicketsCount"></span>
    </a>
    <a href="/admin-reports.html" class="admin-nav-link">
      <span class="nav-icon">▲</span>
      <span class="nav-label">Reports</span>
    </a>
    <a href="/admin-audit.html" class="admin-nav-link">
      <span class="nav-icon">☰</span>
      <span class="nav-label">Audit Log</span>
    </a>
    <a href="/admin-homepage.html" class="admin-nav-link">
      <span class="nav-icon">⌂</span>
      <span class="nav-label">Homepage</span>
    </a>
    <a href="/admin-payments.html" class="admin-nav-link">
      <span class="nav-icon">▬</span>
      <span class="nav-label">Payments</span>
    </a>
    <a href="/admin-content.html" class="admin-nav-link">
      <span class="nav-icon">✎</span>
      <span class="nav-label">Content</span>
    </a>
    <a href="/admin-settings.html" class="admin-nav-link">
      <span class="nav-icon">⚙</span>
      <span class="nav-label">Settings</span>
    </a>
  </nav>
</aside>

<main class="section">
  <div class="container">
    <div class="flex-between-mb">
      <h1 class="my-0">Content Management</h1>
      <button class="btn btn-secondary" onclick="location.href='/admin.html'">← Back to Dashboard</button>
    </div>
    
    <div class="tab-buttons">
      <button class="tab-button active" data-tab="homepage">Homepage</button>
      <button class="tab-button" data-tab="announcements">Announcements</button>
      <button class="tab-button" data-tab="faqs">FAQs</button>
      <button class="tab-button" data-tab="featured">Featured Packages</button>
    </div>
    
    <!-- Homepage Content Tab -->
    <div id="homepage" class="tab-content active">
      <div class="card">
        <h2>Homepage Hero Section</h2>
        <form id="heroForm">
          <div class="form-row">
            <label for="heroTitle">Hero Title</label>
            <input type="text" id="heroTitle" placeholder="Plan Your Perfect Event">
          </div>
          
          <div class="form-row">
            <label for="heroSubtitle">Hero Subtitle</label>
            <textarea id="heroSubtitle" rows="2" placeholder="Discover amazing suppliers and packages for your special day"></textarea>
          </div>
          
          <div class="form-row">
            <label for="heroCTA">Call-to-Action Text</label>
            <input type="text" id="heroCTA" placeholder="Start Planning">
          </div>
          
          <div class="action-buttons">
            <button type="submit" class="btn btn-primary">Save Homepage Content</button>
            <button type="button" class="btn btn-secondary" id="previewHero">Preview</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Announcements Tab -->
    <div id="announcements" class="tab-content">
      <div class="card">
        <h2>Site-Wide Announcements</h2>
        <p class="small">Create announcements that appear at the top of the site for all users.</p>
        
        <button class="btn btn-success" id="addAnnouncementBtn" class="mb-1">+ Add Announcement</button>
        
        <div id="announcementsList">
          <p class="small">Loading announcements...</p>
        </div>
      </div>
    </div>
    
    <!-- FAQs Tab -->
    <div id="faqs" class="tab-content">
      <div class="card">
        <h2>Manage FAQs</h2>
        <p class="small">Add, edit, or remove frequently asked questions.</p>
        
        <button class="btn btn-success" id="addFAQBtn" class="mb-1">+ Add FAQ</button>
        
        <div id="faqsList">
          <p class="small">Loading FAQs...</p>
        </div>
      </div>
    </div>
    
    <!-- Featured Packages Tab -->
    <div id="featured" class="tab-content">
      <div class="card">
        <h2>Featured Packages</h2>
        <p class="small">Select packages to feature on the homepage.</p>
        
        <div id="featuredPackagesList">
          <p class="small">Loading packages...</p>
        </div>
      </div>
    </div>
  </div>
</main>

<footer class="footer" role="contentinfo">
  <div class="container flex-between">
    <div><strong>EventFlow</strong><br><span class="small">Admin Panel</span></div>
    <div class="small"><a href="/admin.html">Dashboard</a> · <a href="/admin-users.html">Users</a></div>
  </div>
</footer>

<script src="/assets/js/admin-shared.js"></script>
<script>
(function() {
  // Tab switching
  document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
      const tabName = button.dataset.tab;
      
      // Update active states
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      
      button.classList.add('active');
      document.getElementById(tabName).classList.add('active');
    });
  });
  
  // Homepage hero form
  document.getElementById('heroForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const data = {
      title: document.getElementById('heroTitle').value,
      subtitle: document.getElementById('heroSubtitle').value,
      ctaText: document.getElementById('heroCTA').value,
    };
    
    try {
      await AdminShared.api('/api/admin/content/homepage', 'PUT', data);
      AdminShared.showToast('Homepage content updated successfully', 'success');
    } catch (err) {
      AdminShared.showToast(`Failed to update: ${err.message}`, 'error');
    }
  });
  
  // Preview hero
  document.getElementById('previewHero').addEventListener('click', () => {
    window.open('/', '_blank');
  });
  
  // Load homepage content
  async function loadHomepageContent() {
    try {
      const content = await AdminShared.api('/api/admin/content/homepage');
      document.getElementById('heroTitle').value = content.title || '';
      document.getElementById('heroSubtitle').value = content.subtitle || '';
      document.getElementById('heroCTA').value = content.ctaText || '';
    } catch (err) {
      console.error('Failed to load homepage content:', err);
    }
  }
  
  // Add announcement
  document.getElementById('addAnnouncementBtn').addEventListener('click', () => {
    showAnnouncementModal();
  });
  
  function showAnnouncementModal(announcement = null) {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;';
    
    modal.innerHTML = `
      <div class="modal modal-medium">
        <h3>${announcement ? 'Edit' : 'Add'} Announcement</h3>
        <form id="announcementForm">
          <div class="form-row">
            <label>Message</label>
            <textarea id="announcementMessage" rows="3" required>${announcement ? AdminShared.escapeHtml(announcement.message) : ''}</textarea>
          </div>
          
          <div class="form-row">
            <label>Type</label>
            <select id="announcementType">
              <option value="info" ${announcement && announcement.type === 'info' ? 'selected' : ''}>Info</option>
              <option value="warning" ${announcement && announcement.type === 'warning' ? 'selected' : ''}>Warning</option>
              <option value="success" ${announcement && announcement.type === 'success' ? 'selected' : ''}>Success</option>
            </select>
          </div>
          
          <div class="form-row">
            <label>
              <input type="checkbox" id="announcementActive" ${announcement && announcement.active ? 'checked' : ''}>
              Active (visible to users)
            </label>
          </div>
          
          <div class="action-buttons">
            <button type="submit" class="btn btn-primary">${announcement ? 'Update' : 'Create'} Announcement</button>
            <button type="button" class="btn btn-secondary" id="closeModal">Cancel</button>
          </div>
        </form>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    modal.querySelector('#closeModal').addEventListener('click', () => modal.remove());
    modal.addEventListener('click', (e) => {
      if (e.target === modal) modal.remove();
    });
    
    modal.querySelector('#announcementForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        message: document.getElementById('announcementMessage').value,
        type: document.getElementById('announcementType').value,
        active: document.getElementById('announcementActive').checked,
      };
      
      try {
        if (announcement) {
          await AdminShared.api(`/api/admin/content/announcements/${announcement.id}`, 'PUT', data);
        } else {
          await AdminShared.api('/api/admin/content/announcements', 'POST', data);
        }
        AdminShared.showToast('Announcement saved successfully', 'success');
        modal.remove();
        loadAnnouncements();
      } catch (err) {
        AdminShared.showToast(`Failed to save: ${err.message}`, 'error');
      }
    });
  }
  
  // Load announcements
  async function loadAnnouncements() {
    try {
      const announcements = await AdminShared.api('/api/admin/content/announcements');
      const container = document.getElementById('announcementsList');
      
      if (!announcements || announcements.length === 0) {
        container.innerHTML = '<p class="small">No announcements yet. Click "Add Announcement" to create one.</p>';
        return;
      }
      
      container.innerHTML = announcements.map(a => {
        const escapedId = AdminShared.escapeHtml(a.id);
        return `
          <div class="announcement-item" data-id="${escapedId}">
            <div class="flex-between-start">
              <div class="flex-1">
                <strong>${AdminShared.escapeHtml(a.message)}</strong>
                <div class="small" class="mt-025">
                  Type: ${a.type} • ${a.active ? '<span style="color:#22c55e;">Active</span>' : '<span style="color:#6b7280;">Inactive</span>'}
                </div>
              </div>
              <div class="flex-gap">
                <button class="btn btn-secondary btn-small" data-action="edit" data-id="${escapedId}">Edit</button>
                <button class="btn btn-danger btn-small" data-action="delete" data-id="${escapedId}">Delete</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      // Add event delegation
      container.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const action = e.target.dataset.action;
          const id = e.target.dataset.id;
          if (action === 'edit') {
            editAnnouncement(id);
          } else if (action === 'delete') {
            deleteAnnouncement(id);
          }
        });
      });
    } catch (err) {
      document.getElementById('announcementsList').innerHTML = '<p class="small" style="color:#ef4444;">Failed to load announcements</p>';
    }
  }
  
  // Add FAQ
  document.getElementById('addFAQBtn').addEventListener('click', () => {
    showFAQModal();
  });
  
  function showFAQModal(faq = null) {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;';
    
    modal.innerHTML = `
      <div class="modal modal-medium">
        <h3>${faq ? 'Edit' : 'Add'} FAQ</h3>
        <form id="faqForm">
          <div class="form-row">
            <label>Question</label>
            <input type="text" id="faqQuestion" required value="${faq ? AdminShared.escapeHtml(faq.question) : ''}">
          </div>
          
          <div class="form-row">
            <label>Answer</label>
            <textarea id="faqAnswer" rows="4" required>${faq ? AdminShared.escapeHtml(faq.answer) : ''}</textarea>
          </div>
          
          <div class="form-row">
            <label>Category</label>
            <input type="text" id="faqCategory" placeholder="General" value="${faq ? AdminShared.escapeHtml(faq.category || '') : ''}">
          </div>
          
          <div class="action-buttons">
            <button type="submit" class="btn btn-primary">${faq ? 'Update' : 'Create'} FAQ</button>
            <button type="button" class="btn btn-secondary" id="closeModal">Cancel</button>
          </div>
        </form>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    modal.querySelector('#closeModal').addEventListener('click', () => modal.remove());
    modal.addEventListener('click', (e) => {
      if (e.target === modal) modal.remove();
    });
    
    modal.querySelector('#faqForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        question: document.getElementById('faqQuestion').value,
        answer: document.getElementById('faqAnswer').value,
        category: document.getElementById('faqCategory').value || 'General',
      };
      
      try {
        if (faq) {
          await AdminShared.api(`/api/admin/content/faqs/${faq.id}`, 'PUT', data);
        } else {
          await AdminShared.api('/api/admin/content/faqs', 'POST', data);
        }
        AdminShared.showToast('FAQ saved successfully', 'success');
        modal.remove();
        loadFAQs();
      } catch (err) {
        AdminShared.showToast(`Failed to save: ${err.message}`, 'error');
      }
    });
  }
  
  // Load FAQs
  async function loadFAQs() {
    try {
      const faqs = await AdminShared.api('/api/admin/content/faqs');
      const container = document.getElementById('faqsList');
      
      if (!faqs || faqs.length === 0) {
        container.innerHTML = '<p class="small">No FAQs yet. Click "Add FAQ" to create one.</p>';
        return;
      }
      
      container.innerHTML = faqs.map(f => {
        const escapedId = AdminShared.escapeHtml(f.id);
        return `
          <div class="faq-item" data-id="${escapedId}">
            <div class="flex-between-start">
              <div class="flex-1">
                <strong>${AdminShared.escapeHtml(f.question)}</strong>
                <p class="small" style="margin:0.5rem 0 0 0;">${AdminShared.escapeHtml(f.answer)}</p>
                <div class="small" style="margin-top:0.5rem;color:#9ca3af;">Category: ${AdminShared.escapeHtml(f.category || 'General')}</div>
              </div>
              <div class="flex-gap">
                <button class="btn btn-secondary btn-small" data-action="edit" data-id="${escapedId}">Edit</button>
                <button class="btn btn-danger btn-small" data-action="delete" data-id="${escapedId}">Delete</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      // Add event delegation
      container.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const action = e.target.dataset.action;
          const id = e.target.dataset.id;
          if (action === 'edit') {
            editFAQ(id);
          } else if (action === 'delete') {
            deleteFAQ(id);
          }
        });
      });
    } catch (err) {
      document.getElementById('faqsList').innerHTML = '<p class="small" style="color:#ef4444;">Failed to load FAQs</p>';
    }
  }
  
  // Load featured packages
  async function loadFeaturedPackages() {
    try {
      const packages = await AdminShared.api('/api/admin/packages?featured=true');
      const container = document.getElementById('featuredPackagesList');
      
      if (!packages || !packages.items || packages.items.length === 0) {
        container.innerHTML = '<p class="small">No featured packages. Go to Package Management to feature packages.</p>';
        return;
      }
      
      container.innerHTML = packages.items.map(p => {
        const escapedId = AdminShared.escapeHtml(p.id);
        return `
          <div style="padding:1rem;background:#f9fafb;border-radius:4px;margin-bottom:0.5rem;" data-id="${escapedId}">
            <div class="flex-between">
              <div>
                <strong>${AdminShared.escapeHtml(p.title)}</strong>
                <div class="small">Supplier: ${AdminShared.escapeHtml(p.supplierName || 'Unknown')}</div>
              </div>
              <button class="btn btn-danger btn-small" data-action="unfeature" data-id="${escapedId}">Remove Featured</button>
            </div>
          </div>
        `;
      }).join('');
      
      // Add event delegation
      container.querySelectorAll('button[data-action="unfeature"]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.dataset.id;
          unfeaturePackage(id);
        });
      });
    } catch (err) {
      document.getElementById('featuredPackagesList').innerHTML = '<p class="small" style="color:#ef4444;">Failed to load featured packages</p>';
    }
  }
  
  // Global functions for inline onclick handlers
  window.editAnnouncement = async (id) => {
    try {
      const announcement = await AdminShared.api(`/api/admin/content/announcements/${id}`);
      showAnnouncementModal(announcement);
    } catch (err) {
      AdminShared.showToast(`Failed to load announcement: ${err.message}`, 'error');
    }
  };
  
  window.deleteAnnouncement = async (id) => {
    if (!AdminShared.confirm('Delete this announcement?')) return;
    
    try {
      await AdminShared.api(`/api/admin/content/announcements/${id}`, 'DELETE');
      AdminShared.showToast('Announcement deleted', 'success');
      loadAnnouncements();
    } catch (err) {
      AdminShared.showToast(`Failed to delete: ${err.message}`, 'error');
    }
  };
  
  window.editFAQ = async (id) => {
    try {
      const faq = await AdminShared.api(`/api/admin/content/faqs/${id}`);
      showFAQModal(faq);
    } catch (err) {
      AdminShared.showToast(`Failed to load FAQ: ${err.message}`, 'error');
    }
  };
  
  window.deleteFAQ = async (id) => {
    if (!AdminShared.confirm('Delete this FAQ?')) return;
    
    try {
      await AdminShared.api(`/api/admin/content/faqs/${id}`, 'DELETE');
      AdminShared.showToast('FAQ deleted', 'success');
      loadFAQs();
    } catch (err) {
      AdminShared.showToast(`Failed to delete: ${err.message}`, 'error');
    }
  };
  
  window.unfeaturePackage = async (id) => {
    if (!AdminShared.confirm('Remove this package from featured?')) return;
    
    try {
      await AdminShared.api(`/api/admin/packages/${id}`, 'PUT', { featured: false });
      AdminShared.showToast('Package unfeatured', 'success');
      loadFeaturedPackages();
    } catch (err) {
      AdminShared.showToast(`Failed to update: ${err.message}`, 'error');
    }
  };
  
  // Initial load
  loadHomepageContent();
  loadAnnouncements();
  loadFAQs();
  loadFeaturedPackages();
})();
</script>
</body>
</html>
