<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes"
    />
    <meta name="theme-color" content="#0B8073" />

    <!-- Canonical Base URL for SEO helper (ensures correct URLs in all environments) -->
    <script>window.EF_CANONICAL_BASE = 'https://event-flow.co.uk';</script>
    
    <title>Marketplace - EventFlow | Buy & Sell Pre-Loved Event Items</title>
    <meta
      name="description"
      content="Buy and sell pre-loved event items on the EventFlow marketplace. Dresses, d√©cor, AV gear and more. Free to list, UK-focused, no platform fees."
    />
    <link rel="canonical" href="https://event-flow.co.uk/marketplace" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://event-flow.co.uk/marketplace" />
    <meta property="og:title" content="Event Marketplace ‚Äî Buy & Sell Pre-Loved Event Items" />
    <meta
      property="og:description"
      content="Buy and sell pre-loved event items. UK-focused, no platform fees."
    />
    <meta
      property="og:image"
      content="https://event-flow.co.uk/assets/images/eventflow-og-image.jpg"
    />
    <meta property="og:site_name" content="EventFlow" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://event-flow.co.uk/marketplace" />
    <meta name="twitter:title" content="Event Marketplace ‚Äî Buy & Sell Pre-Loved Event Items" />
    <meta
      name="twitter:description"
      content="Buy and sell pre-loved event items. UK-focused, no platform fees."
    />
    <meta
      name="twitter:image"
      content="https://event-flow.co.uk/assets/images/eventflow-og-image.jpg"
    />

    <!-- DNS Prefetch & Preconnect for external resources -->
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Preload critical CSS -->
    <link rel="preload" href="/assets/css/tokens.css?v=18.1.1" as="style" />
    <link rel="preload" href="/assets/css/styles.css?v=18.1.1" as="style" />
    <link rel="preload" href="/assets/css/eventflow-17.0.0.css?v=18.1.1" as="style" />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/assets/css/tokens.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/styles.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/eventflow-17.0.0.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/utilities.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/components.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/animations.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/mobile-optimizations.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/ui-ux-fixes.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/navbar.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/marketplace.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/skeleton.css?v=18.1.1" />
    <link rel="stylesheet" href="/assets/css/p3-features.css?v=18.1.1" />
    <link rel="icon" href="/favicon.svg" />

    <!-- Schema.org structured data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Event Marketplace",
        "url": "https://event-flow.co.uk/marketplace",
        "description": "Buy and sell pre-loved event items ‚Äî dresses, d√©cor, AV gear and more. UK-focused marketplace with no platform fees.",
        "isPartOf": {
          "@type": "WebSite",
          "name": "EventFlow",
          "url": "https://event-flow.co.uk/"
        }
      }
    </script>
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- TOP NAVBAR - GOLD STANDARD REBUILD -->
<header class="ef-header" role="banner">
  <div class="ef-container">
    <div class="ef-header-content">
      <!-- Brand Logo - Enhanced Animated -->
      <a href="/" class="ef-brand" aria-label="EventFlow - Return to homepage">
        <div class="ef-logo" aria-hidden="true">
          <div class="ef-logo-inner"></div>
        </div>
        <span class="ef-brand-text">EventFlow</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="ef-nav-desktop" aria-label="Main navigation">
        <a href="/start" class="ef-nav-link">Plan</a>
        <a href="/suppliers" class="ef-nav-link">Suppliers</a>
        <a href="/marketplace" class="ef-nav-link">Marketplace</a>
        <a href="/blog" class="ef-nav-link">Guides</a>
        <a href="/pricing" class="ef-nav-link">Pricing</a>
      </nav>

      <!-- Actions -->
      <div class="ef-header-actions">
        <!-- Notification Bell (hidden by default, shown when logged in) -->
        <button 
          id="ef-notification-btn" 
          class="ef-icon-btn" 
          type="button" 
          aria-label="View notifications"
          style="display: none;"
        >
          <svg class="ef-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
          <span id="ef-notification-badge" class="ef-badge" style="display: none;">0</span>
        </button>

        <!-- Auth Button (Desktop) -->
        <a href="/auth" id="ef-auth-link" class="ef-btn ef-btn-primary">
          Log in
        </a>

        <!-- Dashboard Link (Desktop, hidden by default) -->
        <a href="#" id="ef-dashboard-link" class="ef-nav-link" style="display: none;">
          Dashboard
        </a>

        <!-- Mobile Menu Toggle -->
        <button 
          id="ef-mobile-toggle" 
          class="ef-mobile-toggle" 
          type="button"
          aria-label="Toggle menu"
          aria-expanded="false"
          aria-controls="ef-mobile-menu"
        >
          <span class="ef-toggle-line"></span>
          <span class="ef-toggle-line"></span>
          <span class="ef-toggle-line"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="ef-mobile-menu" class="ef-mobile-menu" role="dialog" aria-modal="true" aria-label="Mobile navigation">
    <nav class="ef-mobile-nav" aria-label="Primary navigation">
      <a href="/start" class="ef-mobile-link">Plan an Event</a>
      <a href="/suppliers" class="ef-mobile-link">Browse Suppliers</a>
      <a href="/marketplace" class="ef-mobile-link">Marketplace</a>
      <a href="/blog" class="ef-mobile-link">Guides</a>
      <a href="/pricing" class="ef-mobile-link">Pricing</a>
      <a href="/for-suppliers" class="ef-mobile-link">For Suppliers</a>
      <a href="/faq" class="ef-mobile-link">FAQ</a>
      <div class="ef-mobile-divider"></div>
      <a href="/auth" id="ef-mobile-auth" class="ef-mobile-link ef-mobile-primary">Log in</a>
      <a href="#" id="ef-mobile-dashboard" class="ef-mobile-link" style="display: none;">Dashboard</a>
      <a href="#" id="ef-mobile-logout" class="ef-mobile-link" style="display: none;">Log out</a>
    </nav>
  </div>
</header>
    <!-- PHASE 2: Error boundary (must load before other components) -->
    <script src="/assets/js/utils/global-error-handler.js" defer></script>
    
    <!-- PHASE 3: Core components -->
    <script src="/assets/js/components/LoadingSpinner.js" defer></script>
    
    <!-- PHASE 4: Feature-specific -->
    <script src="/assets/js/utils/auth-state.js" defer></script>
    <script src="/assets/js/burger-menu.js" defer></script>
    <script src="/assets/js/navbar.js" defer></script>
    <script src="/assets/js/components.js" defer></script>
    <script src="/assets/js/animations.js" defer></script>
    <script src="/assets/js/notifications.js" defer></script>
    <script src="/assets/js/websocket-client.js" defer></script>

    <main id="main-content">
      <div class="marketplace-hero">
        <div class="container">
          <div class="hero-content">
            <nav class="breadcrumb" aria-label="Breadcrumb">
              <a href="/">Home</a> 
              <span aria-hidden="true">/</span> 
              <span aria-current="page">Marketplace</span>
            </nav>
            <h1>Event Marketplace</h1>
            <p class="hero-subtitle">
              Buy and sell pre-loved event items ‚Äî free to use, no platform fees
            </p>
          </div>
        </div>
      </div>

      <section class="section">
        <div class="container marketplace-container">
          <!-- Left Sidebar: Filters -->
          <aside class="marketplace-sidebar">
            <div class="card">
              <h2 style="margin-top: 0;">Filters</h2>
              
              <!-- Location Summary -->
              <div class="filter-group">
                <label class="filter-label">Location</label>
                <div class="location-summary" id="location-summary">
                  <span class="location-text">üìç All UK</span>
                  <button type="button" class="btn-change-location" id="btn-change-location" aria-label="Change location">Change</button>
                </div>
              </div>

              <!-- Search -->
              <div class="filter-group">
                <label for="marketplace-filter-query">Search</label>
                <input id="marketplace-filter-query" type="text" placeholder="e.g. wedding dress, speakers">
              </div>

              <!-- Category -->
              <div class="filter-group">
                <label for="marketplace-filter-category">Category</label>
                <select id="marketplace-filter-category">
                  <option value="">All categories</option>
                  <option value="attire">üëó Attire</option>
                  <option value="decor">üé® D√©cor</option>
                  <option value="av-equipment">üîä AV Equipment</option>
                  <option value="photography">üì∏ Photography</option>
                  <option value="party-supplies">üéâ Party Supplies</option>
                  <option value="florals">üå∏ Florals</option>
                </select>
              </div>

              <!-- Price -->
              <div class="filter-group">
                <label for="marketplace-filter-price">Price range</label>
                <select id="marketplace-filter-price">
                  <option value="">Any price</option>
                  <option value="0-50">Under ¬£50</option>
                  <option value="50-100">¬£50 - ¬£100</option>
                  <option value="100-250">¬£100 - ¬£250</option>
                  <option value="250-500">¬£250 - ¬£500</option>
                  <option value="500-plus">¬£500+</option>
                </select>
              </div>

              <!-- Condition -->
              <div class="filter-group">
                <label for="marketplace-filter-condition">Condition</label>
                <select id="marketplace-filter-condition">
                  <option value="">Any condition</option>
                  <option value="new">New / Unused</option>
                  <option value="like-new">Like New</option>
                  <option value="good">Good</option>
                  <option value="fair">Fair</option>
                </select>
              </div>

              <!-- My Listings Link -->
              <div class="filter-group" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border, #E7EAF0);">
                <a href="/my-marketplace-listings.html" class="btn-my-listings" id="my-listings-link" style="display: none;">
                  üìã My Listings
                </a>
              </div>
            </div>

            <!-- Quick Search Tips -->
            <div class="card" id="marketplace-quick-tips">
              <p class="small" style="margin: 0 0 0.75rem 0; font-weight: 600;">Popular searches:</p>
              <div style="display: flex; flex-direction: column; gap: 6px;">
                <button type="button" class="btn-quick-search" data-marketplace-search="wedding dress">Wedding Dress</button>
                <button type="button" class="btn-quick-search" data-marketplace-search="table decorations">Table D√©cor</button>
                <button type="button" class="btn-quick-search" data-marketplace-search="sound system">Sound System</button>
              </div>
            </div>
          </aside>

          <!-- Main Content: Listings -->
          <main class="marketplace-main">
            <div class="marketplace-header">
              <div>
                <h2 style="margin: 0 0 0.5rem 0;">Browse marketplace listings</h2>
                <div id="marketplace-result-count" class="small"></div>
              </div>
              <div class="marketplace-actions">
                <select id="marketplace-sort" class="sort-select">
                  <option value="newest">Newest</option>
                  <option value="priceAsc">Price: Low to High</option>
                  <option value="priceDesc">Price: High to Low</option>
                  <option value="relevance">Most Relevant</option>
                </select>
                <button type="button" class="btn-view-toggle" id="marketplace-view-toggle">
                  <span id="view-icon">‚äû</span> Grid
                </button>
              </div>
            </div>

            <!-- Marketplace Items -->
            <div id="marketplace-results" class="marketplace-grid">
              <div class="card"><p style="text-align: center; padding: 2rem;">Loading listings...</p></div>
            </div>
          </main>
        </div>
      </section>

      <!-- Mobile Filter Toggle Button -->
      <button class="mobile-filter-toggle" id="mobile-filter-toggle" aria-label="Toggle filters">
        <span>Filters</span>
      </button>

      <section class="section section--muted">
        <div class="container">
          <div class="card" id="marketplace-results-tips" style="text-align: center;">
            <h3 class="h4">Browse local listings</h3>
            <p class="small">
              Filter by category, price, or condition to narrow your search. Save items to your favourites by creating a free account.
            </p>
          </div>

          <div class="card" id="marketplace-cta-section">
            <h3 style="text-align: center;">Ready to buy or sell?</h3>
            <p class="small" style="margin: 1rem 0; text-align: center;">
              Create a free account to list items for sale or message sellers about listings you're interested in.
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem;">
              <a href="/auth" class="cta" id="auth-cta">Create Free Account</a>
              <button class="cta secondary" id="sell-item-btn">List an Item</button>
            </div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="container" style="max-width: 900px">
          <h2>How It Works</h2>
          <div class="cards">
            <div class="card">
              <h3>Physical Items Only</h3>
              <p class="small">
                Our marketplace is for physical event items ‚Äî wedding dresses, bridesmaid outfits, decorations, centrepieces, sound equipment, lighting rigs, and more. Services (catering, DJs, etc.) are listed separately in our Suppliers directory.
              </p>
            </div>
            <div class="card">
              <h3>Free to Use</h3>
              <p class="small">
                EventFlow charges no listing fees and no commission. List your items for free, and keep 100% of what you sell. Buyers pay no extra fees either ‚Äî just the price you agree.
              </p>
            </div>
            <div class="card">
              <h3>Direct Payment & Collection</h3>
              <p class="small">
                Payments and collection are arranged directly between buyer and seller. We recommend meeting in a safe public place or using secure payment methods like PayPal Goods & Services for buyer protection.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section class="section section--muted">
        <div class="container" style="max-width: 900px">
          <h2>What You Can Buy & Sell</h2>
          <div class="cards">
            <div class="card">
              <h3>üëó Attire</h3>
              <p class="small">
                Wedding dresses, bridesmaid dresses, suits, shoes, veils, and accessories
              </p>
            </div>
            <div class="card">
              <h3>üé® D√©cor</h3>
              <p class="small">
                Centrepieces, signage, table linens, backdrops, candles, and decorations
              </p>
            </div>
            <div class="card">
              <h3>üîä AV Equipment</h3>
              <p class="small">
                PA systems, microphones, speakers, lighting rigs, and DJ equipment
              </p>
            </div>
            <div class="card">
              <h3>üì∏ Photography</h3>
              <p class="small">
                Cameras, lenses, tripods, backdrops, and lighting equipment
              </p>
            </div>
            <div class="card">
              <h3>üéâ Party Supplies</h3>
              <p class="small">
                Props, games, sweet carts, chocolate fountains, and party favours
              </p>
            </div>
            <div class="card">
              <h3>üå∏ Florals</h3>
              <p class="small">
                Artificial flowers, vases, bouquet holders, and floral accessories
              </p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer" role="contentinfo">
      <div
        class="container"
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 10px;
          flex-wrap: wrap;
        "
      >
        <div>
          <strong>EventFlow</strong><br /><span class="small">Event planning made simple.</span>
        </div>
        <div class="version">Version: <span id="ef-version-label">loading‚Ä¶</span></div>
        <div class="small">
          <a href="/blog">Guides</a> ¬∑ <a href="/marketplace">Marketplace</a> ¬∑ <a href="/credits">Credits</a> ¬∑
          <a href="/contact">Contact</a> ¬∑
          <a href="/legal">Legal Hub</a>
        </div>
      </div>
    </footer>

<!-- BOTTOM NAVBAR - GOLD STANDARD REBUILD (Mobile Only) -->
<nav class="ef-bottom-nav" role="navigation" aria-label="Mobile bottom navigation">
  <a href="/start" class="ef-bottom-link" aria-label="Plan your event">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M12 20h9"/>
      <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
    </svg>
    <span class="ef-bottom-label">Plan</span>
  </a>
  
  <a href="/suppliers" class="ef-bottom-link" aria-label="Browse suppliers">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <circle cx="11" cy="11" r="8"/>
      <path d="m21 21-4.35-4.35"/>
    </svg>
    <span class="ef-bottom-label">Suppliers</span>
  </a>
  
  <a href="/blog" class="ef-bottom-link" aria-label="View guides">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
      <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
    </svg>
    <span class="ef-bottom-label">Guides</span>
  </a>
  
  <!-- Dashboard with notification badge (shown when logged in, replaces Alerts) -->
  <a href="#" id="ef-bottom-dashboard" class="ef-bottom-link" style="display: none;" aria-label="Go to dashboard">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <rect x="3" y="3" width="7" height="7" rx="1"/>
      <rect x="14" y="3" width="7" height="7" rx="1"/>
      <rect x="14" y="14" width="7" height="7" rx="1"/>
      <rect x="3" y="14" width="7" height="7" rx="1"/>
    </svg>
    <span class="ef-bottom-label">Dashboard</span>
    <span id="ef-bottom-dashboard-badge" class="ef-badge" style="display: none;">0</span>
  </a>
  
  <!-- Alerts button (shown when logged out) -->
  <a href="/blog" id="ef-bottom-alerts" class="ef-bottom-link" aria-label="View guides and alerts">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
      <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
    </svg>
    <span class="ef-bottom-label">Alerts</span>
  </a>
  
  <button 
    id="ef-bottom-menu" 
    class="ef-bottom-link" 
    type="button"
    aria-label="Open menu"
    aria-expanded="false"
    aria-controls="ef-mobile-menu"
  >
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <line x1="3" y1="12" x2="21" y2="12"/>
      <line x1="3" y1="6" x2="21" y2="6"/>
      <line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
    <span class="ef-bottom-label">Menu</span>
  </button>
</nav>

    <!-- Load core utilities -->
    <!-- Shortlist and Quote Request Components -->
    <script src="/assets/js/utils/shortlist-manager.js" type="module" defer></script>
    <script src="/assets/js/components/shortlist-drawer.js" type="module" defer></script>
    <script src="/assets/js/components/quote-request-modal.js" type="module" defer></script>
    <!-- Enhanced Marketplace Page -->
    <script src="/assets/js/pages/marketplace-init.js" type="module" defer></script>
    <script src="/assets/js/components/ErrorBoundary.js" defer></script>
    <script src="/assets/js/utils/keyboard-nav.js" defer></script>
    <script src="/assets/js/utils/pexels-client.js" defer></script>
    <script src="/assets/js/utils/image-optimizer.js" defer></script>
    <script src="/assets/js/utils/performance-monitor.js" defer></script>
    <script src="/assets/js/utils/seo-helper.js" defer></script>
    <script src="/assets/js/utils/mobile-enhancements.js" defer></script>

    <script src="/assets/js/app.js" defer></script>
    <script src="/assets/js/components/footer-nav.js" defer></script>
    <script src="/assets/js/cookie-consent.js" defer></script>
    <script src="/assets/js/marketplace.js" defer></script>
    
    <!-- Marketplace Category Filter Handler -->
    <script>
    (function() {
      'use strict';
      
      function initCategoryFilter() {
        const categorySelect = document.getElementById('marketplace-filter-category');
        const priceSelect = document.getElementById('marketplace-filter-price');
        const conditionSelect = document.getElementById('marketplace-filter-condition');
        
        if (!categorySelect) {
          return;
        }
        
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('category')) {
          categorySelect.value = urlParams.get('category');
        }
        
        function applyFilters() {
          const category = categorySelect.value;
          const price = priceSelect?.value || '';
          const condition = conditionSelect?.value || '';
          
          const params = new URLSearchParams();
          if (category) params.set('category', category);
          if (price) params.set('price', price);
          if (condition) params.set('condition', condition);
          
          const newUrl = params.toString() 
            ? `${window.location.pathname}?${params.toString()}`
            : window.location.pathname;
          
          window.history.pushState({ filters: { category, price, condition } }, '', newUrl);
          
          if (typeof window.fetchMarketplaceListings === 'function') {
            window.fetchMarketplaceListings({ category, price, condition });
          } else if (typeof window.loadMarketplaceItems === 'function') {
            window.loadMarketplaceItems({ category, price, condition });
          } else {
            window.location.href = newUrl;
          }
          
          updateResultsCount();
        }
        
        function updateResultsCount() {
          const resultsContainer = document.getElementById('marketplace-results') 
            || document.querySelector('.marketplace-grid')
            || document.querySelector('[data-marketplace-results]');
            
          if (resultsContainer) {
            const items = resultsContainer.querySelectorAll('.marketplace-item, .card, [data-listing-id]');
            const count = items.length;
            
            const countElement = document.getElementById('results-count') 
              || document.querySelector('.results-count')
              || document.querySelector('[data-results-count]');
              
            if (countElement) {
              countElement.textContent = count === 1 ? '1 item' : `${count} items`;
            }
          }
        }
        
        categorySelect.addEventListener('change', applyFilters);
        
        if (priceSelect) {
          priceSelect.addEventListener('change', applyFilters);
        }
        
        if (conditionSelect) {
          conditionSelect.addEventListener('change', applyFilters);
        }
        
        window.addEventListener('popstate', function(event) {
          if (event.state && event.state.filters) {
            categorySelect.value = event.state.filters.category || '';
            if (priceSelect) priceSelect.value = event.state.filters.price || '';
            if (conditionSelect) conditionSelect.value = event.state.filters.condition || '';
            applyFilters();
          }
        });
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCategoryFilter);
      } else {
        initCategoryFilter();
      }
    })();
    </script>
    
    <script defer>
      // Initialize core utilities
      document.addEventListener('DOMContentLoaded', function () {
        // Initialize error boundary
        window.errorBoundary = new ErrorBoundary({
          showErrorDetails: window.location.hostname === 'localhost',
        });

        // Update SEO for marketplace page
        if (window.seoHelper) {
          window.seoHelper.setAll({
            title: 'Event Marketplace ‚Äî Buy & Sell Pre-Loved Event Items',
            description:
              'Buy and sell pre-loved event items. UK-focused marketplace with no platform fees. Physical items only ‚Äî arrange payments directly.',
            keywords: ['event marketplace', 'wedding dress resale', 'event d√©cor', 'AV equipment', 'UK marketplace'],
            canonical: '/marketplace',
            type: 'website',
          });
        }
      });
    </script>
    <script src="/assets/js/utils/p3-features.js" defer></script>
    <script src="/assets/js/keyboard-shortcuts.js" defer></script>

    <!-- JadeAssist Chat Widget - Using local build with positioning API -->
    <script src="https://cdn.jsdelivr.net/gh/rhysllwydlewis/JadeAssist@abbf580487e0bcf7739a0857d4d940213fe2e176/packages/widget/dist/jade-widget.js" defer></script>
    <script src="/assets/js/jadeassist-init.v2.js" defer></script>
  </body>
</html>
