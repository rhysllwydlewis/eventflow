<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="EventFlow Chat - Real-time messaging for customers and suppliers">
  <title>Chat | EventFlow</title>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="/chat/css/chat.css">
  
  <!-- Favicon -->
  <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
  
  <!-- Preconnect for WebSocket -->
  <link rel="preconnect" href="/">
</head>
<body class="chat-page">
  
  <!-- Loading overlay -->
  <div id="appLoading" class="app-loading hidden">
    <div class="loading-spinner"></div>
    <p>Loading chat...</p>
  </div>
  
  <!-- Connection status -->
  <div id="connectionStatus" class="connection-status hidden">
    <span class="status-dot"></span>
    <span class="status-text">Connecting...</span>
  </div>
  
  <!-- Error toast -->
  <div id="errorToast" class="error-toast hidden">
    <span class="toast-message"></span>
  </div>
  
  <!-- Main chat container -->
  <div class="chat-container" id="chatContainer">
    
    <!-- Left sidebar - Conversation list -->
    <aside class="chat-sidebar" id="chatSidebar">
      <div class="chat-sidebar-header">
        <h1 class="chat-sidebar-title">Messages</h1>
        
        <!-- Search bar -->
        <div class="chat-search">
          <svg class="chat-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="text" 
            class="chat-search-input" 
            id="conversationSearch"
            placeholder="Search conversations..."
            autocomplete="off"
          >
        </div>
        
        <!-- Filter tabs -->
        <div class="chat-filters" id="chatFilters">
          <button class="filter-tab active" data-filter="all">All</button>
          <button class="filter-tab" data-filter="unread">Unread</button>
          <button class="filter-tab" data-filter="pinned">Pinned</button>
          <button class="filter-tab" data-filter="archived">Archived</button>
        </div>
      </div>
      
      <!-- Conversations list -->
      <div class="chat-conversations" id="conversationList">
        <!-- Loading skeleton -->
        <div class="skeleton skeleton-conversation"></div>
        <div class="skeleton skeleton-conversation"></div>
        <div class="skeleton skeleton-conversation"></div>
      </div>
      
      <!-- New conversation button (fixed at bottom) -->
      <div style="padding: var(--space-4); border-top: 1px solid var(--glass-border);">
        <button class="empty-state-btn" id="newConversationBtn" style="width: 100%;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 8px;">
            <path d="M12 5v14M5 12h14"></path>
          </svg>
          New Message
        </button>
      </div>
    </aside>
    
    <!-- Right panel - Chat view -->
    <main class="chat-main" id="chatMain">
      <!-- Chat view wrapper for component -->
      <div id="chatView">
        <!-- Empty state (shown when no conversation selected) -->
        <div class="chat-empty-state" id="emptyState">
          <div class="empty-state-icon">ðŸ’¬</div>
          <h2 class="empty-state-title">Select a conversation</h2>
          <p class="empty-state-text">
            Choose a conversation from the list to start messaging, or click "New Message" to start a new chat.
          </p>
        </div>
        
        <!-- Chat header (hidden initially) -->
        <div class="chat-header hidden" id="chatHeader">
          <!-- Back button for mobile -->
          <button class="chat-input-btn chat-header-back" id="backBtn" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"></path>
            </svg>
          </button>
          
          <div class="chat-header-avatar" id="chatHeaderAvatar">
            <span>?</span>
          </div>
          <div class="chat-header-info">
            <div class="chat-header-name" id="chatHeaderName">Select a conversation</div>
            <div class="chat-header-status">
              <span class="status-indicator" id="chatHeaderStatus"></span>
              <span id="chatHeaderStatusText">Offline</span>
            </div>
            <div class="chat-header-context" id="chatHeaderContext"></div>
          </div>
          
          <!-- Header actions -->
          <div style="display: flex; gap: var(--space-2);">
            <button class="chat-input-btn" id="chatOptionsBtn" title="Options">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="12" cy="5" r="1"></circle>
                <circle cx="12" cy="19" r="1"></circle>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- Messages area (hidden initially) -->
        <div class="chat-messages hidden" id="messagesContainer">
          <!-- Messages will be inserted here -->
        </div>
        
        <!-- Typing indicator -->
        <div class="typing-indicator hidden" id="typingIndicator">
          <div class="message-avatar">
            <span>?</span>
          </div>
          <div class="typing-bubble">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
          <span style="font-size: 13px; color: var(--text-muted);" id="typingText">User is typing...</span>
        </div>
        
        <!-- Scroll to bottom button -->
        <button class="scroll-to-bottom hidden" id="scrollToBottomBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M19 12l-7 7-7-7"></path>
          </svg>
        </button>
        
        <!-- Message input area (hidden initially) -->
        <div class="chat-input-container hidden" id="chatInputContainer">
          <div class="chat-input-wrapper">
            <div class="chat-input-main">
              <textarea 
                class="chat-input" 
                id="messageInput"
                placeholder="Type a message..."
                rows="1"
                maxlength="5000"
              ></textarea>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div class="chat-input-actions">
                  <button class="chat-input-btn" id="emojiPickerBtn" title="Add emoji">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                      <line x1="9" y1="9" x2="9.01" y2="9"></line>
                      <line x1="15" y1="9" x2="15.01" y2="9"></line>
                    </svg>
                  </button>
                  <button class="chat-input-btn" id="attachFileBtn" title="Attach file">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                    </svg>
                  </button>
                </div>
                <div class="char-count" id="charCount">0 / 5000</div>
              </div>
            </div>
            <button class="chat-send-btn" id="sendMessageBtn" disabled title="Send message">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Hidden file input for attachments -->
  <input type="file" id="fileInput" style="display: none;" multiple accept="image/*,.pdf,.doc,.docx,.txt">
  
  <!-- Scripts -->
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
  <script src="/chat/js/ChatAPI.js"></script>
  <script src="/chat/js/ChatSocket.js"></script>
  <script src="/chat/js/ChatState.js"></script>
  <script src="/chat/js/ConversationList.js"></script>
  <script src="/chat/js/ChatView.js"></script>
  <script src="/chat/js/ContactPicker.js"></script>
  <script src="/chat/js/ChatApp.js"></script>
  
  <script>
    // Initialize app on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      window.chatApp = new ChatApp();
    });
  </script>
</body>
</html>
