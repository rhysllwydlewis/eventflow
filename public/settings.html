<!DOCTYPE html>
<html lang='en-GB'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes'>
  <meta name='theme-color' content='#0B8073'>
  <title>Settings â€” EventFlow</title>
  <link rel="stylesheet" href="/assets/css/styles.css?v=18.0.0">
  <link rel="stylesheet" href="/assets/css/ui-ux-fixes.css?v=18.0.0">
    <link rel="stylesheet" href="/assets/css/navbar.css?v=18.0.0" />
  <link rel='stylesheet' href='/assets/css/eventflow-17.0.0.css?v=18.0.0'>
  <link rel='stylesheet' href='/assets/css/utilities.css?v=18.0.0'>
  <link rel='stylesheet' href='/assets/css/components.css?v=18.0.0'>
  <link rel='stylesheet' href='/assets/css/animations.css?v=18.0.0'>
  <link rel='stylesheet' href='/assets/css/mobile-optimizations.css?v=18.0.0'>
  <link rel='icon' href='/favicon.svg'>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<!-- TOP NAVBAR - GOLD STANDARD REBUILD -->
<header class="ef-header" role="banner">
  <div class="ef-container">
    <div class="ef-header-content">
      <!-- Brand Logo - Enhanced Animated -->
      <a href="/" class="ef-brand" aria-label="EventFlow - Return to homepage">
        <div class="ef-logo" aria-hidden="true">
          <div class="ef-logo-inner"></div>
        </div>
        <span class="ef-brand-text">EventFlow</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="ef-nav-desktop" aria-label="Main navigation">
        <a href="/start" class="ef-nav-link">Plan</a>
        <a href="/suppliers" class="ef-nav-link">Suppliers</a>
        <a href="/marketplace" class="ef-nav-link">Marketplace</a>
        <a href="/blog" class="ef-nav-link">Guides</a>
        <a href="/pricing" class="ef-nav-link">Pricing</a>
      </nav>

      <!-- Actions -->
      <div class="ef-header-actions">
        <!-- Notification Bell (hidden by default, shown when logged in) -->
        <button 
          id="ef-notification-btn" 
          class="ef-icon-btn" 
          type="button" 
          aria-label="View notifications"
          style="display: none;"
        >
          <svg class="ef-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
          <span id="ef-notification-badge" class="ef-badge" style="display: none;">0</span>
        </button>

        <!-- Auth Button (Desktop) -->
        <a href="/auth" id="ef-auth-link" class="ef-btn ef-btn-primary">
          Log in
        </a>

        <!-- Dashboard Link (Desktop, hidden by default) -->
        <a href="#" id="ef-dashboard-link" class="ef-nav-link" style="display: none;">
          Dashboard
        </a>

        <!-- Mobile Menu Toggle -->
        <button 
          id="ef-mobile-toggle" 
          class="ef-mobile-toggle" 
          type="button"
          aria-label="Toggle menu"
          aria-expanded="false"
          aria-controls="ef-mobile-menu"
        >
          <span class="ef-toggle-line"></span>
          <span class="ef-toggle-line"></span>
          <span class="ef-toggle-line"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="ef-mobile-menu" class="ef-mobile-menu" role="dialog" aria-modal="true" aria-label="Mobile navigation">
    <nav class="ef-mobile-nav" aria-label="Primary navigation">
      <a href="/start" class="ef-mobile-link">Plan an Event</a>
      <a href="/suppliers" class="ef-mobile-link">Browse Suppliers</a>
      <a href="/marketplace" class="ef-mobile-link">Marketplace</a>
      <a href="/pricing" class="ef-mobile-link">Pricing</a>
      <a href="/blog" class="ef-mobile-link">Guides</a>
      <a href="/for-suppliers" class="ef-mobile-link">For Suppliers</a>
      <a href="/faq" class="ef-mobile-link">FAQ</a>
      <div class="ef-mobile-divider"></div>
      <a href="/auth" id="ef-mobile-auth" class="ef-mobile-link ef-mobile-primary">Log in</a>
      <a href="#" id="ef-mobile-dashboard" class="ef-mobile-link" style="display: none;">Dashboard</a>
      <a href="#" id="ef-mobile-logout" class="ef-mobile-link" style="display: none;">Log out</a>
    </nav>
  </div>
</header>
    <script src="/assets/js/utils/auth-state.js" defer></script>
    <!-- Global error handler - catches all unhandled errors and API failures -->
    <script src="/assets/js/utils/global-error-handler.js" defer></script>
    <script src="/assets/js/burger-menu.js" defer></script>
    <script src="/assets/js/navbar.js" defer></script>
<script src="/assets/js/components.js" defer></script>
<script src="/assets/js/animations.js" defer></script>
<script src="/assets/js/notifications.js" defer></script>
<script src="/assets/js/search.js" defer></script>
<script src="/assets/js/websocket-client.js" defer></script>

<main id="main-content" class='section'><div class='container'>
<h1>Settings</h1>

<!-- Profile Information Card -->
<div class="card">
  <h2 style="margin:0 0 1rem 0;font-size:1.5rem;">Profile Information</h2>
  <form id="profile-form">
    <div class="form-row" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div>
        <label for="profile-firstName">First Name</label>
        <input type="text" id="profile-firstName" name="firstName" placeholder="John">
      </div>
      <div>
        <label for="profile-lastName">Last Name</label>
        <input type="text" id="profile-lastName" name="lastName" placeholder="Smith">
      </div>
    </div>
    
    <div class="form-row">
      <label for="profile-name">Display Name</label>
      <input type="text" id="profile-name" name="name" placeholder="John Smith" required>
    </div>
    
    <div class="form-row">
      <label for="profile-email">Email Address</label>
      <input type="email" id="profile-email" name="email" placeholder="john@example.com" required>
      <p class="small" style="margin-top:0.25rem;color:#667085;">Changing your email will require re-verification.</p>
    </div>
    
    <div class="form-row">
      <label for="profile-phone">Phone Number</label>
      <input type="tel" id="profile-phone" name="phone" placeholder="+44 7700 900000">
    </div>
    
    <div class="form-row" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div>
        <label for="profile-location">Location</label>
        <input type="text" id="profile-location" name="location" placeholder="London, UK">
      </div>
      <div>
        <label for="profile-postcode">Postcode</label>
        <input type="text" id="profile-postcode" name="postcode" placeholder="SW1A 1AA">
      </div>
    </div>
    
    <div class="form-row">
      <label for="profile-company">Company</label>
      <input type="text" id="profile-company" name="company" placeholder="Company Name">
    </div>
    
    <div class="form-row" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div>
        <label for="profile-jobTitle">Job Title</label>
        <input type="text" id="profile-jobTitle" name="jobTitle" placeholder="Event Coordinator">
      </div>
      <div>
        <label for="profile-website">Website</label>
        <input type="url" id="profile-website" name="website" placeholder="https://example.com">
      </div>
    </div>
    
    <div class="form-actions" style="margin-top:1rem">
      <button class="cta" type="submit">Save Profile</button>
      <span class="small" id="profile-status"></span>
    </div>
  </form>
</div>

<!-- Notification Preferences Card -->
<div class="card" style="margin-top:1.5rem;">
  <h2 style="margin:0 0 1rem 0;font-size:1.5rem;">Notification Preferences</h2>
  
  <!-- Email Notifications -->
  <div style="margin-bottom:1.5rem;">
    <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;">
      <input id="notify" type="checkbox" style="cursor:pointer;"> 
      <span>Email me when I receive a new message</span>
    </label>
  </div>
  
  <!-- Sound Notifications -->
  <div style="margin-bottom:1.5rem;">
    <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;margin-bottom:0.75rem;">
      <input id="notification-sound-enabled" type="checkbox" style="cursor:pointer;" checked> 
      <span>Enable notification sounds</span>
    </label>
    <p class="small" style="color:#667085;margin:0 0 1rem 1.75rem;">
      Play a short tone when you receive new notifications (enquiries, messages, etc.)
    </p>
    
    <!-- Volume Control -->
    <div id="volume-control" style="margin-left:1.75rem;padding-left:1rem;border-left:2px solid #e5e7eb;">
      <label for="notification-volume" style="display:block;margin-bottom:0.5rem;font-size:0.9rem;color:#667085;">
        Volume: <span id="volume-value">30</span>%
      </label>
      <div style="display:flex;align-items:center;gap:0.75rem;">
        <span style="font-size:1.2rem;" aria-hidden="true">ðŸ”ˆ</span>
        <input 
          type="range" 
          id="notification-volume" 
          min="0" 
          max="100" 
          value="30" 
          aria-label="Notification volume"
          aria-valuemin="0"
          aria-valuemax="100"
          aria-valuenow="30"
          aria-valuetext="30 percent"
          style="flex:1;height:6px;cursor:pointer;accent-color:#0B8073;"
        >
        <span style="font-size:1.2rem;" aria-hidden="true">ðŸ”Š</span>
      </div>
      <button 
        type="button" 
        class="cta secondary" 
        id="test-notification-sound" 
        style="margin-top:0.75rem;font-size:0.85rem;padding:0.5rem 1rem;"
        aria-label="Test notification sound"
      >
        ðŸ”” Test Sound
      </button>
      <div id="test-sound-feedback" style="margin-top:0.5rem;font-size:0.85rem;min-height:1.2rem;" role="status" aria-live="polite"></div>
    </div>
  </div>
  
  <div class="form-actions" style="margin-top:10px">
    <button class="cta" id="save-settings">Save Preferences</button>
    <span class="small" id="settings-status"></span>
  </div>
</div>

<div class="card" style="margin-top:16px">
  <h3>Onboarding Tour</h3>
  <p class="small" style="margin-bottom:12px">Restart the interactive tour to learn about EventFlow's features again.</p>
  <button class="cta secondary" id="restart-tour">Restart Tour</button>
</div>

<script src="/assets/js/app.js"></script>
<script>window.__EF_PAGE__='settings'</script>
<script>
  // Load current user profile
  async function loadProfile() {
    try {
      const response = await fetch('/api/auth/me', { credentials: 'include' });
      if (!response.ok) {
        throw new Error('Failed to load profile');
      }
      const data = await response.json();
      const user = data.user;
      
      if (!user) {
        // Not logged in, redirect to login
        window.location.href = '/auth.html?redirect=' + encodeURIComponent(window.location.pathname + window.location.search);
        return;
      }
      
      // Populate form fields
      document.getElementById('profile-firstName').value = user.firstName || '';
      document.getElementById('profile-lastName').value = user.lastName || '';
      document.getElementById('profile-name').value = user.name || '';
      document.getElementById('profile-email').value = user.email || '';
      document.getElementById('profile-phone').value = user.phone || '';
      document.getElementById('profile-location').value = user.location || '';
      document.getElementById('profile-postcode').value = user.postcode || '';
      document.getElementById('profile-company').value = user.company || '';
      document.getElementById('profile-jobTitle').value = user.jobTitle || '';
      document.getElementById('profile-website').value = user.website || '';
      document.getElementById('notify').checked = user.notify !== false;
    } catch (error) {
      console.error('Error loading profile:', error);
      const status = document.getElementById('profile-status');
      if (status) {
        status.textContent = 'Error loading profile';
        status.style.color = '#ef4444';
      }
    }
  }
  
  // Save profile
  document.getElementById('profile-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const status = document.getElementById('profile-status');
    const submitBtn = e.target.querySelector('button[type="submit"]');
    
    try {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      status.textContent = '';
      
      const formData = {
        firstName: document.getElementById('profile-firstName').value.trim(),
        lastName: document.getElementById('profile-lastName').value.trim(),
        name: document.getElementById('profile-name').value.trim(),
        email: document.getElementById('profile-email').value.trim(),
        phone: document.getElementById('profile-phone').value.trim(),
        location: document.getElementById('profile-location').value.trim(),
        postcode: document.getElementById('profile-postcode').value.trim(),
        company: document.getElementById('profile-company').value.trim(),
        jobTitle: document.getElementById('profile-jobTitle').value.trim(),
        website: document.getElementById('profile-website').value.trim()
      };
      
      const response = await fetch('/api/auth/profile', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': window.__CSRF_TOKEN__ || ''
        },
        credentials: 'include',
        body: JSON.stringify(formData)
      });
      
      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.error || 'Failed to update profile');
      }
      
      status.textContent = 'âœ“ ' + data.message;
      status.style.color = '#10b981';
      
      // Reload profile to show updated data
      setTimeout(() => {
        loadProfile();
      }, 1000);
      
    } catch (error) {
      console.error('Error updating profile:', error);
      status.textContent = 'âœ— ' + error.message;
      status.style.color = '#ef4444';
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Profile';
    }
  });
  
  // Load profile on page load
  loadProfile();
  
  // Restart tour button
  document.getElementById('restart-tour').addEventListener('click', function() {
    localStorage.removeItem('ef_homepage_tour_completed');
    const btn = this;
    btn.textContent = 'âœ“ Tour Reset!';
    btn.disabled = true;
    setTimeout(() => {
      btn.textContent = 'Restart Tour';
      btn.disabled = false;
    }, 2000);
  });
  
  // ===== NOTIFICATION SOUND SETTINGS =====
  
  // Load notification settings from localStorage
  function loadNotificationSettings() {
    const soundEnabled = localStorage.getItem('ef_notification_sound_enabled');
    const volume = localStorage.getItem('ef_notification_volume');
    
    // Set default values
    document.getElementById('notification-sound-enabled').checked = soundEnabled !== 'false';
    document.getElementById('notification-volume').value = volume || '30';
    document.getElementById('volume-value').textContent = volume || '30';
    
    // Update volume control visibility based on sound enabled state
    updateVolumeControlVisibility();
  }
  
  // Update volume control visibility
  function updateVolumeControlVisibility() {
    const soundEnabled = document.getElementById('notification-sound-enabled').checked;
    const volumeControl = document.getElementById('volume-control');
    volumeControl.style.opacity = soundEnabled ? '1' : '0.5';
    volumeControl.style.pointerEvents = soundEnabled ? 'auto' : 'none';
  }
  
  // Update volume value display
  document.getElementById('notification-volume').addEventListener('input', function(e) {
    const value = e.target.value;
    document.getElementById('volume-value').textContent = value;
    // Update ARIA attributes for screen readers
    e.target.setAttribute('aria-valuenow', value);
    e.target.setAttribute('aria-valuetext', value + ' percent');
  });
  
  // Toggle sound enabled/disabled
  document.getElementById('notification-sound-enabled').addEventListener('change', function() {
    updateVolumeControlVisibility();
  });
  
  // Test notification sound
  document.getElementById('test-notification-sound').addEventListener('click', function() {
    const volume = parseInt(document.getElementById('notification-volume').value, 10) / 100;
    const soundEnabled = document.getElementById('notification-sound-enabled').checked;
    const feedback = document.getElementById('test-sound-feedback');
    const btn = this;
    
    // Clear previous feedback
    feedback.textContent = '';
    feedback.style.color = '';
    
    if (!soundEnabled) {
      feedback.textContent = 'âš ï¸ Notification sounds are disabled. Enable them to test.';
      feedback.style.color = '#f59e0b';
      return;
    }
    
    if (volume === 0) {
      feedback.textContent = 'âš ï¸ Volume is set to 0%. Increase volume to hear the sound.';
      feedback.style.color = '#f59e0b';
      return;
    }
    
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 800;
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
      
      oscillator.onended = function() {
        audioContext.close();
      };
      
      // Visual feedback
      btn.textContent = 'âœ“ Sound Played!';
      btn.disabled = true;
      feedback.textContent = 'âœ“ Notification sound played successfully';
      feedback.style.color = '#10b981';
      
      setTimeout(() => {
        btn.textContent = 'ðŸ”” Test Sound';
        btn.disabled = false;
        feedback.textContent = '';
      }, 2000);
    } catch (error) {
      console.error('Error playing test sound:', error);
      feedback.textContent = 'âœ— Error: ' + error.message;
      feedback.style.color = '#ef4444';
      
      setTimeout(() => {
        feedback.textContent = '';
      }, 5000);
    }
  });
  
  // Save notification settings
  document.getElementById('save-settings').addEventListener('click', async function() {
    const soundEnabled = document.getElementById('notification-sound-enabled').checked;
    const volume = document.getElementById('notification-volume').value;
    const notify = document.getElementById('notify').checked;
    
    const status = document.getElementById('settings-status');
    const btn = this;
    
    try {
      // Save sound settings to localStorage
      localStorage.setItem('ef_notification_sound_enabled', soundEnabled);
      localStorage.setItem('ef_notification_volume', volume);
      
      // Save email notification preference to server
      const response = await fetch('/api/me/settings', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': window.__CSRF_TOKEN__ || '',
        },
        credentials: 'include',
        body: JSON.stringify({ notify: notify }),
      });
      
      if (!response.ok) {
        throw new Error('Failed to save email notification preference');
      }
      
      // Success feedback
      status.textContent = 'âœ“ All settings saved!';
      status.style.color = '#10b981';
      
      setTimeout(() => {
        status.textContent = '';
      }, 3000);
    } catch (error) {
      console.error('Error saving settings:', error);
      status.textContent = 'âœ— Error saving email preferences';
      status.style.color = '#ef4444';
      
      setTimeout(() => {
        status.textContent = '';
      }, 5000);
    }
  });
  
  // Load settings on page load
  loadNotificationSettings();
</script>
</div></main>
<footer class="footer" role="contentinfo">
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
    <div><strong>EventFlow</strong><br><span class="small">Event planning made simple.</span></div>
    <div class="version">Version: v17.0.0</div>
    <div class="small"><a href="/blog">Blog</a> Â·
      <a href="/credits">Credits</a> Â· <a href="/contact">Contact</a> Â· <a href="/legal">Legal Hub</a></div>
  </div>
</footer>

<!-- BOTTOM NAVBAR - GOLD STANDARD REBUILD (Mobile Only) -->
<nav class="ef-bottom-nav" role="navigation" aria-label="Mobile bottom navigation">
  <a href="/start" class="ef-bottom-link" aria-label="Plan your event">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M12 20h9"/>
      <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
    </svg>
    <span class="ef-bottom-label">Plan</span>
  </a>
  
  <a href="/suppliers" class="ef-bottom-link" aria-label="Browse suppliers">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <circle cx="11" cy="11" r="8"/>
      <path d="m21 21-4.35-4.35"/>
    </svg>
    <span class="ef-bottom-label">Suppliers</span>
  </a>
  
  <a href="/blog" class="ef-bottom-link" aria-label="View guides">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
      <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
    </svg>
    <span class="ef-bottom-label">Guides</span>
  </a>
  
  <!-- Dashboard with notification badge (shown when logged in, replaces Alerts) -->
  <a href="#" id="ef-bottom-dashboard" class="ef-bottom-link" style="display: none;" aria-label="Go to dashboard">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <rect x="3" y="3" width="7" height="7" rx="1"/>
      <rect x="14" y="3" width="7" height="7" rx="1"/>
      <rect x="14" y="14" width="7" height="7" rx="1"/>
      <rect x="3" y="14" width="7" height="7" rx="1"/>
    </svg>
    <span class="ef-bottom-label">Dashboard</span>
    <span id="ef-bottom-dashboard-badge" class="ef-badge" style="display: none;">0</span>
  </a>
  
  <!-- Alerts button (shown when logged out) -->
  <a href="/blog" id="ef-bottom-alerts" class="ef-bottom-link" aria-label="View guides and alerts">
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
      <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
    </svg>
    <span class="ef-bottom-label">Alerts</span>
  </a>
  
  <button 
    id="ef-bottom-menu" 
    class="ef-bottom-link" 
    type="button"
    aria-label="Open menu"
    aria-expanded="false"
    aria-controls="ef-mobile-menu"
  >
    <svg class="ef-bottom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <line x1="3" y1="12" x2="21" y2="12"/>
      <line x1="3" y1="6" x2="21" y2="6"/>
      <line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
    <span class="ef-bottom-label">Menu</span>
  </button>
</nav>

<script src="/assets/js/components/footer-nav.js" defer></script>
<script src="/assets/js/cookie-consent.js" defer></script>

<!-- JadeAssist Chat Widget -->
<script src="https://cdn.jsdelivr.net/gh/rhysllwydlewis/JadeAssist@abbf580487e0bcf7739a0857d4d940213fe2e176/packages/widget/dist/jade-widget.js" defer></script>
<script src="/assets/js/jadeassist-init.v2.js" defer></script>
</body>
</html>
