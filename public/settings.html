<!DOCTYPE html>
<html lang='en-GB'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes'>
  <meta name='theme-color' content='#0B8073'>
  <title>Settings — EventFlow</title>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/ui-ux-fixes.css">
    <link rel="stylesheet" href="/assets/css/navbar.css" />
  <link rel='stylesheet' href='/assets/css/eventflow-17.0.0.css'>
  <link rel='stylesheet' href='/assets/css/utilities.css'>
  <link rel='stylesheet' href='/assets/css/components.css'>
  <link rel='stylesheet' href='/assets/css/animations.css'>
  <link rel='stylesheet' href='/assets/css/mobile-optimizations.css'>
  <link rel='icon' href='/favicon.svg'>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<!-- TOP NAVBAR - GOLD STANDARD REBUILD -->
<header class="ef-header" role="banner">
  <div class="ef-container">
    <div class="ef-header-content">
      <!-- Brand Logo - Enhanced Animated -->
      <a href="/" class="ef-brand" aria-label="EventFlow - Return to homepage">
        <div class="ef-logo" aria-hidden="true">
          <div class="ef-logo-inner"></div>
        </div>
        <span class="ef-brand-text">EventFlow</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="ef-nav-desktop" aria-label="Main navigation">
        <a href="/start.html" class="ef-nav-link">Plan</a>
        <a href="/suppliers.html" class="ef-nav-link">Suppliers</a>
        <a href="/marketplace.html" class="ef-nav-link">Marketplace</a>
        <a href="/blog.html" class="ef-nav-link">Guides</a>
        <a href="/pricing.html" class="ef-nav-link">Pricing</a>
      </nav>

      <!-- Actions -->
      <div class="ef-header-actions">
        <!-- Notification Bell (hidden by default, shown when logged in) -->
        <button 
          id="ef-notification-btn" 
          class="ef-icon-btn" 
          type="button" 
          aria-label="View notifications"
          style="display: none;"
        >
          <svg class="ef-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
          <span id="ef-notification-badge" class="ef-badge" style="display: none;">0</span>
        </button>

        <!-- Auth Button (Desktop) -->
        <a href="/auth.html" id="ef-auth-link" class="ef-btn ef-btn-primary">
          Log in
        </a>

        <!-- Dashboard Link (Desktop, hidden by default) -->
        <a href="#" id="ef-dashboard-link" class="ef-nav-link" style="display: none;">
          Dashboard
        </a>

        <!-- Mobile Menu Toggle -->
        <button 
          id="ef-mobile-toggle" 
          class="ef-mobile-toggle" 
          type="button"
          aria-label="Toggle menu"
          aria-expanded="false"
          aria-controls="ef-mobile-menu"
        >
          <span class="ef-toggle-line"></span>
          <span class="ef-toggle-line"></span>
          <span class="ef-toggle-line"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="ef-mobile-menu" class="ef-mobile-menu" role="dialog" aria-modal="true" aria-label="Mobile navigation">
    <nav class="ef-mobile-nav" aria-label="Primary navigation">
      <a href="/start.html" class="ef-mobile-link">Plan an Event</a>
      <a href="/suppliers.html" class="ef-mobile-link">Browse Suppliers</a>
      <a href="/marketplace.html" class="ef-mobile-link">Marketplace</a>
      <a href="/pricing.html" class="ef-mobile-link">Pricing</a>
      <a href="/blog.html" class="ef-mobile-link">Guides</a>
      <a href="/for-suppliers.html" class="ef-mobile-link">For Suppliers</a>
      <a href="/faq.html" class="ef-mobile-link">FAQ</a>
      <div class="ef-mobile-divider"></div>
      <a href="/auth.html" id="ef-mobile-auth" class="ef-mobile-link ef-mobile-primary">Log in</a>
      <a href="#" id="ef-mobile-dashboard" class="ef-mobile-link" style="display: none;">Dashboard</a>
      <a href="#" id="ef-mobile-logout" class="ef-mobile-link" style="display: none;">Log out</a>
    </nav>
  </div>
</header>
    <script src="/assets/js/utils/auth-state.js" defer></script>
    <script src="/assets/js/burger-menu.js" defer></script>
    <script src="/assets/js/navbar.js" defer></script>
<script src="/assets/js/components.js" defer></script>
<script src="/assets/js/animations.js" defer></script>
<script src="/assets/js/notifications.js" defer></script>
<script src="/assets/js/search.js" defer></script>
<script src="/assets/js/websocket-client.js" defer></script>

<main id="main-content" class='section'><div class='container'>
<h1>Settings</h1>

<!-- Profile Information Card -->
<div class="card">
  <h2 style="margin:0 0 1rem 0;font-size:1.5rem;">Profile Information</h2>
  <form id="profile-form">
    <div class="form-row" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div>
        <label for="profile-firstName">First Name</label>
        <input type="text" id="profile-firstName" name="firstName" placeholder="John">
      </div>
      <div>
        <label for="profile-lastName">Last Name</label>
        <input type="text" id="profile-lastName" name="lastName" placeholder="Smith">
      </div>
    </div>
    
    <div class="form-row">
      <label for="profile-name">Display Name</label>
      <input type="text" id="profile-name" name="name" placeholder="John Smith" required>
    </div>
    
    <div class="form-row">
      <label for="profile-email">Email Address</label>
      <input type="email" id="profile-email" name="email" placeholder="john@example.com" required>
      <p class="small" style="margin-top:0.25rem;color:#667085;">Changing your email will require re-verification.</p>
    </div>
    
    <div class="form-row">
      <label for="profile-phone">Phone Number</label>
      <input type="tel" id="profile-phone" name="phone" placeholder="+44 7700 900000">
    </div>
    
    <div class="form-row" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div>
        <label for="profile-location">Location</label>
        <input type="text" id="profile-location" name="location" placeholder="London, UK">
      </div>
      <div>
        <label for="profile-postcode">Postcode</label>
        <input type="text" id="profile-postcode" name="postcode" placeholder="SW1A 1AA">
      </div>
    </div>
    
    <div class="form-row">
      <label for="profile-company">Company</label>
      <input type="text" id="profile-company" name="company" placeholder="Company Name">
    </div>
    
    <div class="form-row" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div>
        <label for="profile-jobTitle">Job Title</label>
        <input type="text" id="profile-jobTitle" name="jobTitle" placeholder="Event Coordinator">
      </div>
      <div>
        <label for="profile-website">Website</label>
        <input type="url" id="profile-website" name="website" placeholder="https://example.com">
      </div>
    </div>
    
    <div class="form-actions" style="margin-top:1rem">
      <button class="cta" type="submit">Save Profile</button>
      <span class="small" id="profile-status"></span>
    </div>
  </form>
</div>

<!-- Notification Preferences Card -->
<div class="card" style="margin-top:1.5rem;">
  <h2 style="margin:0 0 1rem 0;font-size:1.5rem;">Notification Preferences</h2>
  <label><input id="notify" type="checkbox"> Email me when I receive a new message</label>
  <div class="form-actions" style="margin-top:10px"><button class="cta" id="save-settings">Save Preferences</button><span class="small" id="settings-status"></span></div>
</div>

<div class="card" style="margin-top:16px">
  <h3>Onboarding Tour</h3>
  <p class="small" style="margin-bottom:12px">Restart the interactive tour to learn about EventFlow's features again.</p>
  <button class="cta secondary" id="restart-tour">Restart Tour</button>
</div>

<script src="/assets/js/app.js"></script>
<script>window.__EF_PAGE__='settings'</script>
<script>
  // Load current user profile
  async function loadProfile() {
    try {
      const response = await fetch('/api/auth/me', { credentials: 'include' });
      if (!response.ok) {
        throw new Error('Failed to load profile');
      }
      const data = await response.json();
      const user = data.user;
      
      if (!user) {
        // Not logged in, redirect to login
        window.location.href = '/auth.html?redirect=' + encodeURIComponent(window.location.pathname + window.location.search);
        return;
      }
      
      // Populate form fields
      document.getElementById('profile-firstName').value = user.firstName || '';
      document.getElementById('profile-lastName').value = user.lastName || '';
      document.getElementById('profile-name').value = user.name || '';
      document.getElementById('profile-email').value = user.email || '';
      document.getElementById('profile-phone').value = user.phone || '';
      document.getElementById('profile-location').value = user.location || '';
      document.getElementById('profile-postcode').value = user.postcode || '';
      document.getElementById('profile-company').value = user.company || '';
      document.getElementById('profile-jobTitle').value = user.jobTitle || '';
      document.getElementById('profile-website').value = user.website || '';
      document.getElementById('notify').checked = user.notify !== false;
    } catch (error) {
      console.error('Error loading profile:', error);
      const status = document.getElementById('profile-status');
      if (status) {
        status.textContent = 'Error loading profile';
        status.style.color = '#ef4444';
      }
    }
  }
  
  // Save profile
  document.getElementById('profile-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const status = document.getElementById('profile-status');
    const submitBtn = e.target.querySelector('button[type="submit"]');
    
    try {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      status.textContent = '';
      
      const formData = {
        firstName: document.getElementById('profile-firstName').value.trim(),
        lastName: document.getElementById('profile-lastName').value.trim(),
        name: document.getElementById('profile-name').value.trim(),
        email: document.getElementById('profile-email').value.trim(),
        phone: document.getElementById('profile-phone').value.trim(),
        location: document.getElementById('profile-location').value.trim(),
        postcode: document.getElementById('profile-postcode').value.trim(),
        company: document.getElementById('profile-company').value.trim(),
        jobTitle: document.getElementById('profile-jobTitle').value.trim(),
        website: document.getElementById('profile-website').value.trim()
      };
      
      const response = await fetch('/api/auth/profile', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': window.__CSRF_TOKEN__ || ''
        },
        credentials: 'include',
        body: JSON.stringify(formData)
      });
      
      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.error || 'Failed to update profile');
      }
      
      status.textContent = '✓ ' + data.message;
      status.style.color = '#10b981';
      
      // Reload profile to show updated data
      setTimeout(() => {
        loadProfile();
      }, 1000);
      
    } catch (error) {
      console.error('Error updating profile:', error);
      status.textContent = '✗ ' + error.message;
      status.style.color = '#ef4444';
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Profile';
    }
  });
  
  // Load profile on page load
  loadProfile();
  
  // Restart tour button
  document.getElementById('restart-tour').addEventListener('click', function() {
    localStorage.removeItem('ef_homepage_tour_completed');
    const btn = this;
    btn.textContent = '✓ Tour Reset!';
    btn.disabled = true;
    setTimeout(() => {
      btn.textContent = 'Restart Tour';
      btn.disabled = false;
    }, 2000);
  });
</script>
</div></main>
<footer class="footer" role="contentinfo">
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
    <div><strong>EventFlow</strong><br><span class="small">Event planning made simple.</span></div>
    <div class="version">Version: v17.0.0</div>
    <div class="small"><a href="/blog.html">Blog</a> ·
      <a href="/credits.html">Credits</a> · <a href="/contact.html">Contact</a> · <a href="/legal.html">Legal Hub</a></div>
  </div>
</footer>
<script src="/assets/js/components/footer-nav.js" defer></script>
<script src="/assets/js/cookie-consent.js" defer></script>

<!-- JadeAssist Chat Widget -->
<script src="https://cdn.jsdelivr.net/gh/rhysllwydlewis/JadeAssist@abbf580487e0bcf7739a0857d4d940213fe2e176/packages/widget/dist/jade-widget.js" defer></script>
<script src="/assets/js/jadeassist-init.v2.js" defer></script>
</body>
</html>
