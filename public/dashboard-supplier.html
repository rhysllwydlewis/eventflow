<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Supplier dashboard ‚Äî EventFlow</title>
<meta name="robots" content="noindex,nofollow">
    <link rel="stylesheet" href="/assets/css/design-tokens.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/styles.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/eventflow-17.0.0.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/utilities.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/components.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/animations.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/mobile-optimizations.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/ui-ux-fixes.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/navbar.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/skeleton.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/dashboard-animations.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/p3-features.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/liquid-glass.css?v=18.2.1" />
    <link rel="stylesheet" href="/assets/css/messaging-glass-enhancements.css?v=18.2.1" />
    <link rel="stylesheet" href="/assets/css/supplier-dashboard-improvements.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/dashboard-hero.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/supplier-utils.css?v=18.2.0" />
    <link rel="stylesheet" href="/assets/css/profile-health.css?v=18.2.0" />
    <script src="/assets/js/dashboard-guard.js?v=17.0.2"></script>
    <script src="/assets/js/toast-notifications.js?v=18.2.0"></script>
    <script>
      // Global image error handler for supplier avatars and other images
      document.addEventListener('DOMContentLoaded', function () {
        document.addEventListener(
          'error',
          function (e) {
            if (e.target.tagName === 'IMG') {
              const img = e.target;
              // Only handle once per image
              if (img.dataset.errorHandled) return;
              img.dataset.errorHandled = 'true';

              // Prevent error propagation (note: browser console errors may still appear)
              e.stopPropagation();

              // Log 404 errors for upload paths to help debug upload issues
              if (img.src && img.src.includes('/uploads/')) {
                console.warn('Image upload 404 - File not found:', img.src);
              }

              // Check if it's a supplier avatar, profile image, or package image
              if (
                img.src &&
                (img.src.includes('/uploads/suppliers/') ||
                  img.src.includes('/uploads/packages/') ||
                  img.classList.contains('supplier-avatar') ||
                  img.classList.contains('profile-image') ||
                  img.classList.contains('package-image') ||
                  img.closest('.package-card') ||
                  img.closest('.supplier-card'))
              ) {
                // Determine the appropriate placeholder based on context
                let placeholderSvg;

                if (
                  img.src.includes('/uploads/packages/') ||
                  img.classList.contains('package-image') ||
                  img.closest('.package-card')
                ) {
                  // Package placeholder with box icon
                  placeholderSvg =
                    'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Crect width="100" height="100" fill="%23f3f4f6"/%3E%3Cpath d="M50 25L25 37.5v25L50 75l25-12.5v-25L50 25zm0 5l18.75 9.375L50 48.75l-18.75-9.375L50 30zm-20 12.5L45 50v17.5L30 60V42.5zm40 0v17.5L55 67.5V50l15-7.5z" fill="%239ca3af"/%3E%3C/svg%3E';
                  img.alt = 'Package image placeholder';
                  img.title = 'Package image not available';
                } else {
                  // Profile placeholder with person icon
                  placeholderSvg =
                    'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Crect width="100" height="100" fill="%23e5e7eb"/%3E%3Cpath d="M50 45c8.284 0 15-6.716 15-15s-6.716-15-15-15-15 6.716-15 15 6.716 15 15 15zm0 5c-10 0-30 5-30 15v10h60V65c0-10-20-15-30-15z" fill="%239ca3af"/%3E%3C/svg%3E';
                  img.alt = 'Profile placeholder';
                  img.title = 'Image not available';
                }

                img.src = placeholderSvg;

                // Maintain aspect ratio and theme styling
                img.style.objectFit = 'cover';
                img.style.backgroundColor = '#f3f4f6';
              }
            }
          },
          true
        );
      });
    </script>
  <link rel="stylesheet" href="/messenger/css/messenger-widget-v4.css">
  </head>
  <body class="supplier-dashboard-page">
    <!-- Screen Reader Announcer -->
    <div id="sr-announcer" aria-live="polite" aria-atomic="true"></div>
    <script>
      // Screen reader announcement helper
      window.announceToSR = function (message) {
        const announcer = document.getElementById('sr-announcer');
        if (announcer) {
          announcer.textContent = message;
          setTimeout(() => {
            announcer.textContent = '';
          }, 1000);
        }
      };
    </script>
    <!-- modern-ui -->
    <!-- TOP NAVBAR - GOLD STANDARD REBUILD -->
    <header class="ef-header" role="banner">
      <div class="ef-container">
        <div class="ef-header-content">
          <!-- Brand Logo - Enhanced Animated -->
          <a href="/" class="ef-brand" aria-label="EventFlow - Return to homepage">
            <div class="ef-logo" aria-hidden="true">
              <div class="ef-logo-inner"></div>
            </div>
            <span class="ef-brand-text">EventFlow</span>
          </a>

          <!-- Desktop Navigation -->
          <nav class="ef-nav-desktop" aria-label="Main navigation">
            <a href="/start" class="ef-nav-link">Plan</a>
            <a href="/suppliers" class="ef-nav-link">Suppliers</a>
            <a href="/marketplace" class="ef-nav-link">Marketplace</a>
            <a href="/blog" class="ef-nav-link">Guides</a>
            <a href="/pricing" class="ef-nav-link">Pricing</a>
          </nav>

          <!-- Actions -->
          <div class="ef-header-actions">
            <!-- Notification Bell (hidden by default, shown when logged in) -->
            <button
              id="ef-notification-btn"
              class="ef-icon-btn"
              type="button"
              aria-label="View notifications"
              style="display: none"
            >
              <svg
                class="ef-icon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
              </svg>
              <span id="ef-notification-badge" class="ef-badge" style="display: none">0</span>
            </button>

            <!-- Auth Button (Desktop) -->
            <a href="/auth" id="ef-auth-link" class="ef-btn ef-btn-primary"> Log in </a>

            <!-- Dashboard Link (Desktop, hidden by default) -->
            <a href="#" id="ef-dashboard-link" class="ef-nav-link" style="display: none">
              Dashboard
            </a>

            <!-- Mobile Menu Toggle -->
            <button
              id="ef-mobile-toggle"
              class="ef-mobile-toggle"
              type="button"
              aria-label="Toggle menu"
              aria-expanded="false"
              aria-controls="ef-mobile-menu"
            >
              <span class="ef-toggle-line"></span>
              <span class="ef-toggle-line"></span>
              <span class="ef-toggle-line"></span>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div
        id="ef-mobile-menu"
        class="ef-mobile-menu"
        role="dialog"
        aria-modal="true"
        aria-label="Mobile navigation"
      >
        <nav class="ef-mobile-nav" aria-label="Primary navigation">
          <a href="/start" class="ef-mobile-link">Plan an Event</a>
          <a href="/suppliers" class="ef-mobile-link">Browse Suppliers</a>
          <a href="/marketplace" class="ef-mobile-link">Marketplace</a>
          <a href="/pricing" class="ef-mobile-link">Pricing</a>
          <a href="/blog" class="ef-mobile-link">Guides</a>
          <a href="/for-suppliers" class="ef-mobile-link">For Suppliers</a>
          <a href="/faq" class="ef-mobile-link">FAQ</a>
          <div class="ef-mobile-divider"></div>
          <a href="/auth" id="ef-mobile-auth" class="ef-mobile-link ef-mobile-primary">Log in</a>
          <a href="#" id="ef-mobile-dashboard" class="ef-mobile-link" style="display: none"
            >Dashboard</a
          >
          <a
            href="/settings"
            id="ef-mobile-settings"
            class="ef-mobile-link"
            style="display: none"
            >‚öôÔ∏è Settings</a
          >
          <a href="#" id="ef-mobile-logout" class="ef-mobile-link" style="display: none">Log out</a>
        </nav>
      </div>
    </header>

    <!-- Notification Dropdown (Pre-rendered, shown/hidden by JS) -->
    <div id="notification-dropdown" class="notification-dropdown" style="display: none">
      <div class="notification-header">
        <h3>Notifications</h3>
        <button class="notification-mark-all" id="notification-mark-all-read">
          Mark all as read
        </button>
      </div>
      <div class="notification-list"></div>
      <div class="notification-footer">
        <a href="/notifications" class="notification-view-all">View all</a>
      </div>
    </div>

    <!-- Load auth state manager first -->
    <script src="/assets/js/utils/auth-state.js" defer></script>
    <!-- Global error handler - catches all unhandled errors and API failures -->
    <script src="/assets/js/utils/global-error-handler.js" defer></script>
    <script src="/assets/js/utils/sentry-browser-init.js" defer></script>
    <!-- Notification system for toast notifications -->
    <script src="/assets/js/notification-system.js" defer></script>
    <!-- Burger menu - simple standalone implementation -->
    <script src="/assets/js/burger-menu.js" defer></script>
    <script src="/assets/js/navbar.js" defer></script>

    <script src="/assets/js/websocket-client.js" defer></script>

    <!-- Mobile Section Navigation -->
    <nav
      class="dashboard-mobile-nav"
      aria-label="Dashboard sections"
      data-test="supplier-mobile-nav"
    >
      <div class="mobile-nav-pills" data-test="mobile-nav-pills">
        <button
          class="mobile-nav-pill active"
          data-section="welcome-section"
          data-test="nav-overview"
          title="Overview"
        >
          üè† <span class="pill-text">Overview</span>
        </button>
        <button
          class="mobile-nav-pill"
          data-section="supplier-stats-grid"
          data-test="nav-stats"
          title="Stats"
        >
          üìä <span class="pill-text">Stats</span>
        </button>
        <button
          class="mobile-nav-pill"
          data-section="my-suppliers"
          data-test="nav-profiles"
          title="Profiles"
        >
          üë§ <span class="pill-text">Profiles</span>
        </button>
        <button
          class="mobile-nav-pill"
          data-section="my-packages"
          data-test="nav-packages"
          title="Packages"
        >
          üì¶ <span class="pill-text">Packages</span>
        </button>
        <button
          class="mobile-nav-pill"
          data-section="threads-sup"
          data-test="nav-messages"
          title="Messages"
        >
          üí¨ <span class="pill-text">Messages</span>
          <span class="pill-badge" id="mobile-msg-badge" style="display: none">0</span>
        </button>
        <button
          class="mobile-nav-pill"
          data-section="tickets-sup"
          data-test="nav-tickets"
          title="Tickets"
        >
          üé´ <span class="pill-text">Tickets</span>
        </button>
      </div>
    </nav>

    <main id="main-content" class="section">
      <div class="container">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="Breadcrumb" class="dashboard-breadcrumb">
          <ol class="ef-breadcrumb">
            <li class="ef-breadcrumb-item">
              <a href="/" class="ef-breadcrumb-link">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  width="14"
                  height="14"
                  aria-hidden="true"
                >
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                  <polyline points="9 22 9 12 15 12 15 22" />
                </svg>
                <span>Home</span>
              </a>
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                width="12"
                height="12"
                aria-hidden="true"
                class="ef-breadcrumb-separator"
              >
                <polyline points="9 18 15 12 9 6" />
              </svg>
            </li>
            <li class="ef-breadcrumb-item">
              <span class="ef-breadcrumb-current">Supplier Dashboard</span>
              <span id="breadcrumb-section" style="display: none">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  width="12"
                  height="12"
                  aria-hidden="true"
                  class="ef-breadcrumb-separator"
                >
                  <polyline points="9 18 15 12 9 6" />
                </svg>
                <span class="ef-font-semibold" id="breadcrumb-section-name"></span>
              </span>
            </li>
          </ol>
        </nav>

        <div id="supplier-pro-ribbon" class="pro-ribbon" style="display: none"></div>

        <!-- New Dashboard Hero Section - Built from Scratch -->
        <section
          id="welcome-section"
          class="dashboard-hero"
          aria-labelledby="welcome-heading"
          data-test="welcome-card"
        >
          <!-- Animated Background Elements -->
          <div class="dashboard-hero__bg">
            <div class="dashboard-hero__gradient"></div>
            <div class="dashboard-hero__blob dashboard-hero__blob--1"></div>
            <div class="dashboard-hero__blob dashboard-hero__blob--2"></div>
            <div class="dashboard-hero__grid"></div>
          </div>

          <!-- Main Content -->
          <div class="dashboard-hero__content">
            <!-- Header Section -->
            <div class="dashboard-hero__header">
              <div class="dashboard-hero__greeting-wrapper">
                <span
                  class="dashboard-hero__greeting"
                  id="welcome-greeting"
                  data-test="time-greeting"
                  >Good day</span
                >
                <h1 id="welcome-heading" class="dashboard-hero__title">
                  <span class="dashboard-hero__title-main">Your Dashboard</span>
                  <span class="dashboard-hero__title-highlight">Command Center</span>
                </h1>
                <p class="dashboard-hero__subtitle">
                  Manage your business, track performance, and grow your presence
                </p>
              </div>

              <!-- Quick Stats Grid -->
              <div class="dashboard-hero__stats">
                <div
                  class="dashboard-stat-card dashboard-stat-card--primary"
                  data-test="stat-counter-enquiries"
                >
                  <div class="dashboard-stat-card__icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                    </svg>
                  </div>
                  <div class="dashboard-stat-card__content">
                    <div
                      class="dashboard-stat-card__value stat-number"
                      id="quick-stat-enquiries"
                      data-target="12"
                    >
                      0
                    </div>
                    <div class="dashboard-stat-card__label">New Enquiries</div>
                  </div>
                  <div class="dashboard-stat-card__trend dashboard-stat-card__trend--up">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
                      <polyline points="17 6 23 6 23 12" />
                    </svg>
                    <span>+12%</span>
                  </div>
                </div>

                <div
                  class="dashboard-stat-card dashboard-stat-card--secondary"
                  data-test="stat-counter-profiles"
                >
                  <div class="dashboard-stat-card__icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                      <circle cx="12" cy="7" r="4" />
                    </svg>
                  </div>
                  <div class="dashboard-stat-card__content">
                    <div
                      class="dashboard-stat-card__value stat-number"
                      id="quick-stat-profiles"
                      data-target="4"
                    >
                      0
                    </div>
                    <div class="dashboard-stat-card__label">Active Profiles</div>
                  </div>
                  <div class="dashboard-stat-card__badge">Live</div>
                </div>

                <div class="dashboard-stat-card dashboard-stat-card--accent">
                  <div class="dashboard-stat-card__icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polygon
                        points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                      />
                    </svg>
                  </div>
                  <div class="dashboard-stat-card__content">
                    <div class="dashboard-stat-card__value">4.8</div>
                    <div class="dashboard-stat-card__label">Avg. Rating</div>
                  </div>
                  <div class="dashboard-stat-card__stars">
                    <span>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quick Actions Bar -->
            <div class="dashboard-hero__actions">
              <button
                class="dashboard-action-chip dashboard-action-chip--primary"
                data-action="create-profile"
              >
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10" />
                  <line x1="12" y1="8" x2="12" y2="16" />
                  <line x1="8" y1="12" x2="16" y2="12" />
                </svg>
                <span>Create Profile</span>
              </button>

              <button
                class="dashboard-action-chip"
                data-action="new-package"
              >
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" />
                  <path d="M3 9h18" />
                  <path d="M9 21V9" />
                </svg>
                <span>New Package</span>
              </button>

              <button class="dashboard-action-chip" id="viewConversationsBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                <span>Messages</span>
              </button>

              <button class="dashboard-action-chip" data-action="view-earnings">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="1" x2="12" y2="23" />
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                </svg>
                <span>View Earnings</span>
              </button>

              <button
                class="dashboard-action-chip"
                data-action="view-stats"
              >
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7" />
                  <rect x="14" y="3" width="7" height="7" />
                  <rect x="14" y="14" width="7" height="7" />
                  <rect x="3" y="14" width="7" height="7" />
                </svg>
                <span>View Stats</span>
              </button>

              <a
                class="dashboard-action-chip"
                href="mailto:support@eventflow.com?subject=Supplier Support Request"
              >
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10" />
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                  <line x1="12" y1="17" x2="12.01" y2="17" />
                </svg>
                <span>Get Help</span>
              </a>

              <!-- Pro Tip Badge -->
              <div
                class="dashboard-hero__tip"
                id="welcome-pro-tip"
                aria-live="polite"
                data-test="pro-tip"
              >
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10" />
                  <path d="M12 16v-4" />
                  <path d="M12 8h.01" />
                </svg>
                <span id="pro-tip-text">Tip: Fast responses lead to more bookings</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Statistics Widgets -->
        <h2 id="stats-heading" class="sr-only">Dashboard Statistics</h2>
        <section id="supplier-stats-grid" aria-labelledby="stats-heading" role="region"></section>

        <!-- Performance Analytics Chart -->
        <div id="supplier-performance-chart"></div>

        <!-- Enquiry Trend Chart -->
        <div id="enquiry-trend-chart"></div>

        <!-- ROI Analytics Widgets: Conversion Funnel + Response Time -->
        <section aria-labelledby="roi-widgets-heading" style="margin-top:1.5rem;">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:0.75rem;margin-bottom:1rem;">
            <h2 id="roi-widgets-heading" style="margin:0;font-size:1.125rem;font-weight:700;color:#0B1220;">Performance Overview</h2>
            <div style="display:flex;align-items:center;gap:0.5rem;">
              <label for="roi-date-range" style="font-size:0.875rem;color:#6B7280;">Period:</label>
              <select id="roi-date-range" aria-label="Analytics date range" style="padding:0.375rem 0.75rem;border:1px solid #E5E7EB;border-radius:8px;font-size:0.875rem;background:white;cursor:pointer;">
                <option value="7">Last 7 days</option>
                <option value="30" selected>Last 30 days</option>
                <option value="90">Last 90 days</option>
              </select>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;">
            <div id="supplier-conversion-funnel"></div>
            <div id="supplier-response-time"></div>
          </div>
        </section>

        <!-- Earnings Overview Section - Enhanced Liquid Glass Design -->
        <section
          id="earnings-overview"
          class="card glass-card glass-card--teal ef-card"
          style="margin-top: 2rem"
          aria-labelledby="earnings-heading"
        >
          <div class="ef-card-header">
            <div class="ef-card-title-wrapper">
              <div class="ef-icon-box-lg ef-gradient-primary">üí∞</div>
              <div>
                <h2 id="earnings-heading" class="ef-card-title">Earnings Overview</h2>
                <p class="ef-card-subtitle">Track your revenue and payments</p>
              </div>
            </div>
            <span class="ef-badge ef-badge-warning">Coming Soon</span>
          </div>

          <div class="ef-grid-auto ef-mb-xl">
            <div class="ef-stat-card">
              <div class="ef-stat-label">Total Revenue</div>
              <div class="ef-stat-value">¬£0.00</div>
              <div class="ef-stat-change">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  width="12"
                  height="12"
                >
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
                  <polyline points="17 6 23 6 23 12" />
                </svg>
                <span>All time</span>
              </div>
            </div>
            <div class="ef-stat-card">
              <div class="ef-stat-label">This Month</div>
              <div class="ef-stat-value">¬£0.00</div>
              <div class="ef-stat-change" style="color: var(--ef-text-light, #9ca3af)">
                Current period
              </div>
            </div>
            <div class="ef-stat-card">
              <div class="ef-stat-label">Pending</div>
              <div class="ef-stat-value">¬£0.00</div>
              <div class="ef-stat-change ef-text-warning">Processing</div>
            </div>
          </div>

          <div
            class="ef-stat-card ef-flex-start ef-gap-lg"
            style="background: rgba(255, 255, 255, 0.5)"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              width="20"
              height="20"
              style="color: var(--ef-primary, #0b8073); flex-shrink: 0"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M12 16v-4" />
              <path d="M12 8h.01" />
            </svg>
            <div style="flex: 1">
              <div class="ef-font-semibold ef-mb-sm">Payment features launching soon</div>
              <div class="ef-text-sm ef-text-muted">
                Accept payments, track bookings, and manage invoices all in one place. We'll notify
                you when it's ready!
              </div>
            </div>
          </div>
        </section>

        <!-- Profile Completeness Checklist -->
        <div id="profile-completeness-widget"></div>

        <!-- Calendar & Availability Widget - Compact Design -->
        <section
          id="availability-calendar"
          class="card"
          style="margin-top: 2rem; padding: 1.75rem"
          aria-labelledby="calendar-heading"
        >
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              margin-bottom: 1.25rem;
              flex-wrap: wrap;
              gap: 1rem;
            "
          >
            <div style="display: flex; align-items: center; gap: 0.75rem">
              <div
                style="
                  width: 40px;
                  height: 40px;
                  background: linear-gradient(
                    135deg,
                    rgba(99, 102, 241, 0.1) 0%,
                    rgba(139, 92, 246, 0.1) 100%
                  );
                  border-radius: 10px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 1.25rem;
                "
              >
                üìÖ
              </div>
              <div>
                <h2
                  id="calendar-heading"
                  style="font-size: 1.25rem; margin: 0; color: var(--ef-text, #0b1220)"
                >
                  Availability Calendar
                </h2>
                <p class="small" style="margin: 0; color: #6b7280; font-size: 0.875rem">
                  Manage your bookable dates
                </p>
              </div>
            </div>
            <span
              style="
                padding: 0.375rem 0.875rem;
                background: rgba(99, 102, 241, 0.1);
                color: #6366f1;
                font-size: 0.75rem;
                font-weight: 600;
                border-radius: 20px;
              "
              >In Development</span
            >
          </div>

          <div
            style="
              background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
              padding: 1.5rem;
              border-radius: 10px;
              border: 1px solid #e5e7eb;
            "
          >
            <div
              style="
                display: grid;
                grid-template-columns: auto 1fr;
                gap: 1.25rem;
                align-items: center;
              "
            >
              <div
                style="
                  width: 80px;
                  height: 80px;
                  background: white;
                  border-radius: 12px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 2.5rem;
                  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
                "
              >
                üìÜ
              </div>
              <div>
                <h3
                  style="font-size: 1.125rem; margin: 0 0 0.5rem 0; color: var(--ef-text, #0b1220)"
                >
                  Interactive Calendar Coming Soon
                </h3>
                <p style="color: #6b7280; margin: 0 0 1rem 0; font-size: 0.875rem">
                  Block unavailable dates, set recurring availability, and track bookings all in one
                  place
                </p>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap">
                  <span
                    style="
                      padding: 0.375rem 0.75rem;
                      background: white;
                      border-radius: 6px;
                      border: 1px solid #e5e7eb;
                      font-size: 0.75rem;
                      display: flex;
                      align-items: center;
                      gap: 0.375rem;
                    "
                  >
                    <span>‚úÖ</span>
                    <span>View bookings</span>
                  </span>
                  <span
                    style="
                      padding: 0.375rem 0.75rem;
                      background: white;
                      border-radius: 6px;
                      border: 1px solid #e5e7eb;
                      font-size: 0.75rem;
                      display: flex;
                      align-items: center;
                      gap: 0.375rem;
                    "
                  >
                    <span>üö´</span>
                    <span>Block dates</span>
                  </span>
                  <span
                    style="
                      padding: 0.375rem 0.75rem;
                      background: white;
                      border-radius: 6px;
                      border: 1px solid #e5e7eb;
                      font-size: 0.75rem;
                      display: flex;
                      align-items: center;
                      gap: 0.375rem;
                    "
                  >
                    <span>üîÑ</span>
                    <span>Recurring</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Section Divider with Liquid Glass -->
        <div style="margin: 3rem 0 2rem; position: relative">
          <div
            style="
              position: absolute;
              left: 0;
              right: 0;
              top: 50%;
              height: 1px;
              background: linear-gradient(90deg, transparent, rgba(11, 128, 115, 0.2), transparent);
            "
          ></div>
          <div
            style="
              position: relative;
              width: fit-content;
              margin: 0 auto;
              background: white;
              padding: 0 1rem;
            "
          >
            <span
              style="
                font-size: 0.75rem;
                color: var(--ef-text-muted, #667085);
                text-transform: uppercase;
                letter-spacing: 0.1em;
                font-weight: 600;
              "
              >Profile Management</span
            >
          </div>
        </div>

        <!-- Your Supplier Profiles - Enhanced Header -->
        <div
          class="card"
          role="region"
          aria-labelledby="profiles-heading"
          style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px)"
        >
          <div
            class="supplier-card-header"
            style="
              background: linear-gradient(
                135deg,
                rgba(11, 128, 115, 0.03) 0%,
                rgba(16, 185, 129, 0.02) 100%
              );
              border-bottom: 1px solid rgba(11, 128, 115, 0.1);
              border-radius: 10px 10px 0 0;
              padding: 1.5rem;
            "
          >
            <div class="supplier-card-header__content">
              <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem">
                <div
                  style="
                    width: 36px;
                    height: 36px;
                    background: linear-gradient(
                      135deg,
                      var(--ef-primary, #0b8073) 0%,
                      var(--ef-success, #10b981) 100%
                    );
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 1.125rem;
                  "
                >
                  üë§
                </div>
                <h2
                  id="profiles-heading"
                  style="margin: 0; font-size: 1.375rem; color: var(--ef-text, #0b1220)"
                >
                  Your Supplier Profiles
                </h2>
              </div>
              <p class="small" style="margin: 0 0 0 3rem; color: #6b7280">
                Create and manage your supplier listings. Each profile gets a health score based on
                completeness.
              </p>
            </div>
            <button
              type="button"
              class="form-toggle-btn"
              id="toggle-profile-form"
              data-test="toggle-profile-form"
              aria-expanded="false"
              aria-controls="profile-form-section"
              aria-label="Toggle profile creation form"
              style="
                background: linear-gradient(
                  135deg,
                  var(--ef-primary, #0b8073) 0%,
                  var(--ef-success, #10b981) 100%
                );
                color: white;
                border: none;
                box-shadow: 0 2px 8px rgba(11, 128, 115, 0.2);
              "
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                width="18"
                height="18"
                aria-hidden="true"
              >
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              <span class="label">Create Profile</span>
            </button>
          </div>

          <div id="my-suppliers" class="section" data-test="my-suppliers-list">
            <div class="skeleton skeleton-text skeleton-text-long"></div>
            <div class="skeleton skeleton-text skeleton-text-medium"></div>
          </div>

          <!-- Collapsible Profile Form Section -->
          <div
            id="profile-form-section"
            class="form-section-collapsible"
            data-test="profile-form-section"
          >
            <h3 class="supplier-section-header">Create / Edit profile</h3>
            <form id="supplier-form" action="#">
              <input type="hidden" id="sup-id" name="id" />
              <div class="form-row supplier-form-grid">
                <div>
                  <label for="sup-name">Business name</label>
                  <input id="sup-name" name="name" required maxlength="100" />
                </div>
                <div>
                  <label>Category</label>
                  <select id="sup-category" name="category" required>
                    <option value="">Choose a category‚Ä¶</option>
                    <option>Venues</option>
                    <option>Catering</option>
                    <option>Photography</option>
                    <option>Entertainment</option>
                    <option>Flowers & d√©cor</option>
                    <option>Transport</option>
                    <option>Extras & add-ons</option>
                  </select>
                </div>
                <div>
                  <label>Location</label>
                  <input id="sup-location" name="location" placeholder="City, region" maxlength="200" />
                </div>
                <div>
                  <label>Price display</label>
                  <input id="sup-price" name="price_display" placeholder="e.g. From ¬£500 or ¬£¬£" maxlength="100" />
                </div>
              </div>

              <div class="form-row">
                <label>Short description</label>
                <input id="sup-short" name="description_short" maxlength="300" />
              </div>

              <div class="form-row">
                <label>Long description</label>
                <textarea id="sup-long" name="description_long" rows="4" maxlength="5000"></textarea>
              </div>

              <div class="form-row">
                <label>Website</label>
                <input id="sup-website" name="website" type="url" placeholder="your-website-url" maxlength="500" />
              </div>

              <div class="form-row">
                <label>License / Insurance</label>
                <input id="sup-license" name="license" placeholder="e.g. PLI ¬£5m" />
              </div>

              <div class="form-row">
                <label>Amenities (comma-separated)</label>
                <input
                  id="sup-amenities"
                  name="amenities"
                  placeholder="Parking, Garden, PA system"
                />
              </div>

              <div class="form-row">
                <label>Max guests</label>
                <input id="sup-max" name="maxGuests" type="number" min="0" step="1" />
              </div>

              <div class="form-row form-row-hidden" id="venue-postcode-row" style="display:none">
                <label for="sup-venue-postcode"
                  >Venue postcode <span class="form-required">*</span></label
                >
                <input
                  id="sup-venue-postcode"
                  name="venuePostcode"
                  placeholder="e.g. SW1A 1AA"
                  aria-describedby="venue-postcode-help venue-postcode-error"
                  aria-required="false"
                />
                <p class="small form-help-text" id="venue-postcode-help">
                  Required for Venues category. Enter a valid UK postcode.
                </p>
                <p
                  class="small form-error-text"
                  id="venue-postcode-error"
                  role="alert"
                  aria-live="polite"
                ></p>
              </div>

              <div class="form-row form-row-hidden">
                <label>Photos (one URL per line)</label>
                <textarea id="sup-photos" name="photos" rows="3"></textarea>
              </div>

              <div class="form-row">
                <label>Upload photos</label>
                <div id="sup-photo-drop" class="photo-drop-zone">
                  Drag &amp; drop images here, or click to choose files.
                </div>
                <div id="sup-photo-preview" class="photo-preview-grid"></div>
                <p class="tiny">
                  You can upload multiple photos ‚Äì they&apos;ll be shown on your public listing.
                </p>
              </div>

              <!-- Profile Customization Link -->
              <div class="form-row supplier-cta-section">
                <div class="supplier-cta-banner">
                  <div class="supplier-cta-banner-content">
                    <h3 class="supplier-cta-banner-title">
                      ‚ú® Profile Customization
                      <span class="supplier-cta-banner-badge">New</span>
                    </h3>
                    <p class="supplier-cta-banner-text">
                      Make your profile stand out with custom banners, taglines, highlights, and
                      social media links
                    </p>
                  </div>
                  <a href="/supplier/profile-customization.html" class="supplier-cta-banner-button">
                    Customize Profile ‚Üí
                  </a>
                </div>
              </div>

              <div class="form-actions supplier-form-actions">
                <button class="cta" id="sup-create" type="submit">Save profile</button>
                <button type="button" id="sup-preview" class="cta secondary">
                  üëÅÔ∏è Preview Profile
                </button>
                <button
                  type="button"
                  class="cta secondary"
                  id="cancel-profile-form"
                  style="display: none"
                >
                  Cancel
                </button>
                <span class="small" id="sup-status"></span>
              </div>
            </form>
          </div>
        </div>

        <script>
          // Show/hide venue postcode field based on category selection
          (function () {
            const categorySelect = document.getElementById('sup-category');
            const venuePostcodeRow = document.getElementById('venue-postcode-row');
            const venuePostcodeInput = document.getElementById('sup-venue-postcode');
            const venuePostcodeError = document.getElementById('venue-postcode-error');

            if (!categorySelect || !venuePostcodeRow || !venuePostcodeInput) {
              return;
            }

            // UK postcode validation regex (matches backend validation)
            const ukPostcodeRegex = /^[A-Z]{1,2}\d{1,2}[A-Z]?\s*\d[A-Z]{2}$/i;

            function validatePostcode(postcode) {
              if (!postcode || !postcode.trim()) {
                return { valid: false, message: 'Postcode is required for Venues' };
              }
              if (!ukPostcodeRegex.test(postcode.trim())) {
                return {
                  valid: false,
                  message: 'Please enter a valid UK postcode (e.g., SW1A 1AA)',
                };
              }
              return { valid: true, message: '' };
            }

            function updateVenuePostcodeVisibility() {
              const selectedCategory = categorySelect.value;
              if (selectedCategory === 'Venues') {
                venuePostcodeRow.classList.remove('form-row-hidden');
                venuePostcodeInput.setAttribute('aria-required', 'true');
              } else {
                venuePostcodeRow.classList.add('form-row-hidden');
                venuePostcodeInput.value = ''; // Clear value when not Venues
                venuePostcodeInput.setAttribute('aria-required', 'false');
                venuePostcodeError.classList.remove('visible');
              }
            }

            // Real-time validation on input
            venuePostcodeInput.addEventListener('input', function () {
              if (categorySelect.value !== 'Venues') {
                return;
              }
              const result = validatePostcode(this.value);
              if (!result.valid && this.value.trim()) {
                venuePostcodeError.textContent = result.message;
                venuePostcodeError.classList.add('visible');
              } else {
                venuePostcodeError.classList.remove('visible');
              }
            });

            // Validate on blur
            venuePostcodeInput.addEventListener('blur', function () {
              if (categorySelect.value !== 'Venues') {
                return;
              }
              const result = validatePostcode(this.value);
              if (!result.valid) {
                venuePostcodeError.textContent = result.message;
                venuePostcodeError.classList.add('visible');
              }
            });

            // Update visibility on category change
            categorySelect.addEventListener('change', updateVenuePostcodeVisibility);

            // Initialize visibility on page load
            updateVenuePostcodeVisibility();

            // Make validation function available globally for form submission
            window.validateVenuePostcode = function () {
              if (categorySelect.value === 'Venues') {
                const result = validatePostcode(venuePostcodeInput.value);
                if (!result.valid) {
                  venuePostcodeError.textContent = result.message;
                  venuePostcodeError.classList.add('visible');
                  venuePostcodeInput.focus();
                  // Scroll to the error field smoothly
                  venuePostcodeInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  return false;
                }
              }
              return true;
            };
          })();
        </script>

        <!-- Section Divider -->
        <div style="margin: 3rem 0 2rem; position: relative">
          <div
            style="
              position: absolute;
              left: 0;
              right: 0;
              top: 50%;
              height: 1px;
              background: linear-gradient(90deg, transparent, rgba(11, 128, 115, 0.2), transparent);
            "
          ></div>
          <div
            style="
              position: relative;
              width: fit-content;
              margin: 0 auto;
              background: white;
              padding: 0 1rem;
            "
          >
            <span
              style="
                font-size: 0.75rem;
                color: var(--ef-text-muted, #667085);
                text-transform: uppercase;
                letter-spacing: 0.1em;
                font-weight: 600;
              "
              >Packages & Services</span
            >
          </div>
        </div>

        <div
          class="card supplier-dashboard-card"
          style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px)"
        >
          <div
            class="supplier-card-header"
            style="
              background: linear-gradient(
                135deg,
                rgba(99, 102, 241, 0.03) 0%,
                rgba(139, 92, 246, 0.02) 100%
              );
              border-bottom: 1px solid rgba(99, 102, 241, 0.1);
              border-radius: 10px 10px 0 0;
              padding: 1.5rem;
            "
          >
            <div class="supplier-card-header__content">
              <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem">
                <div
                  style="
                    width: 36px;
                    height: 36px;
                    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 1.125rem;
                  "
                >
                  üì¶
                </div>
                <h3 style="margin: 0; font-size: 1.375rem; color: var(--ef-text, #0b1220)">
                  Your Packages
                </h3>
              </div>
              <p class="small" id="pkg-limit-note" style="margin: 0 0 0 3rem; color: #6b7280">
                Checking your package allowance‚Ä¶
              </p>
            </div>
            <button
              type="button"
              class="form-toggle-btn"
              id="toggle-package-form"
              data-test="toggle-package-form"
              aria-expanded="false"
              aria-controls="package-form-section"
              aria-label="Toggle package creation form"
              style="
                background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                color: white;
                border: none;
                box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2);
              "
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                width="18"
                height="18"
                aria-hidden="true"
              >
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              <span class="label">Create Package</span>
            </button>
          </div>

          <div id="my-packages" class="section" data-test="my-packages-list">
            <div class="skeleton skeleton-text skeleton-text-long"></div>
            <div class="skeleton skeleton-text skeleton-text-medium"></div>
          </div>

          <!-- Collapsible Package Form Section -->
          <div
            id="package-form-section"
            class="form-section-collapsible"
            data-test="package-form-section"
          >
            <h3 class="supplier-section-header">Create a package</h3>
            <form id="package-form" action="#">
              <div class="form-row supplier-form-grid">
                <div>
                  <label>For supplier</label
                  ><select id="pkg-supplier"></select>
                </div>
                <div><label>Title</label><input id="pkg-title" name="title" /></div>
                <div>
                  <label>Price</label
                  ><input id="pkg-price" name="price" placeholder="e.g. ¬£999 or ¬£45 pp" />
                </div>
              </div>
              <div class="form-row supplier-form-grid">
                <div>
                  <label>Primary Category <span class="form-required">*</span></label>
                  <select id="pkg-category" name="primaryCategoryKey" required>
                    <option value="">Choose a category‚Ä¶</option>
                    <option value="venues">Venues</option>
                    <option value="photography">Photography</option>
                    <option value="catering">Catering</option>
                    <option value="flowers">Flowers & D√©cor</option>
                    <option value="hair-makeup">Hair & Makeup</option>
                    <option value="entertainment">Entertainment</option>
                    <option value="transport">Transport</option>
                    <option value="extras">Extras & Add-ons</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Event Types <span class="required">*</span></label>
                  <div class="checkbox-group">
                    <label class="checkbox-inline">
                      <input
                        type="checkbox"
                        id="pkg-event-wedding"
                        name="eventTypes"
                        value="wedding"
                        class="form-checkbox"
                      />
                      <span class="checkbox-text">Wedding</span>
                    </label>
                    <label class="checkbox-inline">
                      <input
                        type="checkbox"
                        id="pkg-event-other"
                        name="eventTypes"
                        value="other"
                        class="form-checkbox"
                      />
                      <span class="checkbox-text">Other Events</span>
                    </label>
                  </div>
                  <p class="form-help">Select at least one</p>
                </div>
              </div>
              <div class="form-row">
                <label>Description</label
                ><textarea id="pkg-desc" name="description" rows="4"></textarea>
              </div>
              <div class="form-row form-row-hidden">
                <label>Image URL (optional)</label>
                <input id="pkg-image" name="image" placeholder="your-website-url" />
              </div>
              <div class="form-row">
                <label>Upload image (optional)</label>
                <div id="pkg-photo-drop" class="photo-drop-zone">
                  Drag &amp; drop an image here, or click to choose a file.
                </div>
                <div id="pkg-photo-preview" class="photo-preview-grid"></div>
              </div>
              <div class="form-actions supplier-form-actions">
                <button class="cta" type="submit">Save package</button>
                <button
                  type="button"
                  class="cta secondary"
                  id="cancel-package-form"
                  style="display: none"
                >
                  Cancel
                </button>
                <span class="small" id="pkg-status"></span>
              </div>
              <input type="hidden" name="supplierId" id="pkg-supplier-id-hidden" />
              <input type="hidden" name="id" id="pkg-id-hidden" />
            </form>
          </div>
        </div>

        <!-- Subscription Card -->
        <!-- Section Divider -->
        <div style="margin: 3rem 0 2rem; position: relative">
          <div
            style="
              position: absolute;
              left: 0;
              right: 0;
              top: 50%;
              height: 1px;
              background: linear-gradient(90deg, transparent, rgba(11, 128, 115, 0.2), transparent);
            "
          ></div>
          <div
            style="
              position: relative;
              width: fit-content;
              margin: 0 auto;
              background: white;
              padding: 0 1rem;
            "
          >
            <span
              style="
                font-size: 0.75rem;
                color: var(--ef-text-muted, #667085);
                text-transform: uppercase;
                letter-spacing: 0.1em;
                font-weight: 600;
              "
              >Account & Support</span
            >
          </div>
        </div>

        <!-- Subscription Card - Enhanced -->
        <div
          class="card supplier-dashboard-card"
          style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px)"
        >
          <div
            class="supplier-card-header"
            style="
              background: linear-gradient(
                135deg,
                rgba(99, 102, 241, 0.05) 0%,
                rgba(139, 92, 246, 0.03) 100%
              );
              border-bottom: 1px solid rgba(99, 102, 241, 0.1);
              padding: 1.5rem;
            "
          >
            <div class="supplier-card-header__content">
              <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem">
                <div
                  style="
                    width: 36px;
                    height: 36px;
                    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 1.125rem;
                  "
                >
                  üí≥
                </div>
                <h3 style="margin: 0; font-size: 1.375rem; color: var(--ef-text, #0b1220)">
                  Subscription
                </h3>
              </div>
              <p class="small" style="margin: 0 0 0 3rem; color: #6b7280">
                Manage your plan and billing
              </p>
            </div>
          </div>
          <div id="supplier-subscription-card" class="section">
            <p class="small">Checking subscription status‚Ä¶</p>
          </div>
        </div>

        <!-- Lead Quality Card - Enhanced -->
        <div
          class="card supplier-dashboard-card"
          style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px)"
        >
          <div
            class="supplier-card-header"
            style="
              background: linear-gradient(
                135deg,
                rgba(59, 130, 246, 0.05) 0%,
                rgba(37, 99, 235, 0.03) 100%
              );
              border-bottom: 1px solid rgba(59, 130, 246, 0.1);
              padding: 1.5rem;
            "
          >
            <div class="supplier-card-header__content">
              <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem">
                <div
                  style="
                    width: 36px;
                    height: 36px;
                    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 1.125rem;
                  "
                >
                  üìà
                </div>
                <h3 style="margin: 0; font-size: 1.375rem; color: var(--ef-text, #0b1220)">
                  Lead Quality Overview
                </h3>
              </div>
              <p class="small" style="margin: 0 0 0 3rem; color: #6b7280">
                Track the quality of your enquiries
              </p>
            </div>
          </div>
          <div id="lead-quality-breakdown" class="section">
            <div class="skeleton skeleton-text skeleton-text-long"></div>
            <div class="skeleton skeleton-text skeleton-text-medium"></div>
          </div>
        </div>

        <section
          class="card supplier-dashboard-card"
          role="region"
          aria-labelledby="tickets-heading"
          style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px)"
        >
          <div
            class="supplier-card-header"
            style="
              background: linear-gradient(
                135deg,
                rgba(239, 68, 68, 0.05) 0%,
                rgba(220, 38, 38, 0.03) 100%
              );
              border-bottom: 1px solid rgba(239, 68, 68, 0.1);
              padding: 1.5rem;
            "
          >
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                flex-wrap: wrap;
                gap: 1rem;
                width: 100%;
              "
            >
              <div style="display: flex; align-items: center; gap: 0.75rem">
                <div
                  style="
                    width: 36px;
                    height: 36px;
                    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 1.125rem;
                  "
                >
                  üé´
                </div>
                <div>
                  <h3
                    id="tickets-heading"
                    style="margin: 0; font-size: 1.375rem; color: var(--ef-text, #0b1220)"
                  >
                    Support Tickets
                  </h3>
                  <p class="small" style="margin: 0; color: #6b7280">Get help when you need it</p>
                </div>
              </div>
              <button
                class="glass-btn glass-btn--primary"
                id="createSupplierTicketBtn"
                style="padding: 0.625rem 1.25rem; font-size: 0.875rem"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  width="16"
                  height="16"
                  style="margin-right: 0.5rem; display: inline-block; vertical-align: middle"
                >
                  <line x1="12" y1="5" x2="12" y2="19" />
                  <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
                <span style="vertical-align: middle">Create Ticket</span>
              </button>
            </div>
          </div>
          <div id="tickets-sup" class="section">
            <div class="skeleton skeleton-text skeleton-text-long"></div>
            <div class="skeleton skeleton-text skeleton-text-medium"></div>
          </div>
        </section>

        <section
          class="card supplier-dashboard-card"
          role="region"
          aria-labelledby="messages-heading"
          style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px)"
        >
          <div
            class="supplier-card-header"
            style="
              background: linear-gradient(
                135deg,
                rgba(59, 130, 246, 0.05) 0%,
                rgba(37, 99, 235, 0.03) 100%
              );
              border-bottom: 1px solid rgba(59, 130, 246, 0.1);
              padding: 1.5rem;
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                width: 100%;
                flex-wrap: wrap;
                gap: 1rem;
              "
            >
              <div style="display: flex; align-items: center; gap: 1rem">
                <div
                  style="
                    width: 36px;
                    height: 36px;
                    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 1.125rem;
                  "
                >
                  üí¨
                </div>
                <div style="display: flex; align-items: center; gap: 0.75rem">
                  <h3
                    id="messages-heading"
                    style="margin: 0; font-size: 1.375rem; color: var(--ef-text, #0b1220)"
                  >
                    Messages
                  </h3>
                  <span
                    id="unreadMessageBadge"
                    class="badge badge-info supplier-unread-badge"
                    style="
                      background: linear-gradient(
                        135deg,
                        rgba(59, 130, 246, 0.15) 0%,
                        rgba(37, 99, 235, 0.15) 100%
                      );
                      backdrop-filter: blur(8px);
                      border: 1px solid rgba(59, 130, 246, 0.3);
                      color: #1e40af;
                      font-weight: 600;
                      padding: 0.25rem 0.625rem;
                      border-radius: 12px;
                      font-size: 0.75rem;
                    "
                    aria-label="0 unread messages"
                    >0 unread</span
                  >
                </div>
              </div>
              
              <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; flex: 1;">
                <!-- Mini search bar -->
                <input 
                  type="search" 
                  id="widget-search-input-supplier"
                  placeholder="Search conversations..." 
                  style="
                    flex: 1;
                    min-width: 150px;
                    padding: 6px 12px;
                    border: 1px solid #E5E7EB;
                    border-radius: 8px;
                    font-size: 14px;
                  "
                />
                
                <!-- Filter dropdown -->
                <select id="widget-filter-select-supplier" style="
                  padding: 6px 12px;
                  border: 1px solid #E5E7EB;
                  border-radius: 8px;
                  font-size: 14px;
                  background: white;
                ">
                  <option value="all">All</option>
                  <option value="unread">Unread</option>
                  <option value="starred">Starred</option>
                  <option value="high">High Quality</option>
                  <option value="medium">Medium Quality</option>
                  <option value="low">Low Quality</option>
                </select>

                <!-- Sort dropdown -->
                <select id="widget-sort-select-supplier" aria-label="Sort conversations" style="
                  padding: 6px 12px;
                  border: 1px solid #E5E7EB;
                  border-radius: 8px;
                  font-size: 14px;
                  background: white;
                ">
                  <option value="newest">Newest</option>
                  <option value="oldest">Oldest</option>
                  <option value="score-high">Lead Score ‚Üë</option>
                  <option value="score-low">Lead Score ‚Üì</option>
                </select>
                
                <button
                  id="export-enquiries-btn"
                  class="glass-btn"
                  style="
                    padding: 0.5rem 1rem;
                    font-size: 0.875rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                  "
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                  </svg>
                  <span>Export CSV</span>
                </button>
              </div>
            </div>
          </div>
          <!-- Lead Quality Summary Stats -->
          <div id="lead-quality-summary-stats" style="display:none;padding:0.75rem 1rem;margin-bottom:0.75rem;background:#F9FAFB;border-radius:8px;border:1px solid #E5E7EB;">
            <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;">
              <span style="font-size:0.8125rem;font-weight:600;color:#374151;">Lead Quality:</span>
              <span id="lqs-high" style="font-size:0.8125rem;display:inline-flex;align-items:center;gap:0.25rem;"><span style="width:8px;height:8px;border-radius:50%;background:#10b981;display:inline-block;"></span><span id="lqs-high-text">0 High</span></span>
              <span id="lqs-medium" style="font-size:0.8125rem;display:inline-flex;align-items:center;gap:0.25rem;"><span style="width:8px;height:8px;border-radius:50%;background:#f59e0b;display:inline-block;"></span><span id="lqs-medium-text">0 Medium</span></span>
              <span id="lqs-low" style="font-size:0.8125rem;display:inline-flex;align-items:center;gap:0.25rem;"><span style="width:8px;height:8px;border-radius:50%;background:#ef4444;display:inline-block;"></span><span id="lqs-low-text">0 Low</span></span>
              <span id="lqs-pct" style="font-size:0.8125rem;color:#6B7280;margin-left:auto;"></span>
            </div>
          </div>
          <!-- Messenger Dashboard Widget -->
          <div id="messenger-dashboard-widget-supplier" style="margin-bottom: 1rem;"></div>
          <div id="threads-sup" class="section">
            <div class="skeleton skeleton-text skeleton-text-long"></div>
            <div class="skeleton skeleton-text skeleton-text-medium"></div>
          </div>
        </section>

        <!-- Reviews & Ratings Section - Enhanced -->
        <section
          class="card supplier-dashboard-card"
          role="region"
          aria-labelledby="reviews-heading"
          style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px)"
        >
          <div
            class="supplier-card-header"
            style="
              background: linear-gradient(
                135deg,
                rgba(245, 158, 11, 0.05) 0%,
                rgba(251, 191, 36, 0.03) 100%
              );
              border-bottom: 1px solid rgba(245, 158, 11, 0.1);
              padding: 1.5rem;
            "
          >
            <div class="supplier-card-header__content">
              <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem">
                <div
                  style="
                    width: 36px;
                    height: 36px;
                    background: linear-gradient(135deg, #f59e0b 0%, #fbb936 100%);
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 1.125rem;
                  "
                >
                  ‚≠ê
                </div>
                <h3
                  id="reviews-heading"
                  style="margin: 0; font-size: 1.375rem; color: var(--ef-text, #0b1220)"
                >
                  Reviews & Ratings
                </h3>
              </div>
              <p class="small" style="margin: 0 0 0 3rem; color: #6b7280">
                Build trust with customer testimonials
              </p>
            </div>
          </div>
          <div id="supplier-reviews-section" class="section">
            <div
              style="
                background: linear-gradient(
                  135deg,
                  rgba(251, 191, 36, 0.05) 0%,
                  rgba(252, 211, 77, 0.03) 100%
                );
                padding: 2rem;
                border-radius: 10px;
                border: 1px solid rgba(245, 158, 11, 0.1);
              "
            >
              <div style="text-align: center; margin-bottom: 2rem">
                <div
                  style="display: inline-flex; gap: 0.25rem; margin-bottom: 1rem; font-size: 2.5rem"
                >
                  ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
                </div>
                <div
                  style="
                    font-size: 1.5rem;
                    font-weight: 600;
                    margin-bottom: 0.5rem;
                    color: var(--ef-text, #0b1220);
                  "
                >
                  Ready to earn your first review!
                </div>
                <p style="color: #6b7280; margin-bottom: 0; font-size: 0.875rem">
                  Customer reviews will appear here after your first completed booking
                </p>
              </div>

              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                  gap: 1rem;
                  margin-bottom: 1.5rem;
                "
              >
                <div
                  style="
                    padding: 1.25rem;
                    background: rgba(255, 255, 255, 0.9);
                    backdrop-filter: blur(8px);
                    border-radius: 10px;
                    border: 1px solid rgba(245, 158, 11, 0.15);
                    text-align: center;
                  "
                >
                  <div
                    style="
                      font-size: 0.75rem;
                      color: var(--ef-text-muted, #667085);
                      margin-bottom: 0.5rem;
                      text-transform: uppercase;
                      letter-spacing: 0.05em;
                      font-weight: 600;
                    "
                  >
                    Average Rating
                  </div>
                  <div style="font-size: 2rem; font-weight: 700; color: var(--ef-text, #0b1220)">
                    0.0
                  </div>
                  <div style="font-size: 0.75rem; color: #d1d5db; margin-top: 0.25rem">
                    No ratings yet
                  </div>
                </div>
                <div
                  style="
                    padding: 1.25rem;
                    background: rgba(255, 255, 255, 0.9);
                    backdrop-filter: blur(8px);
                    border-radius: 10px;
                    border: 1px solid rgba(245, 158, 11, 0.15);
                    text-align: center;
                  "
                >
                  <div
                    style="
                      font-size: 0.75rem;
                      color: var(--ef-text-muted, #667085);
                      margin-bottom: 0.5rem;
                      text-transform: uppercase;
                      letter-spacing: 0.05em;
                      font-weight: 600;
                    "
                  >
                    Total Reviews
                  </div>
                  <div style="font-size: 2rem; font-weight: 700; color: var(--ef-text, #0b1220)">
                    0
                  </div>
                  <div style="font-size: 0.75rem; color: #d1d5db; margin-top: 0.25rem">
                    Building trust
                  </div>
                </div>
                <div
                  style="
                    padding: 1.25rem;
                    background: rgba(255, 255, 255, 0.9);
                    backdrop-filter: blur(8px);
                    border-radius: 10px;
                    border: 1px solid rgba(245, 158, 11, 0.15);
                    text-align: center;
                  "
                >
                  <div
                    style="
                      font-size: 0.75rem;
                      color: var(--ef-text-muted, #667085);
                      margin-bottom: 0.5rem;
                      text-transform: uppercase;
                      letter-spacing: 0.05em;
                      font-weight: 600;
                    "
                  >
                    Response Rate
                  </div>
                  <div style="font-size: 2rem; font-weight: 700; color: var(--ef-text, #0b1220)">
                    -
                  </div>
                  <div style="font-size: 0.75rem; color: #d1d5db; margin-top: 0.25rem">
                    Coming soon
                  </div>
                </div>
              </div>

              <div
                style="
                  background: rgba(255, 255, 255, 0.8);
                  backdrop-filter: blur(8px);
                  padding: 1.25rem;
                  border-radius: 10px;
                  border: 1px solid rgba(245, 158, 11, 0.1);
                  display: flex;
                  align-items: start;
                  gap: 1rem;
                "
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  width="20"
                  height="20"
                  style="color: #f59e0b; flex-shrink: 0; margin-top: 0.125rem"
                >
                  <path
                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                    fill="currentColor"
                  />
                </svg>
                <div style="flex: 1">
                  <div
                    style="font-weight: 600; color: var(--ef-text, #0b1220); margin-bottom: 0.5rem"
                  >
                    üí° Pro tip for getting great reviews
                  </div>
                  <ul
                    style="
                      margin: 0;
                      padding-left: 1.25rem;
                      color: #6b7280;
                      font-size: 0.875rem;
                      line-height: 1.6;
                    "
                  >
                    <li>Respond quickly to enquiries (within 24 hours)</li>
                    <li>Deliver exceptional service at every booking</li>
                    <li>Follow up after events to gather feedback</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </section>

        <script>
          // Breadcrumb Navigation Update
          document.addEventListener('DOMContentLoaded', () => {
            const breadcrumbSection = document.getElementById('breadcrumb-section');
            const breadcrumbSectionName = document.getElementById('breadcrumb-section-name');

            // Section name mapping
            const sectionNames = {
              'welcome-section': 'Overview',
              'supplier-stats-grid': 'Statistics',
              'my-suppliers': 'Profiles',
              'my-packages': 'Packages',
              'threads-sup': 'Messages',
              'tickets-sup': 'Support Tickets',
            };

            const updateBreadcrumb = sectionId => {
              if (sectionId && sectionNames[sectionId]) {
                breadcrumbSection.style.display = 'flex';
                breadcrumbSection.style.alignItems = 'center';
                breadcrumbSection.style.gap = '0.5rem';
                breadcrumbSectionName.textContent = sectionNames[sectionId];
              } else {
                breadcrumbSection.style.display = 'none';
              }
            };

            const activePill = document.querySelector('.mobile-nav-pill.active');
            if (activePill) {
              updateBreadcrumb(activePill.dataset.section);
            }

            // Keep breadcrumb synced to nav click + scroll-spy updates from enhancements script
            window.addEventListener('supplier-nav-section-change', e => {
              updateBreadcrumb(e.detail?.sectionId);
            });
          });

          // Quick Actions: Handle view conversations button
          document.addEventListener('DOMContentLoaded', () => {
            const viewConvBtn = document.getElementById('viewConversationsBtn');
            if (viewConvBtn) {
              viewConvBtn.addEventListener('click', () => {
                window.location.href = '/messenger/';
              });
            }
          });
        </script>

        <script src="/assets/js/app.js?v=18.2.0"></script>
        <script src="/assets/js/components.js?v=18.2.0"></script>
        <script src="/assets/js/unread-badge-manager.js?v=18.2.0"></script>
        <script type="module" src="/assets/js/supplier-tickets.js?v=18.3.0"></script>
        <script type="module" src="/assets/js/supplier-gallery.js?v=18.2.0"></script>
        <script type="module">
          // Display subscription status on dashboard using MongoDB API
          import {
            initializeFeatureAccess,
            displayPackageLimitNotice,
            enforcePackageLimit,
          } from '/supplier/js/feature-access.js';

          import { createStatsGrid, createProfileChecklist } from '/assets/js/dashboard-widgets.js';
          import {
            createPerformanceChart,
            createAnalyticsSummary,
            createEnquiryTrendChart,
            createLeadQualityWidget,
            loadReviewStats,
            createConversionFunnelWidget,
            createResponseTimeWidget,
          } from '/assets/js/supplier-analytics-chart.js';
          import { initCountUp } from '/assets/js/count-up-animation.js';

          // Module-level variable to store chart instance for real-time updates
          let analyticsChartInstance = null;
          // Store WebSocket client instance for cleanup
          let wsClientInstance = null;

          // Initialize feature access control (non-blocking)
          initializeFeatureAccess().catch(err => {
            console.error('Error initializing feature access:', err);
          });

          // Placeholder function for earnings feature (coming soon)
          window.showEarningsComingSoon = function () {
            if (typeof Toast !== 'undefined') {
              Toast.info(
                'Earnings dashboard coming soon! Track your revenue, payments, and invoices.'
              );
            } else {
              alert('Earnings dashboard coming soon! Track your revenue, payments, and invoices.');
            }
          };

          // Initialize supplier dashboard widgets
          async function initSupplierDashboardWidgets() {
            try {
              // Fetch real analytics from the supplier analytics API
              let analytics = null;
              let totalEnquiries = 0;
              let views7d = 0;
              let responseRate = 100;
              let avgResponseTime = 0;

              try {
                // Fetch analytics using the real tracking system
                const analyticsResponse = await fetch('/api/supplier/analytics?days=7', {
                  credentials: 'include',
                });
                if (analyticsResponse.ok) {
                  const analyticsData = await analyticsResponse.json();
                  analytics = analyticsData.analytics;

                  // Extract values from real analytics
                  totalEnquiries = analytics.totalEnquiries || 0;
                  views7d = analytics.totalViews || 0;
                  responseRate = analytics.responseRate || 100;
                  avgResponseTime = analytics.avgResponseTime || 0;
                } else {
                  console.warn('Analytics API not available, fetching threads for basic stats');
                  // Fallback to basic thread count
                  const threadsResponse = await fetch('/api/threads/my', {
                    credentials: 'include',
                  });
                  if (threadsResponse.ok) {
                    const threadsData = await threadsResponse.json();
                    totalEnquiries = (threadsData.items || []).length;
                  }
                }
              } catch (err) {
                console.error('Error fetching analytics:', err);
              }

              // Create statistics widgets with real data
              createStatsGrid(
                [
                  {
                    icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>',
                    value: views7d,
                    label: 'Profile Views (7d)',
                    format: 'number',
                    color: 'linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%)',
                  },
                  {
                    icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',
                    value: totalEnquiries,
                    label: 'Total Enquiries',
                    format: 'number',
                    color: 'linear-gradient(135deg, #10B981 0%, #34D399 100%)',
                  },
                  {
                    icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>',
                    value: responseRate,
                    label: 'Response Rate',
                    format: 'percent',
                    color: 'linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%)',
                  },
                  {
                    icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',
                    value: avgResponseTime,
                    label: 'Avg Response Time',
                    format: 'time',
                    color: 'linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%)',
                    pulse: true,
                  },
                ],
                'supplier-stats-grid'
              );

              // Prepare chart data from analytics
              const labels = [];
              const viewsData = [];
              const enquiriesData = [];

              if (analytics && analytics.dailyData && analytics.dailyData.length > 0) {
                // Use real daily data from analytics
                analytics.dailyData.forEach(day => {
                  labels.push(day.label);
                  viewsData.push(day.views);
                  enquiriesData.push(day.enquiries);
                });
              } else {
                // Fallback: generate placeholder data for 7 days
                for (let i = 6; i >= 0; i--) {
                  const date = new Date();
                  date.setDate(date.getDate() - i);
                  labels.push(date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }));
                  viewsData.push(0);
                  enquiriesData.push(0);
                }
              }

              analyticsChartInstance = await createPerformanceChart(
                'supplier-performance-chart',
                viewsData,
                enquiriesData,
                labels
              );

              // Create enquiry trend chart
              await createEnquiryTrendChart('enquiry-trend-chart');

              // Initialize ROI analytics widgets (uses date-range selector)
              await createConversionFunnelWidget('supplier-conversion-funnel');
              await createResponseTimeWidget('supplier-response-time');

              // Wire date-range selector to refresh ROI widgets
              const roiDateRange = document.getElementById('roi-date-range');
              if (roiDateRange) {
                roiDateRange.addEventListener('change', async () => {
                  const days = parseInt(roiDateRange.value, 10) || 30;
                  await createConversionFunnelWidget('supplier-conversion-funnel', days);
                  await createResponseTimeWidget('supplier-response-time', days);
                });
              }

              // Initialize Lead Quality widget
              await createLeadQualityWidget('lead-quality-breakdown');

              // Initialize Reviews & Ratings section
              await loadReviewStats('supplier-reviews-section');

              // Fetch supplier profiles to check completion
              let hasProfile = false;
              let hasPhotos = false;
              let hasBanner = false;
              let hasTagline = false;
              let hasHighlights = false;
              let hasSocialLinks = false;

              try {
                const suppliersResponse = await fetch('/api/me/suppliers', {
                  credentials: 'include',
                });
                if (suppliersResponse.ok) {
                  const suppliersData = await suppliersResponse.json();
                  const suppliers = suppliersData.items || [];
                  hasProfile = suppliers.length > 0;
                  if (hasProfile && suppliers[0]) {
                    const supplier = suppliers[0];
                    hasPhotos = supplier.photos && supplier.photos.length >= 5;
                    hasBanner = !!supplier.bannerUrl;
                    hasTagline = !!supplier.tagline;
                    hasHighlights = supplier.highlights && supplier.highlights.length >= 3;
                    hasSocialLinks =
                      supplier.socialLinks && Object.keys(supplier.socialLinks).length >= 2;

                    // Initialize Profile Health Widget with supplier data
                    if (window.ProfileHealthWidget) {
                      window.ProfileHealthWidget.init('profile-completeness-widget', supplier);
                    }
                  }
                }
              } catch (err) {
                console.error('Error fetching suppliers:', err);
              }

              // Fetch packages to check if at least one exists
              let hasPackage = false;

              try {
                const packagesResponse = await fetch('/api/me/packages', {
                  credentials: 'include',
                });
                if (packagesResponse.ok) {
                  const packagesData = await packagesResponse.json();
                  const packages = packagesData.items || [];
                  hasPackage = packages.length > 0;
                }
              } catch (err) {
                console.error('Error fetching packages:', err);
              }

              // Check email verification status
              let emailVerified = false;

              try {
                const userResponse = await fetch('/api/v1/auth/me', { credentials: 'include' });
                if (userResponse.ok) {
                  const userData = await userResponse.json();
                  emailVerified = userData.user?.emailVerified || false;
                }
              } catch (err) {
                console.error('Error checking email verification:', err);
              }

              // Note: Profile Health Widget is now initialized when supplier data is fetched above
              // Old createProfileChecklist has been replaced with ProfileHealthWidget
            } catch (error) {
              console.error('Error initializing supplier dashboard widgets:', error);
            }
          }

          // Real-time notification handler for WebSocket updates
          function handleRealtimeNotification(data) {
            try {
              if (data.type === 'enquiry_received') {
                const enquiriesDataset = analyticsChartInstance?.data?.datasets?.[1]; // datasets[1]

                if (typeof EventFlowNotifications !== 'undefined') {
                  EventFlowNotifications.info('New enquiry received.');
                }

                const enquiriesElement = document.getElementById('quick-stat-enquiries');
                if (enquiriesElement) {
                  const currentValue = parseInt(enquiriesElement.textContent) || 0;
                  enquiriesElement.textContent = currentValue + 1;

                  enquiriesElement.setAttribute('data-target', currentValue + 1);
                }

                if (
                  analyticsChartInstance &&
                  analyticsChartInstance.data &&
                  analyticsChartInstance.data.datasets
                ) {
                  // Get the enquiries dataset (index 1)
                  // Use pre-resolved enquiries dataset reference
                  if (
                    enquiriesDataset &&
                    enquiriesDataset.data &&
                    enquiriesDataset.data.length > 0
                  ) {
                    // Increment the last data point (today)
                    const lastIndex = enquiriesDataset.data.length - 1;
                    enquiriesDataset.data[lastIndex] = (enquiriesDataset.data[lastIndex] || 0) + 1;

                    // Update the chart
                    analyticsChartInstance.update();
                  }
                }
              } else if (data.type === 'profile_view') {
                const viewsDataset = analyticsChartInstance?.data?.datasets?.[0]; // datasets[0]

                // Update the views counter in the stats grid
                // The stats grid is dynamically generated, so we need to find the element
                const statsNumbers = document.querySelectorAll('.stat-number');
                statsNumbers.forEach(element => {
                  const label = element.nextElementSibling;
                  // Check for Profile Views using data attribute or text content
                  if (
                    label &&
                    label.textContent &&
                    (label.textContent.includes('Profile Views') ||
                      label.textContent.includes('Views (7d)'))
                  ) {
                    const currentValue = parseInt(element.textContent) || 0;
                    element.textContent = currentValue + 1;
                    element.setAttribute('data-target', currentValue + 1);
                  }
                });

                if (
                  analyticsChartInstance &&
                  analyticsChartInstance.data &&
                  analyticsChartInstance.data.datasets
                ) {
                  // Get the views dataset (index 0)
                  // Use pre-resolved views dataset reference
                  if (viewsDataset && viewsDataset.data && viewsDataset.data.length > 0) {
                    // Increment the last data point (today)
                    const lastIndex = viewsDataset.data.length - 1;
                    viewsDataset.data[lastIndex] = (viewsDataset.data[lastIndex] || 0) + 1;

                    // Update the chart
                    analyticsChartInstance.update();
                  }
                }
              }
            } catch (error) {
              console.error('Error handling real-time notification:', error);
            }
          }

          // Initialize WebSocket for real-time updates
          window.addEventListener('load', () => {
            // Initialize WebSocketClient if available
            if (typeof WebSocketClient !== 'undefined') {
              try {
                wsClientInstance = new WebSocketClient({
                  onConnect: () => console.log('üü¢ Live Dashboard Connected'),
                  onNotification: (data) => handleRealtimeNotification(data),
                });
              } catch (error) {
                console.error('Error initializing WebSocket client:', error);
              }
            }
          });

          // Cleanup WebSocket on page unload
          window.addEventListener('beforeunload', () => {
            if (wsClientInstance && typeof wsClientInstance.disconnect === 'function') {
              wsClientInstance.disconnect();
            }
          });

          // Initialize widgets after page loads
          window.addEventListener('load', () => {
            setTimeout(() => {
              initSupplierDashboardWidgets();
            }, 500);
          });

          async function displaySubscriptionStatus() {
            const container = document.getElementById('supplier-subscription-card');
            if (!container) return;

            try {
              // Load current user data (most reliable for tier)
              const authResponse = await fetch('/api/v1/auth/me', { credentials: 'include' });
              const authData = authResponse.ok ? await authResponse.json() : null;
              const user = authData?.user || null;
              const currentTier = user?.subscriptionTier || 'free';

              const TIER_LABELS = {
                pro: 'Professional',
                pro_plus: 'Professional Plus',
                free: 'Starter (Free)',
              };
              const TIER_BADGES = {
                pro: '<span style="display:inline-block;background:#7c3aed;color:#fff;font-size:0.7rem;font-weight:700;letter-spacing:0.05em;padding:0.2em 0.6em;border-radius:999px;margin-left:0.5rem;">PRO</span>',
                pro_plus: '<span style="display:inline-block;background:#d97706;color:#fff;font-size:0.7rem;font-weight:700;letter-spacing:0.05em;padding:0.2em 0.6em;border-radius:999px;margin-left:0.5rem;">PRO+</span>',
                free: '',
              };

              // Also load payment record for billing details
              const paymentsResponse = await fetch('/api/payments', { credentials: 'include' });
              let activeSubscription = null;
              if (paymentsResponse.ok) {
                const data = await paymentsResponse.json();
                activeSubscription = (data.payments || []).find(
                  p =>
                    p.type === 'subscription' &&
                    p.status === 'succeeded' &&
                    p.subscriptionDetails &&
                    !p.subscriptionDetails.cancelAtPeriodEnd
                );
              }

              if (currentTier !== 'free') {
                const planLabel = TIER_LABELS[currentTier] || currentTier;
                const badge = TIER_BADGES[currentTier] || '';
                let billingHtml = '';
                if (activeSubscription?.subscriptionDetails?.currentPeriodEnd) {
                  const endDate = new Date(activeSubscription.subscriptionDetails.currentPeriodEnd);
                  billingHtml = `<p class="small"><strong>Renews:</strong> ${endDate.toLocaleDateString('en-GB')}</p>`;
                }

                container.innerHTML = `
            <p class="small"><strong>Active Plan:</strong> ${planLabel}${badge}</p>
            ${billingHtml}
            <p class="small"><strong>Status:</strong> <span class="subscription-status-active">‚úì Active</span></p>
            <a href="/supplier/subscription.html" class="btn btn-secondary subscription-action-btn">Manage Subscription</a>
          `;
              } else {
                container.innerHTML = `
            <p class="small">You're currently on the <strong>Starter (Free) Plan</strong></p>
            <p class="small">Upgrade to Pro or Professional Plus to unlock premium features and boost your visibility!</p>
            <a href="/pricing" class="btn btn-primary subscription-action-btn">View Upgrade Options</a>
          `;
              }

              // Update package limit display
              await updatePackageLimitDisplay();
            } catch (error) {
              console.error('Error loading subscription status:', error);
              container.innerHTML = `
        <p class="small">Unable to load subscription status.</p>
        <a href="/supplier/subscription.html" class="btn btn-secondary subscription-action-btn">View Subscription</a>
      `;
            }
          }

          async function updatePackageLimitDisplay() {
            const limitContainer = document.getElementById('pkg-limit-note');
            if (!limitContainer) return;

            try {
              // Fetch package count from MongoDB API
              const packagesResponse = await fetch('/api/me/packages', { credentials: 'include' });
              if (packagesResponse.ok) {
                const packagesData = await packagesResponse.json();
                const packages = packagesData.items || [];

                // Hide limit notice if user has packages (implementation can be enhanced later)
                limitContainer.style.display = 'none';
              }
            } catch (error) {
              console.error('Error checking package limit:', error);
            }
          }

          // Display lead quality breakdown
          async function displayLeadQualityBreakdown() {
            const container = document.getElementById('lead-quality-breakdown');
            if (!container) return;

            // Load badges CSS
            if (!document.getElementById('badges-css')) {
              const link = document.createElement('link');
              link.id = 'badges-css';
              link.rel = 'stylesheet';
              link.href = '/assets/css/badges.css';
              document.head.appendChild(link);
            }

            try {
              // Fetch threads and supplier profile
              const [threadsResponse, supplierResponse] = await Promise.all([
                fetch('/api/threads/my'),
                fetch('/api/me/suppliers'),
              ]);

              if (!threadsResponse.ok) {
                throw new Error('Failed to fetch threads');
              }
              const data = await threadsResponse.json();
              const threads = data.items || [];

              let supplierProfile = {};
              if (supplierResponse.ok) {
                const supplierData = await supplierResponse.json();
                supplierProfile = supplierData.items?.[0] || {};
              }

              if (threads.length === 0) {
                container.innerHTML =
                  '<p class="small">No enquiries yet. Lead quality statistics will appear here when customers contact you.</p>';
                return;
              }

              // Import lead quality helper (inline since we're in a script tag)
              const { calculateLeadQuality } =
                await import('/assets/js/utils/lead-quality-helper.js');

              // Calculate new quality scores
              const counts = { Hot: 0, High: 0, Good: 0, Low: 0 };
              let totalScore = 0;

              threads.forEach(thread => {
                const quality = calculateLeadQuality(thread, supplierProfile);
                counts[quality.label] = (counts[quality.label] || 0) + 1;
                totalScore += quality.score;
              });

              const total = threads.length;
              const hotPercent = Math.round((counts.Hot / total) * 100) || 0;
              const highPercent = Math.round((counts.High / total) * 100) || 0;
              const goodPercent = Math.round((counts.Good / total) * 100) || 0;
              const lowPercent = Math.round((counts.Low / total) * 100) || 0;
              const avgScore = Math.round(totalScore / total);

              container.innerHTML = `
        <div class="lead-quality-item">
          <div class="lead-quality-header">
            <span class="lead-quality-label">üî• Hot (80+)</span>
            <span class="lead-quality-value">${counts.Hot} (${hotPercent}%)</span>
          </div>
          <div class="lead-quality-bar">
            <div class="lead-quality-fill lead-quality-fill--hot" style="width: ${hotPercent}%;"></div>
          </div>
        </div>
        
        <div class="lead-quality-item">
          <div class="lead-quality-header">
            <span class="lead-quality-label">‚≠ê High (60-79)</span>
            <span class="lead-quality-value">${counts.High} (${highPercent}%)</span>
          </div>
          <div class="lead-quality-bar">
            <div class="lead-quality-fill lead-quality-fill--high" style="width: ${highPercent}%;"></div>
          </div>
        </div>
        
        <div class="lead-quality-item">
          <div class="lead-quality-header">
            <span class="lead-quality-label">‚úì Good (40-59)</span>
            <span class="lead-quality-value">${counts.Good} (${goodPercent}%)</span>
          </div>
          <div class="lead-quality-bar">
            <div class="lead-quality-fill lead-quality-fill--good" style="width: ${goodPercent}%;"></div>
          </div>
        </div>
        
        <div class="lead-quality-item">
          <div class="lead-quality-header">
            <span class="lead-quality-label">‚óØ Low (&lt;40)</span>
            <span class="lead-quality-value">${counts.Low} (${lowPercent}%)</span>
          </div>
          <div class="lead-quality-bar">
            <div class="lead-quality-fill lead-quality-fill--low" style="width: ${lowPercent}%;"></div>
          </div>
        </div>
        
        <div class="lead-quality-summary">
          <div class="lead-quality-summary-label">Average Lead Score</div>
          <div class="lead-quality-summary-value">${avgScore}/100</div>
        </div>
      `;
            } catch (error) {
              console.error('Error fetching lead quality breakdown:', error);
              container.innerHTML =
                '<p class="small text-error">Error loading lead quality statistics.</p>';
            }
          }

          displayLeadQualityBreakdown();

          displaySubscriptionStatus();
        </script>
        <script>
          window.__EF_PAGE__ = 'dash_supplier';
        </script>
        <script>
          // Escape HTML helper
          function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = unsafe;
            return div.innerHTML;
          }

          // Check auth and personalize dashboard
          (async function () {
            try {
              const response = await fetch('/api/v1/auth/me', { credentials: 'include' });
              if (!response.ok) {
                // Redirect to login if not authenticated
                window.location.href =
                  '/auth?redirect=' + encodeURIComponent(window.location.pathname);
                return;
              }
              const data = await response.json();
              const user = data.user;

              if (user) {
                // Personalize welcome message - using textContent is safe but also escape for consistency
                const welcomeHeading = document.getElementById('welcome-heading');
                if (welcomeHeading) {
                  if (user.firstName) {
                    welcomeHeading.textContent = `Welcome ${escapeHtml(user.firstName)}!`;
                  } else if (user.name) {
                    const firstName = user.name.split(' ')[0];
                    welcomeHeading.textContent = `Welcome ${escapeHtml(firstName)}!`;
                  } else {
                    welcomeHeading.textContent = `Welcome to your Supplier Dashboard!`;
                  }
                }
              }
            } catch (error) {
              console.error('Failed to load user data:', error);
            }
          })();
        </script>
      </div>
    </main>
    <!-- BOTTOM NAVBAR - GOLD STANDARD REBUILD (Mobile Only) -->
    <nav class="ef-bottom-nav" role="navigation" aria-label="Mobile bottom navigation">
      <a href="/start" class="ef-bottom-link" aria-label="Plan your event">
        <svg
          class="ef-bottom-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path d="M12 20h9" />
          <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
        </svg>
        <span class="ef-bottom-label">Plan</span>
      </a>

      <a href="/suppliers" class="ef-bottom-link" aria-label="Browse suppliers">
        <svg
          class="ef-bottom-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <circle cx="11" cy="11" r="8" />
          <path d="m21 21-4.35-4.35" />
        </svg>
        <span class="ef-bottom-label">Suppliers</span>
      </a>

      <a href="/blog" class="ef-bottom-link" aria-label="View guides">
        <svg
          class="ef-bottom-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
        </svg>
        <span class="ef-bottom-label">Guides</span>
      </a>

      <!-- Dashboard with notification badge (shown when logged in, replaces Alerts) -->
      <a
        href="#"
        id="ef-bottom-dashboard"
        class="ef-bottom-link"
        style="display: none"
        aria-label="Go to dashboard"
      >
        <svg
          class="ef-bottom-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <rect x="3" y="3" width="7" height="7" rx="1" />
          <rect x="14" y="3" width="7" height="7" rx="1" />
          <rect x="14" y="14" width="7" height="7" rx="1" />
          <rect x="3" y="14" width="7" height="7" rx="1" />
        </svg>
        <span class="ef-bottom-label">Dashboard</span>
        <span id="ef-bottom-dashboard-badge" class="ef-badge" style="display: none">0</span>
      </a>

      <!-- Alerts button (shown when logged out) -->
      <a
        href="/blog"
        id="ef-bottom-alerts"
        class="ef-bottom-link"
        aria-label="View guides and alerts"
      >
        <svg
          class="ef-bottom-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
          <path d="M13.73 21a2 2 0 0 1-3.46 0" />
        </svg>
        <span class="ef-bottom-label">Alerts</span>
      </a>

      <button
        id="ef-bottom-menu"
        class="ef-bottom-link"
        type="button"
        aria-label="Open menu"
        aria-expanded="false"
        aria-controls="ef-mobile-menu"
      >
        <svg
          class="ef-bottom-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="6" x2="21" y2="6" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
        <span class="ef-bottom-label">Menu</span>
      </button>
    </nav>

    <footer class="footer" role="contentinfo">
      <div class="container supplier-footer-content">
        <div>
          <strong>EventFlow</strong><br /><span class="small">Event planning made simple.</span>
        </div>
        <div class="version">Version: <span id="ef-version-label">loading‚Ä¶</span></div>
        <div class="small">
          <a href="/blog">Guides</a> ¬∑ <a href="/pricing">Pricing</a> ¬∑ <a href="/credits">Credits</a> ¬∑
          <a href="/contact">Contact</a> ¬∑ <a href="/legal">Legal Hub</a> ¬∑
      <button type="button" data-cookie-prefs style="background:none;border:none;color:inherit;text-decoration:underline;cursor:pointer;font-size:inherit;padding:0;">Cookie preferences</button>
        </div>
      </div>
    </footer>
    <script src="/assets/js/cookie-consent.js?v=2.0.0" defer></script>

    <!-- Dashboard avoids third-party chat/widget scripts to reduce CSP/tracking noise -->

    <!-- Supplier Enquiry Notifications - Extracted to external file for CSP compliance -->
    <script src="/assets/js/dashboard-supplier-websocket.js?v=18.2.1"></script>

    <!-- Export Functionality - Extracted to external file for CSP compliance -->
    <script src="/assets/js/dashboard-supplier-export.js?v=18.2.1"></script>

    <script src="/assets/js/notifications.js?v=18.2.0"></script>
    <script src="/assets/js/components/profile-health-widget.js?v=18.2.0"></script>
    <script src="/assets/js/keyboard-shortcuts.js" defer></script>
    <script src="/assets/js/vendor/confetti-safe.js?v=18.3.0"></script>
    <script src="/assets/js/utils/p3-features.js" defer></script>
    <script src="/assets/js/supplier-dashboard-enhancements.js" defer></script>

    <!-- Messenger Components -->
    <script src="/messenger/js/MessengerWidgetV4.js" defer></script>
    <script src="/messenger/js/MessengerTrigger.js" defer></script>
    <script src="/messenger/js/NotificationBridge.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof MessengerWidgetV4 !== 'undefined') {
          new MessengerWidgetV4('messenger-dashboard-widget-supplier', {
            maxItems: 5,
            // onRendered(allConversations, filteredConversations) ‚Äì called after each render
            onRendered: function(allConversations, _filteredConversations) {
              // Update the lead quality summary stats block
              var statsEl = document.getElementById('lead-quality-summary-stats');
              if (!statsEl || !allConversations || allConversations.length === 0) {
                return;
              }

              var high = 0, medium = 0, low = 0;
              allConversations.forEach(function(conv) {
                var score = conv.leadScore;
                var raw = conv.leadScoreRaw;
                var label = score;
                if (!label && typeof raw === 'number') {
                  if (raw >= 80) label = 'Hot';
                  else if (raw >= 60) label = 'High';
                  else if (raw >= 40) label = 'Good';
                  else label = 'Low';
                }
                if (label === 'High' || label === 'Hot') high++;
                else if (label === 'Medium' || label === 'Good') medium++;
                else if (label === 'Low') low++;
              });

              var total = allConversations.length;
              var hasQuality = high + medium + low > 0;
              if (!hasQuality) return;

              var highPct = total > 0 ? Math.round((high / total) * 100) : 0;
              statsEl.style.display = 'block';
              var highText = document.getElementById('lqs-high-text');
              var medText = document.getElementById('lqs-medium-text');
              var lowText = document.getElementById('lqs-low-text');
              var pctText = document.getElementById('lqs-pct');
              if (highText) highText.textContent = high + ' High';
              if (medText) medText.textContent = medium + ' Medium';
              if (lowText) lowText.textContent = low + ' Low';
              if (pctText) pctText.textContent = highPct + '% high-quality leads';
            }
          });
        }
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var btn = document.querySelector('[data-action="create-profile"]');
        if (btn) btn.addEventListener('click', function () {
          document.getElementById('sup-name').focus();
          document.getElementById('sup-name').scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
        var btnPkg = document.querySelector('[data-action="new-package"]');
        if (btnPkg) btnPkg.addEventListener('click', function () {
          document.getElementById('pkg-title').focus();
          document.getElementById('pkg-title').scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
        var btnEarnings = document.querySelector('[data-action="view-earnings"]');
        if (btnEarnings) btnEarnings.addEventListener('click', function () { showEarningsComingSoon(); });
        var btnStats = document.querySelector('[data-action="view-stats"]');
        if (btnStats) btnStats.addEventListener('click', function () {
          document.getElementById('supplier-stats-grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });
    </script>
  </body>
</html>
