<!DOCTYPE html><html lang='en-GB'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>Supplier dashboard â€” EventFlow</title><link rel='stylesheet' href='/assets/css/styles.css'><link rel='stylesheet' href='/assets/css/components.css'></head><body>
<!-- modern-ui -->
<header class="header" role="banner">
  <div class="container header-inner">
    <a class="brand" href="/" aria-label="EventFlow home">
      <span class="logo" aria-hidden="true"></span>
      <span class="brand-text">EventFlow</span>
    </a>
    <div class="header-actions">
      <nav class="nav nav-inline" aria-label="Quick navigation">
        <a href="/start.html" class="nav-link nav-main">Plan an Event</a>
        <a href="/suppliers.html" class="nav-link nav-main">Suppliers</a>
        <a href="/blog.html" class="nav-link nav-main">Blog</a>
        <a href="/auth.html" class="nav-link nav-main nav-main-login">Log in</a>
      </nav>
      <button id="notification-bell" class="icon-button" type="button" aria-label="Notifications" style="display:none;">
        <span class="notification-icon">ðŸ””</span>
        <span class="notification-badge" style="display:none;">0</span>
      </button>
      <button id="burger" class="nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false">
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
      </button>
    </div>
  </div>
  <nav class="nav nav-menu" aria-label="Primary navigation">
    <a href="/start.html">Plan an Event</a>
    <a href="/suppliers.html">Suppliers</a>
    <a href="/plan.html">My Plan</a>
    <a href="/blog.html">Blog</a>
    <a href="/for-suppliers.html">For Suppliers</a>
    <a href="/faq.html">FAQ</a>
    <a href="/settings.html">Settings</a>
    <a href="/auth.html" id="nav-auth">Log in</a>
    <a href="#" id="nav-dashboard" style="display:none">Dashboard</a>
    <a href="#" id="nav-signout" style="display:none">Sign out</a>
  </nav>
</header>
<script src="/assets/js/auth-nav.js" defer></script>
<script src="/assets/js/websocket-client.js" defer></script>
<main class='section'><div class='container'>
  <div id="supplier-pro-ribbon" class="pro-ribbon" style="display:none"></div>
<h1>Supplier dashboard</h1>
<div class="card">
  <h3>Your supplier profiles</h3>
  <p class="small">
    Experimental: each profile gets a simple listing health score based on photos, description and details you&apos;ve added.
  </p>
  <div id="my-suppliers" class="section"><p class="small">Loadingâ€¦</p></div>
  <h3 style="margin-top:16px">Create / Edit profile</h3>
<form id="supplier-form">
  <input type="hidden" id="sup-id" name="id">
  <div class="form-row" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
    <div>
      <label>Business name</label>
      <input id="sup-name" name="name">
    </div>
    <div>
      <label>Category</label>
      <select id="sup-category" name="category">
        <option value="">Choose a categoryâ€¦</option>
        <option>Venues</option>
        <option>Catering</option>
        <option>Photography</option>
        <option>Entertainment</option>
        <option>Flowers & dÃ©cor</option>
        <option>Transport</option>
        <option>Extras & add-ons</option>
      </select>
    </div>
    <div>
      <label>Location</label>
      <input id="sup-location" name="location" placeholder="City, region">
    </div>
    <div>
      <label>Price display</label>
      <input id="sup-price" name="price_display" placeholder="e.g. From Â£500 or Â£Â£">
    </div>
  </div>

  <div class="form-row">
    <label>Short description</label>
    <input id="sup-short" name="description_short">
  </div>

  <div class="form-row">
    <label>Long description</label>
    <textarea id="sup-long" name="description_long" rows="4"></textarea>
  </div>

  <div class="form-row">
    <label>Website</label>
    <input id="sup-website" name="website" placeholder="your-website-url">
  </div>

  <div class="form-row">
    <label>License / Insurance</label>
    <input id="sup-license" name="license" placeholder="e.g. PLI Â£5m">
  </div>

  <div class="form-row">
    <label>Amenities (comma-separated)</label>
    <input id="sup-amenities" name="amenities" placeholder="Parking, Garden, PA system">
  </div>

  <div class="form-row">
    <label>Max guests</label>
    <input id="sup-max" name="maxGuests" type="number" min="0" step="1">
  </div>

  <div class="form-row" style="display:none">
    <label>Photos (one URL per line)</label>
    <textarea id="sup-photos" name="photos" rows="3"></textarea>
  </div>

  <div class="form-row">
    <label>Upload photos</label>
    <div id="sup-photo-drop" class="photo-drop-zone">
      Drag &amp; drop images here, or click to choose files.
    </div>
    <div id="sup-photo-preview" class="photo-preview-grid"></div>
    <p class="tiny">
      You can upload multiple photos â€“ they&apos;ll be shown on your public listing.
    </p>
  </div>

  <div class="form-actions" style="margin-top:10px">
    <button class="cta" id="sup-create" type="submit">Save profile</button>
    <span class="small" id="sup-status"></span>
  </div>
</form>


<div class="card" style="margin-top:16px">
  <h3>Your packages</h3>
  <p class="small" id="pkg-limit-note">Checking your package allowanceâ€¦</p>
  <div id="my-packages" class="section"><p class="small">Loadingâ€¦</p></div>
  <h3 style="margin-top:16px">Create a package</h3>
  <form id="package-form">
    <div class="form-row" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div><label>For supplier</label><select id="pkg-supplier"></select></div>
      <div><label>Title</label><input id="pkg-title" name="title"></div>
      <div><label>Price</label><input id="pkg-price" name="price" placeholder="e.g. Â£999 or Â£45 pp"></div>
    </div>
    <div class="form-row"><label>Description</label><textarea id="pkg-desc" name="description" rows="4"></textarea></div>
    <div class="form-row" style="display:none">
      <label>Image URL (optional)</label>
      <input id="pkg-image" name="image" placeholder="your-website-url">
    </div>
    <div class="form-row">
      <label>Upload image (optional)</label>
      <div id="pkg-photo-drop" class="photo-drop-zone">Drag &amp; drop an image here, or click to choose a file.</div>
      <div id="pkg-photo-preview" class="photo-preview-grid"></div>
    </div>
    <div class="form-actions" style="margin-top:10px">
      <button class="cta" type="submit">Save package</button>
      <span class="small" id="pkg-status"></span>
    </div>
    <input type="hidden" name="supplierId" id="pkg-supplier-id-hidden">
    <input type="hidden" name="id" id="pkg-id-hidden">
  </form>
</div><div class="card" style="margin-top:16px;">
  <h3>Subscription</h3>
  <div id="supplier-subscription-card" class="section">
    <p class="small">Checking subscription statusâ€¦</p>
  </div>
</div>

<div class="card" style="margin-top:16px">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
    <h3 style="margin:0;">Support Tickets</h3>
    <button class="cta" id="createSupplierTicketBtn" style="padding:0.5rem 1rem;font-size:14px;">Create Ticket</button>
  </div>
  <div id="tickets-sup" class="section"><p class="small">Loadingâ€¦</p></div>
</div>

<div class="card" style="margin-top:16px">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
    <h3 style="margin:0;">Messages</h3>
    <span id="unreadMessageBadge" class="badge badge-info" style="display:none;font-size:14px;">0 unread</span>
  </div>
  <div id="threads-sup" class="section"><p class="small">Loadingâ€¦</p></div>
</div>

<script src="/assets/js/app.js"></script>
<script src="/assets/js/components.js"></script>
<script type="module" src="/assets/js/supplier-tickets.js"></script>
<script type="module" src="/assets/js/supplier-messages.js"></script>
<script type="module" src="/assets/js/supplier-gallery.js"></script>
<script type="module">
  // Display subscription status on dashboard
  import { db, auth, collection, query, where, getDocs, onAuthStateChanged } from '/assets/js/firebase-config.js';
  import { 
    initializeFeatureAccess, 
    displayPackageLimitNotice, 
    enforcePackageLimit 
  } from '/supplier/js/feature-access.js';
  
  // Initialize feature access control (non-blocking)
  initializeFeatureAccess().catch(err => {
    console.error('Error initializing feature access:', err);
  });
  
  async function displaySubscriptionStatus() {
    const container = document.getElementById('supplier-subscription-card');
    if (!container) return;
    
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        container.innerHTML = '<p class="small">Please log in to view subscription status.</p>';
        return;
      }
      
      try {
        const suppliersQuery = query(
          collection(db, 'suppliers'),
          where('ownerUserId', '==', user.uid)
        );
        
        const suppliersSnapshot = await getDocs(suppliersQuery);
        
        if (suppliersSnapshot.empty) {
          container.innerHTML = '<p class="small">Create a supplier profile to manage subscriptions.</p>';
          return;
        }
        
        const supplier = suppliersSnapshot.docs[0].data();
        const subscription = supplier.subscription;
        
        if (!subscription || !subscription.tier || subscription.tier === 'free') {
          container.innerHTML = `
            <p class="small"><strong>Free Plan</strong></p>
            <p class="small">Upgrade to unlock premium features and boost your visibility.</p>
            <a href="/supplier/subscription.html" class="cta" style="margin-top:0.5rem;display:inline-block;">View Plans</a>
          `;
        } else {
          const tierName = subscription.tier === 'pro' ? 'Pro' : 'Pro+';
          const statusText = subscription.status === 'trial' ? 'Trial' : subscription.status.charAt(0).toUpperCase() + subscription.status.slice(1);
          
          // Format renewal date
          let renewalInfo = '';
          if (subscription.endDate) {
            const endDate = subscription.endDate.toDate();
            const renewalDate = endDate.toLocaleDateString('en-GB', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            });
            
            if (subscription.status === 'trial' && subscription.trialEndDate) {
              const trialEnd = subscription.trialEndDate.toDate();
              const daysLeft = Math.max(0, Math.ceil((trialEnd - new Date()) / (1000 * 60 * 60 * 24)));
              renewalInfo = `<p class="small">Trial ends in ${daysLeft} days â€¢ Renews ${renewalDate}</p>`;
            } else if (subscription.cancelledAt) {
              renewalInfo = `<p class="small">Access until ${renewalDate} â€¢ Cancelled</p>`;
            } else if (subscription.autoRenew) {
              renewalInfo = `<p class="small">Next billing: ${renewalDate}</p>`;
            } else {
              renewalInfo = `<p class="small">Expires ${renewalDate} â€¢ Manual renewal needed</p>`;
            }
          }
          
          container.innerHTML = `
            <p class="small"><strong>${tierName}</strong> - ${statusText}</p>
            ${renewalInfo}
            <p class="small">Thank you for supporting EventFlow!</p>
            <a href="/supplier/subscription.html" class="cta" style="margin-top:0.5rem;display:inline-block;">Manage Subscription</a>
          `;
          
          // Show pro ribbon
          const ribbon = document.getElementById('supplier-pro-ribbon');
          if (ribbon) {
            ribbon.style.display = 'block';
            ribbon.textContent = `âœ¨ You're on EventFlow ${tierName}`;
            if (subscription.tier === 'pro_plus') {
              ribbon.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
            }
          }
        }
        
        // Update package limit display
        await updatePackageLimitDisplay();
        
      } catch (error) {
        console.error('Error loading subscription status:', error);
        container.innerHTML = '<p class="small">Unable to load subscription status.</p>';
      }
    });
  }
  
  async function updatePackageLimitDisplay() {
    const limitContainer = document.getElementById('pkg-limit-note');
    if (!limitContainer) return;
    
    onAuthStateChanged(auth, async (user) => {
      if (!user) return;
      
      try {
        // Get package count
        const packagesQuery = query(
          collection(db, 'packages'),
          where('ownerUserId', '==', user.uid)
        );
        
        const packagesSnapshot = await getDocs(packagesQuery);
        const packageCount = packagesSnapshot.size;
        
        // Display limit notice
        displayPackageLimitNotice(limitContainer, packageCount);
        
      } catch (error) {
        console.error('Error checking package limit:', error);
      }
    });
  }
  
  displaySubscriptionStatus();
</script>
<script>window.__EF_PAGE__='dash_supplier'</script>
</div></main>
<footer class="footer" role="contentinfo">
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
    <div><strong>EventFlow</strong><br><span class="small">Event planning made simple.</span></div>
    <div class="version">Version: v17.0.0</div>
    <div class="small"><a href="/blog.html">Blog</a> Â·
      <a href="/credits.html">Credits</a> Â· <a href="/contact.html">Contact</a> Â· <a href="/legal.html">Legal Hub</a></div>
  </div>
</footer>
<script src="/assets/js/components/footer-nav.js" defer></script>
<script src="/assets/js/cookie-consent.js" defer></script>
</body></html>