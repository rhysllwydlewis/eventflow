# EventFlow Environment Variables

# PRODUCTION DEPLOYMENT CHECKLIST
# ================================
# ‚ö†Ô∏è  Before deploying to production, you MUST complete ALL required steps:
#
# REQUIRED (App will fail without these):
# ‚òê 1. Generate strong JWT_SECRET: openssl rand -base64 32
# ‚òê 2. Set NODE_ENV=production
# ‚òê 3. Set BASE_URL to your actual domain (https://event-flow.co.uk)
# ‚òê 4. ‚≠ê Configure MongoDB Atlas - see detailed steps below
#      ‚Üí Create free account at https://cloud.mongodb.com/
#      ‚Üí Set MONGODB_URI with your actual connection string
#      ‚Üí See MONGODB_SETUP_SIMPLE.md for step-by-step guide
#
# RECOMMENDED (For full functionality):
# ‚òê 5. Configure email service (AWS SES, SendGrid, or SMTP)
# ‚òê 6. Set EMAIL_ENABLED=true for email delivery
# ‚òê 7. Set FROM_EMAIL to match your verified domain
#
# IMPORTANT: If MongoDB is not configured correctly, you will see:
# ‚Ä¢ "Failed to connect to MongoDB: Invalid scheme..." error
# ‚Ä¢ 502 Bad Gateway errors
# ‚Ä¢ "connection refused" errors
#
# üìö Troubleshooting 502 errors? See: MONGODB_SETUP_SIMPLE.md
# üìö Full deployment guide: DEPLOYMENT_GUIDE.md

# ============================================
# REQUIRED: Security
# ============================================
# Generate a strong secret: openssl rand -base64 32
JWT_SECRET=your_super_long_random_secret

# ============================================
# Admin Authentication
# ============================================
# Owner account credentials - protected from deletion/demotion
# This account is automatically created on server startup if it doesn't exist
# Owner email (defaults to admin@event-flow.co.uk if not set)
OWNER_EMAIL=admin@event-flow.co.uk

# Owner account password
# IMPORTANT: Set a strong password for production deployments
# The server will warn if using default password in production
OWNER_PASSWORD=Admin123!

# Admin domains for automatic admin promotion (comma-separated)
# Users with verified emails from these domains are automatically granted admin role
# Example: event-flow.co.uk,yourcompany.com
# Leave empty to disable domain-based admin promotion
ADMIN_DOMAINS=event-flow.co.uk

# ============================================
# Database Configuration
# ============================================
# ‚ö†Ô∏è  PRODUCTION DEPLOYMENT: You MUST configure MongoDB Atlas
#
# For detailed setup instructions, see: MONGODB_SETUP_SIMPLE.md
# Quick start: https://github.com/rhysllwydlewis/eventflow#mongodb-setup

# ============================================
# MongoDB Atlas (Cloud Database) - REQUIRED FOR PRODUCTION
# ============================================
# 
# ‚ö†Ô∏è  IMPORTANT: The value below is a PLACEHOLDER and will NOT work!
# You must replace it with your actual MongoDB Atlas connection string.
#
# How to get your connection string:
# 1. Create free account at https://cloud.mongodb.com/
# 2. Create a cluster (free M0 tier available)
# 3. Add a database user (Database Access ‚Üí Add New Database User)
# 4. Whitelist your IP (Network Access ‚Üí Add IP Address ‚Üí Allow Access from Anywhere for testing)
# 5. Click "Connect" on your cluster ‚Üí "Connect your application"
# 6. Copy the connection string and paste it below
# 7. Replace <username>, <password>, and <cluster-name> with your actual values
#
# Your REAL connection string will look like:
# mongodb+srv://myusername:myStrongPass123@cluster0.abcde.mongodb.net/?retryWrites=true&w=majority
#
# ‚ö†Ô∏è  DO NOT USE THE PLACEHOLDER BELOW - IT WILL CAUSE 502 ERRORS!
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/?appName=YourCluster

# ============================================
# Local MongoDB - DEVELOPMENT/TESTING ONLY
# ============================================
# This is automatically used in development if MONGODB_URI is not set
# ‚ö†Ô∏è  NOTE: Localhost URIs are rejected in production for security
MONGODB_LOCAL_URI=mongodb://localhost:27017/eventflow

# Database name (optional, defaults to 'eventflow')
MONGODB_DB_NAME=eventflow

# ============================================
# Server Configuration
# ============================================
PORT=3000
NODE_ENV=development

# Your website URL (required for verification emails)
# Local: http://localhost:3000
# Production: https://event-flow.co.uk
# NOTE: Using localhost in production will trigger a warning
BASE_URL=http://localhost:3000

# Cookie domain for production (optional, auto-detected if not set)
# Use with leading dot to include subdomains: .event-flow.co.uk
# Or without for exact domain: event-flow.co.uk
# Only used in production to ensure proper cookie clearing across domain variants
COOKIE_DOMAIN=.event-flow.co.uk

# Trust proxy setting (for Railway, Heroku, or other reverse proxies)
# Set to 'true' when running behind a proxy/load balancer to enable proper IP detection
# Required for rate limiting and X-Forwarded-For/X-Forwarded-Proto headers
# Default: 'false' for local dev, automatically 'true' on Railway (RAILWAY_ENVIRONMENT exists)
TRUST_PROXY=false

# ============================================
# WEBSOCKET CONFIGURATION
# ============================================
# WebSocket mode determines which real-time server to use
# Options:
#   v2 (default, recommended) - Modern WebSocket server with enhanced features
#     ‚Ä¢ Real-time messaging with typing indicators
#     ‚Ä¢ Read receipts and presence tracking
#     ‚Ä¢ Emoji reactions
#     ‚Ä¢ Better performance and clustering support
#   v1 (legacy) - Legacy WebSocket server for backwards compatibility
#     ‚Ä¢ Basic real-time notifications
#     ‚Ä¢ Use only if you need v1-specific client compatibility
#   off - Disable WebSocket (not recommended)
#     ‚Ä¢ Disables all real-time features
#
# IMPORTANT: Only ONE WebSocket server can run at a time to prevent crashes
# Recommended: Use 'v2' (default) for best performance and features
WEBSOCKET_MODE=v2

# WebSocket path (default: /socket.io)
# Change only if you need a custom WebSocket endpoint path
WEBSOCKET_PATH=/socket.io

# ============================================
# EMAIL CONFIGURATION (Postmark Only)
# ============================================
# EventFlow uses Postmark exclusively for all email delivery
# Postmark provides reliable transactional email with excellent deliverability

# Enable/disable email sending
# In production, this defaults to 'true'
# In development, this defaults to 'false' (emails saved to /outbox folder)
EMAIL_ENABLED=true

# ==============================================
# POSTMARK EMAIL CONFIGURATION (REQUIRED)
# ==============================================
# Get your API key from: https://account.postmarkapp.com/api_tokens
# Documentation: https://postmarkapp.com/developer

# Your Postmark Server API Token (REQUIRED for email sending)
POSTMARK_API_KEY=your-postmark-server-token-here

# Sender email address (REQUIRED - must be verified in Postmark)
# For production, use: admin@event-flow.co.uk
POSTMARK_FROM=admin@event-flow.co.uk

# Webhook Authentication (OPTIONAL but RECOMMENDED for production)
# Set these credentials in Postmark webhook settings for security
# Generate strong random credentials and configure them in both places
# POSTMARK_WEBHOOK_USER=postmark-webhook
# POSTMARK_WEBHOOK_PASS=generate-strong-random-password-here

# Application base URL (used for verification and reset links in emails)
# Local: http://localhost:3000
# Production: https://event-flow.co.uk
APP_BASE_URL=http://localhost:3000

# Optional: Secret for unsubscribe token generation (defaults to JWT_SECRET)
# Used to generate secure HMAC-SHA256 tokens for unsubscribe links
# If not set, will use JWT_SECRET as fallback
# UNSUBSCRIBE_SECRET=your-separate-secret-for-unsubscribe-tokens

# ============================================
# OPTIONAL FEATURES
# ============================================

# ============================================
# STRIPE PAYMENT INTEGRATION
# ============================================
# EventFlow uses Stripe for secure payment processing and subscription management
# Get your API keys from: https://dashboard.stripe.com/apikeys
# Documentation: https://stripe.com/docs/js

# Stripe Secret Key (REQUIRED for backend payment processing)
# Use test keys (sk_test_...) for development
# Use live keys (sk_live_...) for production
STRIPE_SECRET_KEY=

# Stripe Publishable Key (REQUIRED for frontend Stripe.js integration)
# Use test keys (pk_test_...) for development
# Use live keys (pk_live_...) for production
# This key is exposed to the frontend via /api/payments/config
# NOTE: On Railway, you can also use NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
STRIPE_PUBLISHABLE_KEY=
# NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=

# Stripe Webhook Secret (REQUIRED for production webhook verification)
# Get this from Stripe Dashboard > Developers > Webhooks
# Used to verify webhook signatures for security
STRIPE_WEBHOOK_SECRET=

# Payment Success URL (where users are redirected after successful payment)
# Local: http://localhost:3000/payment-success.html
# Production: https://event-flow.co.uk/payment-success.html
STRIPE_SUCCESS_URL=http://localhost:3000/payment-success.html

# Payment Cancel URL (where users are redirected if they cancel payment)
# Local: http://localhost:3000/payment-cancel.html
# Production: https://event-flow.co.uk/payment-cancel.html
STRIPE_CANCEL_URL=http://localhost:3000/payment-cancel.html

# Stripe Subscription Price IDs (for recurring subscriptions)
# Create these in Stripe Dashboard > Products > Add Product > Add Price
# Use recurring prices with monthly billing
STRIPE_PRO_PRICE_ID=

# Stripe Coupon for Introductory Pricing
# Create in Stripe Dashboard > Products > Coupons > New Coupon
# Example: ¬£20 off for 3 months for Professional plan intro pricing
# This allows ¬£39/month for 3 months, then ¬£59/month (when STRIPE_PRO_PRICE_ID is ¬£59)
STRIPE_PRO_INTRO_COUPON_ID=

# Legacy Stripe configuration (deprecated, use new variables above)
STRIPE_SUPPLIER_PRICE_ID=

# ============================================
# TESTING STRIPE LOCALLY
# ============================================
# 1. Get test API keys from Stripe Dashboard (sk_test_... and pk_test_...)
# 2. Install Stripe CLI: https://stripe.com/docs/stripe-cli
# 3. Run: stripe listen --forward-to localhost:3000/api/payments/webhook
# 4. Copy the webhook signing secret (whsec_...) to STRIPE_WEBHOOK_SECRET
# 5. Use test card: 4242 4242 4242 4242, any future expiry, any CVC
# 6. For subscription testing, create Price IDs in Stripe Dashboard

# OpenAI (optional, for AI planning assistant)
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4-turbo-mini

# ============================================
# MESSAGING SYSTEM CONFIGURATION
# ============================================
# Sentry DSN for error monitoring
# Get from: https://sentry.io/settings/projects/
SENTRY_DSN=
SENTRY_DSN_FRONTEND=

# Message rate limiting
MAX_MESSAGES_PER_MINUTE=30

# Spam detection keywords (comma-separated)
SPAM_KEYWORDS=viagra,cialis,casino,lottery,winner

# Message editing window in minutes
MESSAGE_EDIT_WINDOW_MINUTES=15

# Maximum pinned threads per user
MAX_PINNED_THREADS=10

# Google Maps (optional, for venue maps)
# Get API key from: https://console.cloud.google.com/apis/credentials
# Enable Maps Embed API and Maps JavaScript API
GOOGLE_MAPS_API_KEY=

# Pexels (optional, for stock photos in admin)
# Get API key from: https://www.pexels.com/api/
# Used for browsing and selecting professional stock photos for category images and site content
# Suppliers still upload their own profile and package photos
PEXELS_API_KEY=

# ============================================
# FOUNDER BADGE & PROFILE SETTINGS
# ============================================
# Launch timestamp for founder badge eligibility (ISO 8601 format)
# Users who register within 6 months of this date receive the founder badge
# Example: 2026-01-01T00:00:00Z
FOUNDER_LAUNCH_TS=2026-01-01T00:00:00Z

# Avatar upload settings
# Maximum file size in megabytes
AVATAR_MAX_MB=5

# Allowed image types (comma-separated)
AVATAR_ALLOWED_TYPES=jpeg,jpg,png,webp

# Avatar storage path (relative to project root)
AVATAR_STORAGE_PATH=uploads/avatars

# Upload file size limits (in MB)
# Separate limits for different upload contexts
MAX_FILE_SIZE_MARKETPLACE_MB=10
MAX_FILE_SIZE_SUPPLIER_MB=10
MAX_FILE_SIZE_AVATAR_MB=5

# Maximum pixel count for images (prevents decompression bombs)
# Default: 25 megapixels (25000000 pixels)
MAX_PIXEL_COUNT=25000000

# Additional CORS origins (comma-separated)
# Allows multiple origins beyond BASE_URL
# Example: https://preview.mysite.com,https://staging.mysite.com
# ALLOWED_ORIGINS=

# ============================================
# NOTES
# ============================================

# For Postmark:
# 1. Sign up at https://postmarkapp.com
# 2. Get your Server API Token from Account > API Tokens
# 3. Verify your sender email/domain at Sender Signatures
# 4. Configure POSTMARK_API_KEY and POSTMARK_FROM in Railway dashboard
# 5. DO NOT hardcode real API keys in this file or commit them to git
# 6. For local development, create a .env file (not tracked in git) with your keys

# Testing locally:
# - Set EMAIL_ENABLED=false to test without sending real emails
# - Verification links will be shown in the API response
# - Email files are saved to /outbox folder for inspection
